<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="icon" type="image/png" href="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.4.0/jspdf.umd.min.js"></script>
    <title>EzeeBot</title>
    <script src="https://cdn.jsdelivr.net/npm/showdown@1.9.1/dist/showdown.min.js"></script>
    <style>
        
        body {
            background-color: #ffffff;
            color: #333333;
            font-family: Arial, sans-serif;
            overflow: hidden;
            margin: 0;
            padding: 0;
        }

        #random-questions {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            margin-top: auto;
            margin-bottom: 20px;
        }
        
        #random-questions .button {
            display: inline-block;
            padding: 6px 10px;
            font-size: calc(10px + 0.5vw);
            text-align: center;
            background-color: transparent;
            border: 1px solid #0a2351;
            color: #0a2351;
            text-decoration: none;
            cursor: pointer;
            border-radius: 8px;
            transition: background-color 0.3s ease, transform 0.2s ease;
            margin: 2px;
            white-space: nowrap; /* Prevents text wrapping */
            overflow: hidden; /* Hides overflow text */
            text-overflow: ellipsis;
        }
        
        #random-questions .button:hover {
            background-color: #0a2351;
            color: white;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.6);
            text-overflow: initial;
            white-space: normal;
        }
        
        #random-questions .button .button-text {
            transition: transform 0.3s ease; /* Ensures smooth scaling */
        }
        
        #random-questions .button:hover .button-text {
            transform: scale(1.1); /* Scale up by 10% */
        }
        
        #random-questions .button:active {
            transform: scale(0.99);
        }        

        blockquote table {
            width: 98%;
            margin-bottom: 20px;
            border-collapse: collapse;
            border-radius: 10px;
            overflow: hidden;
        }
        
        blockquote table tbody {
            overflow-y: auto;
            overflow-x: hidden;
            max-height: 350px;
            display: block;
        }
        
        blockquote tbody td:hover {
            overflow: visible;
            white-space: normal;
            text-overflow: inherit;
            font-weight: bold;
            transform: scale(1.01);
        }
        
        blockquote tbody td {
            white-space: nowrap;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.1s ease-in-out;
            text-overflow: ellipsis;
        }
        
        blockquote th:hover {
            overflow: visible;
            white-space: normal;
            text-overflow: inherit;
        }
        
        blockquote th {
            white-space: nowrap;
            overflow: hidden;
            cursor: pointer;
            text-overflow: ellipsis;
        }
        
        blockquote table tbody::-webkit-scrollbar {
            width: 5px; /* Width of the scrollbar */
        }
        
        /* Track */
        blockquote table tbody::-webkit-scrollbar-track {
            background: #f1f1f1; /* Track color */
        }
        
        /* Handle */
        blockquote table tbody::-webkit-scrollbar-thumb {
            background: #666; /* Thumb color */
        }
        
        /* Handle on hover */
        blockquote table tbody::-webkit-scrollbar-thumb:hover {
            background: #666; /* Thumb color on hover */
        }
        
        blockquote table thead, blockquote table tfoot, blockquote table tbody tr {
            display: table;
            width: 100%;
            table-layout: fixed;
        }
        
        blockquote table thead {
            background-color: #002147;
            color: white;
        }
        
        blockquote table tfoot {
            background-color: #ACACAC;
            color: #1b1b1b;
        }
        
        blockquote table th, blockquote table td {
            border: 1px solid #ddd;
            padding-left: 8px;
            padding-top: 5px;
            padding-right: 8px;
            padding-bottom: 5px;
            text-align: left;
        }
        
        blockquote table tbody tr:hover {
            background-color: #ddd;
        }
        
        blockquote table th {
            text-align: left;
            background-color: #002147;
            color: white;
        }
        
        blockquote tbody tr:nth-child(even) {
            background-color: #e5e4e2;
        }
        
        blockquote tbody tr:nth-child(odd) {
            background-color: #d3d3d3;
        }        

        /* Styling for code keywords (e.g., def, print, if, else) */
        .codehilite .k, .kn {
        color: #009698;
        font-weight: bold;
        }

        /* Styling for function/method names (e.g., greet) */
        .codehilite .nf {
        color: #8b0000; /* Purple color for function names */
        }

        /* Styling for string literals (e.g., "Hello, ", 'What's your name? ') */
        .codehilite .s2, .codehilite .s1, .codehilite .sd {
        color: #996515;
        }

        /* Styling for comments (e.g., # This function greets...) */
        .codehilite .c1 {
        color: #009900;
        font-style: italic;
        }

        /* Styling for built-in or standard functions (e.g., input, print) */
        .codehilite .nb {
        color: #860111;
        }

        /* Styling for variables and constants (e.g., num, True, False) */
        .codehilite .nv, .codehilite .vc {
        color: #28a745; /* Green color for variables and constants */
        }

        .codehilite .na {
            color: #8b0000;
        }

        .codehilite .s, .codehilite .mh {
            color: #996515;
        }

        /* Styling for special characters and escape sequences */
        .codehilite .se {
        color: #17a2b8; /* Cyan color for special characters */
        }

        /* Styling for numbers (e.g., 10, 5, 7) */
        .codehilite .mi {
        color: #fd7e14; /* Orange color for numbers */
        }

        /* Styling for line numbers (if displayed) */
        .codehilite .ln {
        color: #6c757d; /* Gray color for line numbers */
        }

        /* Styling for block level elements within code (e.g., functions, classes) */
        .codehilite .b {
        font-weight: bold;
        }

        :not(pre) > code {
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
        }

        pre table {
            width: 100%;
            border-collapse: collapse;
            border: 1px solid #ccc;
            margin-bottom: 20px;
        }

        pre th {
            background-color: #f2f2f2;
            border: 1px solid #ccc;
            padding: 8px;
            text-align: left;
        }

        pre td {
            border: 1px solid #ccc;
            padding: 8px;
        }

        pre {
            background-color: #f1f1f1;
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 5px;
            overflow-x: auto;
            position: relative;
            font-family: 'Courier New', Courier, monospace;
            line-height: 1.5;
            width: 98%;
        }

        strong {
            font-weight: bold;
        }

        em {
            font-style: italic;
        }

        a {
            color: blue;
            text-decoration: underline;
        }

        ul, ol {
            margin-top: 0;
            padding-left: 20px;
        }

        li {
            list-style-type: disc;
        }

        pre::-webkit-scrollbar {
            width: 5px;
            height: 5px;
        }
        
        pre::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        
        pre::-webkit-scrollbar-thumb {
            background-color: #888;
            border-radius: 10px;
        }
        
        pre::-webkit-scrollbar-thumb:hover {
            background-color: #555;
        }        
    
        .custom-button {
            background: none;
            padding-left: 0px;
            border: none;
            cursor: pointer;
            text-align: left;
            font-size: calc(11px + 0.5vw);
        }

        .custom-button:hover {
            text-decoration: underline;
        }
        
        @keyframes fade {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        .bot-message-chat-top,
        #tags, #random-questions {
            animation: fade 0.5s ease forwards;
        }        

        body::-webkit-scrollbar {
            display: none;
        }

        .checkbox-label {
            cursor: pointer;
            font-size: calc(9px + 0.5vw);
        }
        
        .highlight {
            color: black;
            font-weight: bold;
        }
        
        html {
            font-size: calc(11px + 0.5vw);
        }
        
        h1, h3 {
            position: -webkit-sticky;
            position: sticky;
            top: 0px;
            background-color #CCCCCC;
            border-bottom: 0.2px solid #e5e4e2;
            color: #333333;
            padding: 10px;
            z-index: 1000;
        }
        
        h1::after {
            content: "";
            display: block;
            position: absolute;
            bottom: 0;
            left: 0;
            height: 1px;
            width: 100%;
            background-color: #007bff;
            display: none;
            animation: loading 2s linear infinite;
        }
        
        h1.show-after::after {
            display: block;
        }

        @keyframes loading {
            0% { left: 0; width: 20%; }
            50% { width: 20%; }
            100% { left: 100%; width: 20%; }
        }        
        
        .message-container {
            margin-bottom: 10px;
            display: flex;
            align-items: flext-start;
            overflow: hidden;
        }

        .message-container-start {
            margin-bottom: 10px;
            display: flex;
            flex-direction: column;
            height: 25vh;
            background-color: #fefefa;
            align-items: center;
            overflow: hidden;
            text-align: center;
            justify-content: flex-end;
        }
        
        .user-message {
            background-color: #006FBA;
            color: #ffffff;
            margin-left: auto;
            float: right;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 3px;
            padding: 10px;
            margin-top: 10px;
            max-width: 40%;
            font-size: calc(11px + 0.5vw);
            clear: both;
        }

        .user-message-img {
            background-color: #006FBA;
            color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-left: auto;
            margin-top: 10px;
            margin-bottom: 10px;
            float: right;
            padding: 3px;
            max-width: 40%;
            font-size: calc(11px + 0.5vw);
            clear: both;
        }

        .user-message-pdf {
            background-color: #006FBA;
            color: #ffffff;
            display: flex;
            justify-content: center;
            align-items: center;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            border-bottom-left-radius: 20px;
            border-bottom-right-radius: 3px;
            margin-left: auto;
            float: right;
            padding: 5px;
            max-width: 40%;
            font-size: calc(11px + 0.5vw);
            clear: both;
        }
        
        .bot-avatar {
            float: left;
            margin-top: 5px;
            position: relative;
        }

        .bot-avatar-start {
            float: center;
            margin-top: 5px;
            position: relative;
            transition: all 0.3s ease-in-out;
        }
        
        .bot-avatar-start:hover {
            transform: scale(1.05);
        }
        
        .bot-avatar img {
            position: absolute;
            bottom: 0;
            width: 30px;
            height: auto;
        }
        
        .bot-message {
            background-color: #e5e4e2;
            color: #333333;
            float: left; /* Change float to left */
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            border-bottom-right-radius: 20px;
            border-bottom-left-radius: 0px;
            padding: 10px;
            font-size: calc(11px + 0.5vw);
            margin-bottom: 6px;
            clear: both;
            max-width: 60%;
            word-wrap: break-word;
            margin-left: 37px;
        }

        .bot-message-chat {
            background-color: transparent;
            color: #333333;
            float: left; /* Change float to left */
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            border-bottom-right-radius: 20px;
            border-bottom-left-radius: 0px;
            padding-bottom: 10px;
            padding-top: 12px;
            font-size: calc(11px + 0.5vw);
            margin-bottom: 6px;
            clear: both;
            max-width: 100%;
            word-wrap: break-word;
            margin-left: 17px;
            margin-top: 30px;
        }

        .bot-message-chat-dp {
            background-color: transparent;
            color: #333333;
            float: left; /* Change float to left */
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            border-bottom-right-radius: 20px;
            border-bottom-left-radius: 0px;
            padding-bottom: 10px;
            padding-top: 23px;
            font-size: calc(11px + 0.5vw);
            margin-bottom: 6px;
            clear: both;
            max-width: 100%;
            word-wrap: break-word;
            margin-left: 47px;
            margin-top: 40px;
        }

        .bot-message-chat-3 {
            background-color: transparent;
            color: #333333;
            float: left; /* Change float to left */
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            border-bottom-right-radius: 20px;
            border-bottom-left-radius: 0px;
            font-size: calc(11px + 0.5vw);
            margin-bottom: 6px;
            clear: both;
            max-width: 100%;
            word-wrap: break-word;
            margin-left: 17px;
            margin-top: 30px;
        }

        .bot-message-chat-2 {
            background-color: transparent;
            color: #333333;
            float: left; /* Change float to left */
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            border-bottom-right-radius: 20px;
            border-bottom-left-radius: 0px;
            font-size: calc(11px + 0.5vw);
            margin-bottom: 6px;
            clear: both;
            max-width: 100%;
            word-wrap: break-word;
            margin-left: -24px;
            margin-top: 30px;
        }

        .bot-message-chat-res {
            background-color: transparent;
            color: #333333;
            float: left; /* Change float to left */
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            border-bottom-right-radius: 20px;
            border-bottom-left-radius: 0px;
            font-size: calc(11px + 0.5vw);
            margin-bottom: 6px;
            clear: both;
            max-width: 100%;
            word-wrap: break-word;
            margin-left: 15px;
            margin-top: 30px;
        }

        .bot-message-chat-top {
            background-color: transparent;
            color: #333333;
            float: center; /* Change float to left */
            padding-bottom: 10px;
            padding-top: 0px;
            display: flex;
            text-align: top;
            justify-content: center;
            align-items: center;
            font-size: calc(15px + 0.5vw);
            margin-bottom: 6px;
            clear: both;
            max-width: 100%;
            word-wrap: break-word;
            margin-left: 17px;
        }

        .bot-message-time {
            background-color: transparent;
            color: #333333;
            float: left; /* Change float to left */
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            border-bottom-right-radius: 20px;
            border-bottom-left-radius: 0px;
            font-size: calc(11px + 0.5vw);
            margin-bottom: 6px;
            clear: both;
            max-width: 70%;
            word-wrap: break-word;
            margin-left: 37px;
        }
        
        #input-container {
            position: fixed;
            bottom: 10px;
            left:55px;
            right:55px;
            display: flex;
            width: 90%;
            padding: 10px;
            margin: 0 auto; 
            box-shadow: 0 -2px 4px rgba(0, 0, 0, 0.1);
        }
        
        #main-container {
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        
        .opening-page {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            background-color: #ffffff; 
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 9999;
        }
        
        .loading-container {
            margin-bottom: 500px;
        }
        
        .text-below-logo {
            margin-top: 0px;
            display: flex;
            align-items: center;
        }
        
        .text-below-logo a {
            margin-right: 10px;
        }
        
        .loading-animation {
            width: 50px;
            height: 50px; 
            border: 10px solid #006FBA;
            border-top: 10px solid transparent;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-top: 20px;
        }
        
        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }
        
            100% {
                transform: rotate(360deg);
            }
        }
        
        #main-container {
            display: none;
        }
        
        #chat-container {
            padding: 20px 10px 10px;
            background-color: #fefefa;
            flex-grow: 1;
            right: 0;
            margin-top: 0px;
            left: 0;
            bottom: 0;
            top: 0;
            position: sticky;
            overflow-y: scroll;
            overflow-x: hidden;
        }
        
        /* Show scrollbar */
        #chat-container::-webkit-scrollbar {
            display: none;
        }
        
        .indented {
            margin-left: 20px;
        }
        
        #footer {
            position: sticky;
            overflow: hidden;
            width: 100%;
            padding-top: 7px;
            padding-bottom: 10px;
            z-index: 1000;
            display: flex;
            justify-content: bottom;
            align-items: bottom;
        }

        .button-group {
            display: flex;
            margin-bottom: 8px; /* Add margin between button groups */
        }   
        
        #user-input {
            flex: 1;
            margin-right: 20px;
            padding: calc(1px + 0.5vw) calc(10px + 0.5vw);
            border: 1px solid grey;
            padding-top: 8px;
            border-radius: 5px;
            font-size: calc(11px + 0.5vw);
            background-color: white;
            color: black;
            width: 100%;
        }

        #user-input:focus {
            outline: none;
            border: 0.5px solid transparent;
            box-shadow: 0 0 3px rgba(0, 111, 186, 0.5);
        }
        
        #user-input::placeholder {
            font-size: 16px;
        }
        
        #tags {
            top: -11px;
            background-color: transparent;
            z-index: 1;
            padding-bottom: 10px;
            display: flex;
            flex-wrap: wrap; 
            align-items: center;
            margin-top: 10px;
            justify-content: center;
            text-transform: capitalize;
        }
        
        #tags button {
            background-color: transparent;
            border: 1px solid #0a2351;
            color: #0a2351;
            padding: calc(5px + 0.1vw) calc(5px + 0.2vw);
            padding-top: calc(20px + 0.2vw);
            padding-bottom: calc(20px + 0.2vw);
            padding-left: calc(20px + 0.2vw);
            padding-right: calc(20px + 0.2vw);
            text-align: center;
            height: calc(40px + 0.2vw);
            text-decoration: none;
            display: inline-flex;
            justify-content: center;
            align-items: center;
            font-size: calc(12px + 0.5vw);
            margin: 10px 2.5px;
            cursor: pointer;
            border-radius: 8px;
            text-transform: capitalize;
            outline: none; /* Remove default outline */
            transition: background-color 0.3s, color 0.3s, border-color 0.3s; /* Add transition */
        }

        #tags button:nth-child(n+4) {
            margin-top: 10px;
        }
        
        #patterns button:first-child {
            margin-left: 48px;
        }
        
        #patterns button {
            background-color: transparent;
            border: 1px solid #0a2351;
            color: #0a2351;
            text-transform: capitalize;
            padding: calc(5px + 0.1vw) calc(5px + 0.2vw);
            text-align: center;
            height: 27px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            font-size: calc(8px + 0.5vw);
            margin: 10px 2px;
            cursor: pointer;
            border-radius: 8px;
            outline: none; /* Remove default outline */
            transition: background-color 0.3s, color 0.3s, border-color 0.3s; /* Add transition */
        }

        #customButton {
            position: absolute;
            cursor: pointer;
            top: 18px;
            right: 18px;
            width: 30px;  /* Adjusted to accommodate the text */
            height: 30px;
            border-radius: 15%;
            background-color: transparent;
            border: none;
            outline: none;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 23px;
            background: linear-gradient(to top, #006ade 25%, #005CAD 75%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        #customButton .button-text {
            /* Add transition properties to create a smooth effect */
            transition: transform 0.3s ease;
            background: linear-gradient(to top, #006ade 25%, #005CAD 75%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }
        
        #customButton:hover .button-text {
            /* Scale up the text inside the button */
            transform: scale(1.1); /* Scale up by 10% */
            background: linear-gradient(to top, #006ade 25%, #005CAD 75%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
        }

        #customButton:active {
            transform: scale(0.95);
        }
        
        #tags button:hover {
            /* Change background color, text color, scale, and add shadow on hover */
            background-color: #0a2351;
            color: white;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.6); /* Add box shadow */
        }

        #tags button .button-text {
            /* Add transition properties to create a smooth effect */
            transition: transform 0.3s ease;
        }
        
        #tags button:hover .button-text {
            /* Scale up the text inside the button */
            transform: scale(1.1); /* Scale up by 10% */
        }

        #tags button:active {
            transform: scale(0.99);
        }

        #tags button {
            transition: transform 0.2ms ease;
        }
        
        #patterns button:hover {
            background-color: #0a2351;
            color: white;
        }

        #patterns button:active {
            transform: scale(0.99);
        }

        #patterns button {
            transition: transform 0.2ms ease;
        }
        
        #help-message {
            margin-top: 10px;
            font-size: calc(11px + 0.5vw);
        }
        
        .ezee {
            color: #414a4c;
        }
        
        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
        }
        
        .close:hover,
        .close:focus {
            color: black;
            text-decoration: none;
            cursor: pointer;
        }
        
        .modal {
            display: none;
            position: fixed;
            z-index: 9999999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.5);
        }
        
        .modal-content {
            background-color: #fefefe;
            margin: 9% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 80%;
            max-width: 600px;
            border-radius: 5px;
        }
        
        form {
            display: grid;
            gap: 10px;
        }
        
        label {
            font-weight: bold;
            font-size: 16px;
            display: block;
            margin-bottom: 10px;
        }
        
        input[type="text"],
        input[type="datetime-local"] {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            box-sizing: border-box;
        }
        
        #submit2input {
            width: 100%;
            padding: 10px;
            border-radius: 5px;
            border: 1px solid #ccc;
            box-sizing: border-box;
            background-color: #006FBA;
            color: white;
            border: none;
            cursor: pointer;
        }
        
        #submit2input:hover {
            background-color: #007bff;
        }
        
        option {
            text-align: center;
        }
        
        select {
            width: 200px;
            height: 35px;
            font-size: 16px;
            vertical-align: middle;
            text-align: center;
        }
        
        .dot-pulse {
            display: inline-block;
            width: 6px;
            height: 6px;
            background-color: #333;
            border-radius: 50%;
            animation: pulse 0.8s infinite;
            margin-left: 3px;
        }
        
        .dot-pulse:nth-child(1) {
            animation-delay: 0.1s;
        }

        .dot-pulse:nth-child(2) {
            animation-delay: 0.3s;
        }
        
        .dot-pulse:nth-child(3) {
            animation-delay: 0.5s;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(0.5); }
        }
        
        .bot-time {
            color: #777; /* Light gray text color */
            font-size: 8.5px; /* Adjust font size as needed */
            margin-top: -14px;
            margin-left: 51px;
        }
        
        .user-time {
            color: #777; /* Light gray text color */
            font-size: 8.5px; /* Adjust font size as needed */
            margin-top: -9px;
            margin-left: 1294px;
        }   

        .header-box {
            background-color: #0a2351;
            border: 1px solid #ccc;
            padding: 10px;
            margin-top: -20px;
            margin-bottom: 20px;
            border-top-right-radius: 5px;
            border-top-left-radius: 5px;
            margin-left: -20px;
            margin-right: -20px;
        }
        
        .header-box h2 {
            margin: 0;
            color: white;
            font-size: 18px;
        }  
        
        .close {
            color: white;
            font-size: 30px;
            cursor: pointer;
            position: absolute;
            margin-top: 125px;
            margin-right: 380px;
            top: 5px;
            right: 10px;
        }
        
        .close:hover {
            color: red;
        }  
        
        label-2 {
            font-weight: bold;
            font-size: 18px;
            display: block;
            margin-bottom: 10px;
        }

        .bot-message-check-lead, .bot-message-check-fright, .bot-message-check-quotation, .bot-message-check-enquiry, .bot-message-check-customBE, .bot-message-check-customSB, .bot-message-check-trp, .bot-message-check-custom, .bot-message-check-selling, .bot-message-check-pay, .bot-message-check-receipts, .bot-message-check-buy, .bot-message-check-frightawb, .bot-message-check-frightBillOfLading {
            background-color: #f1f1f1;
            color: #333333;
            float: left;
            border-top-left-radius: 1px;
            border-top-right-radius: 20px;
            border-bottom-right-radius: 20px;
            border-bottom-left-radius: 20px;
            padding: 10px;
            padding-bottom: 5px;
            font-size: calc(11px + 0.5vw);
            clear: both;
            margin-bottom: 6px;
            word-wrap: break-word;
            margin-left: 50px;
            margin-top: 10px;
        }

        .bot-message-booking {
            background-color: transparent;
            color: #333333;
            float: left; /* Change float to left */
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            border-bottom-right-radius: 20px;
            border-bottom-left-radius: 0px;
            padding-top: 20px;
            padding-bottom: 10px;
            font-size: calc(11px + 0.5vw);
            margin-bottom: 6px;
            margin-top: 20px;
            clear: both;
            line-height: 20px;
            width: 90%;
            word-wrap: break-word;
            margin-left: 17px;
        }

        .bot-message-page {
            background-color: #e5e4e2;
            color: #333333;
            font-size: calc(11px + 0.5vw);
            line-height: 20px;
            margin-bottom: 3px;
        }
        
        .modal-2 {
            display: none;
            position: fixed;
            z-index: 9999999;
            left: 50%;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 50%;
            height: 50%;
            overflow: auto;
            border: 1px solid black;
            background-color: white;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            padding: 20px;
            box-sizing: border-box;
        }
        
        .modal-content-2 {
            max-width: 100%;
            margin: 0 auto;
            text-align: center;
        }
        
        .modal-content-2 img {
            width: 100%;
            height: auto;
            max-width: 100%;
            clip-path: none; /* Removed clip-path for a normal modal */
        }
        
        .close-2 {
            color: black;
            font-size: 30px;
            cursor: pointer;
            position: absolute;
            top: 10px;
            right: 20px;
        }
        
        .close-2:hover {
            color: red;
        }        

        .header-box-2 {
            background-color: #0a2351;
            border: 1px solid #ccc;
            padding: 10px;
            margin-top: 20px;
            margin-bottom: -100px;
            border-bottom-right-radius: 0px;
            border-bottom-left-radius: 0px;
            margin-left: 0px;
            text-align: center;
            margin-right: 0px;
        }
        
        .header-box-2 h2 {
            margin: 0;
            color: white;
            font-size: 18px;
        }
        
        #dp:active {
            transform: scale(0.99);
        }

        #dp {
            transition: transform 0.2ms ease;
        }

        #datetime-input {
            width: 200px;
            height: 30px;
            background-color: #f9f9f9;
            margin-left: 11px;
            margin-top: 10px;
            transition: border-color 0.3s ease-in-out;
        }
          
        #datetime-input:focus {
            outline: none;
            border: 0.5px solid #007bff;
        }

        .booking-details::-webkit-scrollbar {
            width: 10px; /* Width of the scrollbar */
        }
        
        /* Track */
        .booking-details::-webkit-scrollbar-track {
            background: #f1f1f1; /* Track color */
        }
        
        /* Handle */
        .booking-details::-webkit-scrollbar-thumb {
            background: #999; /* Thumb color */
        }
        
        /* Handle on hover */
        .booking-details::-webkit-scrollbar-thumb:hover {
            background: #666; /* Thumb color on hover */
        }

        .booking-details {
            border-collapse: collapse;
            width: 100%;
            font-size: calc(11px + 0.5vw);
            height: 300px; /* Set the fixed height here */
            overflow-y: auto; /* Enable vertical scrolling */
            overflow-x: hidden;
        }
        
        .booking-details td {
            border: 2px solid #ccc;
            padding: 5px;
            font-size: calc(11px + 0.5vw);
            line-height: 30px;
        }

        .booking-details tr:nth-child(odd) td {
            background-color: #d3d3d3;
        }
        
        .booking-details tr:nth-child(even) td {
            background-color: #e5e4e2;
        }

        .booking-details-c {
            border-collapse: collapse;
            width: 100%;
            font-size: calc(11px + 0.5vw);
        }
        
        .booking-details-c td {
            border: 2px solid #ccc;
            padding: 5px;
            font-size: calc(11px + 0.5vw);
            line-height: 30px;
        }

        .booking-details-c tr:nth-child(odd) td {
            background-color: #d3d3d3;
        }
        
        .booking-details-c tr:nth-child(even) td {
            background-color: #e5e4e2;
        }
        
        .pair {
            margin-bottom: 5px;
        }
        
        .key {
            font-weight: bold;
        }
        
        .value {
            margin-left: 5px;
        }        
        
        .booking-button {
            background-color: #c0c0c0;
            border: calc(0.5px + 0.1vw) solid #c0c0c0;
            color: black;
            text-transform: capitalize;
            height: 30px;
            width: 100%;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: calc(8px + 0.5vw);
            margin: 4px 2px;
            margin-left: -1px;
            cursor: pointer;
            outline: none;
            transition: background-color 0.4s, color 0.4s, border-color 0.4s;
        }        
        
        .booking-button:hover {
            background-color: #c0c0c0;
            color: white;
        }

        #mydownButton {
            position: fixed;
            font-weight: bold;
            bottom: 80px;
            right: 20px;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background-color: #dcdcdc;
            font-size: 20px;
            z-index: 999;
            border: none;
            cursor: pointer;
        }    
        
        #pagination {
            display: flex;
            justify-content: center;
            margin-top: 15px;
        }
        
        .pagination-button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 0px;
            width: 22px;
            height: 22px;
            margin: 0 4px 4px 0;
            cursor: pointer;
            border-radius: 4px;
        }

        .pagination-button:hover {
            background-color: #0056b3;
        }
        
        .pagination-button.active {
            background-color: #0056b3;
        }     
        
        #bot-message-scroll {
            height: 200px;
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        /* Styling the scrollbar */
        #bot-message-scroll::-webkit-scrollbar {
            width: 3px;
        }
        
        /* Track */
        #bot-message-scroll::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        /* Handle */
        #bot-message-scroll::-webkit-scrollbar-thumb {
            background: #999;
        }
        
        /* Handle on hover */
        #bot-message-scroll::-webkit-scrollbar-thumb:hover {
            background: #666;
        }    
        
        #search-input {
            background-color: transparent;
            padding: 8px; /* Add padding to provide some space inside the input */
            border: 1px solid transparent; /* Add a border */
            border-radius: 4px; /* Add border radius for rounded corners */
            color: black;
            margin-top: -10px;
            box-sizing: border-box; /* Ensure padding and border are included in width */
        }
        
        #search-input::placeholder {
            color: black;
        }

        #search-input:focus {
            outline: none;
            border-color: transparent;
        }  

        .no-records-message {
            color: #ff0000;
            font-weight: bold;
            margin-top: 50px;
            text-align: center;
        }    
        
        .news-item {
            border-bottom: 1px solid #ccc;
        }
    
        .news-title {
            font-size: calc(12px + 0.5vw);
            margin-bottom: 5px;
        }
    
        .news-link {
            color: #007bff;
            text-decoration: none;
        }
    
        .news-link:hover {
            text-decoration: underline;
        }
    
        .news-snippet {
            color: #666;
        }

        .news-iframe {
            width: 100%;
            height: 400px; /* Adjust height as needed */
        }

        .booking-details {
            height: 200px;
            overflow-y: auto;
            overflow-x: hidden;
        }
        
        /* Styling the scrollbar */
        .booking-details::-webkit-scrollbar {
            width: 3px;
        }
        
        /* Track */
        .booking-details::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        
        /* Handle */
        .booking-details::-webkit-scrollbar-thumb {
            background: #999;
        }
        
        /* Handle on hover */
        .booking-details::-webkit-scrollbar-thumb:hover {
            background: #666;
        } 

        #message-det {
            background-color: #002147;
            font-weight: bold;
            text-align: center;
            margin-top: 10px;
            color: white;
            font-size: calc(8px + 0.5vw);
        }

        .bot-message-img {
            background-color: #e5e4e2;
            border-top-left-radius: 10px;
            border-top-right-radius: 10px;
            border-bottom-right-radius: 10px;
        }    

        /* Modal styles */
        .modal {
            display: flex;
            justify-content: center;
            align-items: center;
            position: fixed;
            z-index: 9999;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7); /* Semi-transparent black background */
        }

        /* Modal content */
        .modal-content {
            background-color: transparent;
            max-width: 50%;
            max-height: 50%;
        }

        .modal-content img {
            display: block;
            width: 100%;
            height: auto;
            margin: 0 auto;
        }

        .even {
            background-color: #e5e4e2;
        }
        
        .odd {
            background-color: #d3d3d3;
        }
        
        table.striped-table {
            width: 98%;
            margin-bottom: 20px;
            border-collapse: collapse;
            border-radius: 10px;
            overflow: hidden;
        }

        table.striped-table tbody {
            overflow-y: auto;
            overflow-x: hidden;
            max-height: 350px;
            display: block;
        }

        .striped-table tbody td:hover {
            overflow: visible;
            white-space: normal;
            text-overflow: inherit;
            font-weight: bold;
            transform: scale(1.01);
        }

        .striped-table tbody td {
            white-space: nowrap;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.1s ease-in-out;
            text-overflow: ellipsis;
        }

        .striped-table th:hover {
            overflow: visible;
            white-space: normal;
            text-overflow: inherit;
        }

        .striped-table th {
            white-space: nowrap;
            overflow: hidden;
            cursor: pointer;
            text-overflow: ellipsis;
        }

        table.striped-table tbody::-webkit-scrollbar {
            width: 5px; /* Width of the scrollbar */
        }
        
        /* Track */
        table.striped-table tbody::-webkit-scrollbar-track {
            background: #f1f1f1; /* Track color */
        }
        
        /* Handle */
        table.striped-table tbody::-webkit-scrollbar-thumb {
            background: #666; /* Thumb color */
        }
        
        /* Handle on hover */
        table.striped-table tbody::-webkit-scrollbar-thumb:hover {
            background: #666; /* Thumb color on hover */
        }

        table.striped-table thead, table.striped-table tfoot, table.striped-table tbody tr {
            display: table;
            width: 100%;
            table-layout: fixed;
        }

        table.striped-table thead {
            background-color: #002147;
            color: white;
        }

        table.striped-table tfoot {
            background-color: #ACACAC;
            color: #1b1b1b;
        }

        table.striped-table th, table.striped-table td {
            border: 1px solid #ddd;
            padding-left: 8px;
            padding-top: 5px;
            padding-right: 8px;
            padding-bottom: 5px;
            text-align: left;
        }

        table.striped-table tbody tr:nth-child(even) {
            background-color: #f2f2f2;
        }

        table.striped-table tbody tr:hover {
            background-color: #ddd;
        }

        table.striped-table th {
            text-align: left;
            background-color: #002147;
            color: white;
        }

        .avatar-container {
            position: relative;
            width: 25px;
            height: 25px;
            left: 1px;
            border-radius: 50%;
            border: 1px solid #e5e4e2;
            background-color: white;
            padding: 2px;
            overflow: hidden;
            margin-top: 20px;
        }
        
        .avatar-container img {
            width: 90%;
            height: 90%;
            margin-top: 1.5px;
            margin-left: 1px;
            object-fit: contain;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            clip-path: inset(0 0 7px 0);
        }
        
        .loading-circle {
            position: absolute;
            top: calc(44% - 11px);
            left: 0.8px; /* Adjust left position to align with the avatar */
            width: 23px; /* Adjust the size of the loading circle */
            height: 23px; /* Adjust the size of the loading circle */
            border: 4px solid #007bff; /* Border color */ /* Top border color */
            border-radius: 50%; /* Make it a circle */
            animation: pulseLoadingCircle 1.4s infinite; /* Apply rotation animation */
        }
        
        @keyframes pulseLoadingCircle {
            0% { 
                transform: scale(1); /* Start with original size */
                opacity: 1; /* Start with full opacity */
            }
            100% { 
                transform: scale(1.2); /* Scale up to 120% of original size */
                opacity: 0; /* Fade out */
            }
        } 
        
        .container {
            height: 45px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: flex-start;
            margin-left: 5px;
            margin-bottom: 3px;
        }
        
        .username {
            font-family: 'Arial', sans-serif;
            font-size: 25px;
            display: flex;
            margin-left: 0px;
            height: 25px;
            align-items: baseline;
            justify-content: center;
            text-align: center;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.1);
        }
        
        .username .e, .username .zee {
            background: linear-gradient(to top, #006ade 25%, #005CAD 75%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-size: 25px;
            margin-top: 1px;
            font-weight: bold;
        }
        
        .username .s, .username .hipping {
            background: linear-gradient(to top, #555555 25%, grey 75%);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-size: 20px;
            margin-top: 3px;
            font-weight: bold;
        }
        
        .bot-info {
            color: #009900;
            font-size: 10px;
            padding: 2px 1px;
            margin-top: 3px;
        }

        .username span {
            transition: all 0.3s ease-in-out;
        }
        
        .username span:hover {
            transform: translateY(-2px);
            text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.2);
        }

    </style>
</head>
<body>
    <h1 style="text-align: left; display: flex; background-color: #fefefa; align-items: center; margin-top: 0px; height: 35px; padding: 15px; padding-left: 10px;">
        <div class="image-container">
            <a id="imageLink">
                <div id="modalPopup" class="modal-2">
                    <span class="close-2" onclick="closeModal()">&times;</span>
                    <div class="modal-content-2">
                        <img id="modalImage" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo">
                    </div>
                    <div class="header-box-2">
                        <h2>EzeeBot</h2>
                    </div>
                </div>
                <div id = "dp" title="EzeeBot" style="width: 40px; cursor: pointer; height: 40px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 9px 0);">
                </div>
            </a>
        </div>   
        <button id="customButton" title="HOME">
            <div class="button-text">
            <i class="fas fa-home"></i>
            <div>
        </button>                                   
        <div class="container">
            <div class="username">
                <span class="e">Ezee</span>
                <span class="s">SHIPPING</span>
            </div>
            <div class="bot-info">ChatBot &nbsp;|&nbsp;  ChatGPT</div>
        </div>
    </h1>  
    <div id="loading-line"></div>

    <div id="main-container" style="position: relative; margin-top: -20px; height: calc(103vh - 80px);">
        <div id="chat-container" style="position: absolute; top: 0; left: 0; right: 0; bottom: 60px; overflow-y: auto;">
            <div id="message-container">
                <!-- Chat messages go here -->
            </div>
        </div>  
        <button id="mydownButton">&#x2193;</button>  
    </div>        

    <div id="footer" style="background-color: white; height: 35px; position: fixed; bottom: 0;">
        <form id="input-form" style="background-color: white; width: 100%; height: 30px; box-shadow: 0px -2px 4px rgba(0, 0, 0, 0.1);">
            <div style=" width: 100%; margin-left: 10px; margin-right: 10px; margin-top: 8px; display: flex;">
                <input type="text" id="user-input" placeholder="Interact with EzeeBot..." style="flex: 1; height: 30px;">
                <label id="img-click" for="image-upload" style="cursor: pointer; margin: 0; display: none;">
                    <i class="fas fa-image" style="font-size: 24px; color: #555; margin-right: 30px; margin-top: 5px;"></i>
                </label>
                <input type="file" id="image-upload" accept="image/*,application/pdf" style="display: none;">
            </div>            
        </form>
    </div>   

    <script>
        document.getElementById('user-input').addEventListener('keypress', function(event) {
            if (event.shiftKey && event.keyCode === 13) {
                event.preventDefault();
                this.value += '\n';
            }
        });

        let isImageSelected = false;

        var clk = document.getElementById('img-click')

        function imgQuestions() {
            var tagsDiv = document.getElementById('patterns');
                if (tagsDiv) {
                    tagsDiv.parentNode.removeChild(tagsDiv);
                }
                var responseHTML = `Please upload the <b>PDF / Image</b> that you want to be analyzed.`
                var typingSpeed = 1e-15;
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 22px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat typing10" style="line-height: 1.5;"><div class="bot-message-img">`;
                chatContainer.innerHTML += botMessageHTML;
                var currentTime = new Date().toLocaleTimeString();
                var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

                function typeWriter() {
                    var botMessageElement = chatContainer.querySelector('.bot-message-chat.typing10');
                    botMessageElement.innerHTML = responseHTML.substring(0, index);
                    index++;
                    
                    if (index <= responseHTML.length) {
                        setTimeout(typeWriter, typingSpeed * 1000);
                        scrollToBottom();
                    } else {
                        botMessageElement.classList.remove('typing10');
                        chatContainer.innerHTML += botTimeHTML;
                        scrollToBottom();
                        handleUserInput(formData);
                    }
                }
                    
                var index = 0;
                    
                typeWriter();
            var imageUploadElement = document.getElementById('image-upload');
            imageUploadElement.click();
            imageUploadElement.addEventListener('change', function() {
            const file = event.target.files[0];
            if (file) {
                    console.log('yessss');
                    isImageSelected = true;
                    const formData = new FormData();
                    formData.append('image', file);
    
                    var tagsDiv = document.getElementById('tags');
                    if (tagsDiv) {
                        tagsDiv.parentNode.removeChild(tagsDiv);
                    }
                    var randomDiv = document.getElementById('random-questions');
                    if (randomDiv) {
                        randomDiv.parentNode.removeChild(randomDiv);
                    }
                    var reader = '';
                    reader = new FileReader();
                    reader.onload = function(event) {
                        var mesCon = document.getElementsByClassName("message-container-start");
                        if (mesCon.length > 0) {
                            console.log("is here");
                            for (var i = mesCon.length - 1; i >= 0; i--) {
                                mesCon[i].parentNode.removeChild(mesCon[i]);
                            }
                        } else {
                            console.log("is not here");
                        }
                        var mesCon2 = document.getElementsByClassName("bot-message-chat-top");
                        if (mesCon2.length > 0) {
                            console.log("is here");
                            for (var i = mesCon2.length - 1; i >= 0; i--) {
                                mesCon2[i].parentNode.removeChild(mesCon2[i]);
                            }
                        } else {
                            console.log("is not here");
                        }
                        if (file.type.startsWith('image/')) {
                            userMessageHTML = `
                                <div class="message-container">
                                    <div class="user-message-img">
                                        <img src="${event.target.result}" alt="User Image" style="width: 200px; height: auto; cursor: pointer;" onclick="openModalimg('${event.target.result}')">
                                    </div>
                                </div>
                            `;
                        } else if (file.type === 'application/pdf') {
                            userMessageHTML = `
                                <div class="message-container">
                                    <div class="user-message-pdf" style="background-color: #007bff; padding: 5px; border-radius: 5px;">
                                        <i class="fas fa-file-pdf" style="padding-right: 5px; font-size: 34px;"></i>
                                        <a href="${event.target.result}" target="_blank" style="color: white; text-decoration: none; font-weight: bold;">
                                            ${file.name}<br>
                                            <span style="font-size: 10px; bottom: 30px; ">(${formatFileSize(file.size)})</span>
                                        </a>
                                    </div>
                                </div>
                            `;
                        }
                        chatContainer.innerHTML += userMessageHTML;
                        scrollToBottom();
                        if (file.type.startsWith('image/')) {
                           var fileName = "image";
                        } else if (file.type.startsWith('application/pdf')) {
                            var fileName = "pdf";
                         }
                         const fileName2 = file.name.replace(/\.(pdf|jpg|png|jpeg)$/i, '');
                        var responseHTML = `Ask me anything about the <b>${fileName}</b>(${fileName2}), I'll use my AI to answer them.`
                            var typingSpeed = 1e-15;
                            var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 22px;">
                                <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                            </div></div><div class="bot-message-chat typing10" style="line-height: 1.5;"><div class="bot-message-img">`;
                            chatContainer.innerHTML += botMessageHTML;
                            var currentTime = new Date().toLocaleTimeString();
                            var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

                            function typeWriter() {
                                var botMessageElement = chatContainer.querySelector('.bot-message-chat.typing10');
                                botMessageElement.innerHTML = responseHTML.substring(0, index);
                                index++;
                                
                                if (index <= responseHTML.length) {
                                    setTimeout(typeWriter, typingSpeed * 1000);
                                    scrollToBottom();
                                } else {
                                    botMessageElement.classList.remove('typing10');
                                    chatContainer.innerHTML += botTimeHTML;
                                    scrollToBottom();
                                    handleUserInput(formData);
                                }
                            }
                                
                            var index = 0;
                                
                            typeWriter();     
                    };
                    reader.onerror = function(event) {
                        console.error("FileReader error:", event.target.error);
                    };
                    reader.readAsDataURL(file);
                    scrollToBottom();
                }
            });
        }

        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function openModalimg(imageUrl) {
            console.log('opened');
            var modalContainer = document.createElement('div');
            modalContainer.classList.add('modal');

            var modalContent = document.createElement('div');
            modalContent.classList.add('modal-content');

            var image = document.createElement('img');
            image.src = imageUrl;
            image.alt = 'User Image';

            modalContent.appendChild(image);

            modalContainer.appendChild(modalContent);

            document.body.appendChild(modalContainer);

            modalContainer.addEventListener('click', function(event) {
                if (event.target === modalContainer) {
                    closeModalimg(modalContainer);
                }
            });

            image.addEventListener('click', function() {
                closeModalimg(modalContainer);
            });
        }

        function closeModalimg(modal) {
            document.body.removeChild(modal);
        }

        function handleUserInput(formData) {
            const userInputElement = document.getElementById('user-input');
            userInputElement.focus();

            userInputElement.addEventListener('change', function onChange(event) {
                var userInput = userInputElement.value.trim();
                sendUserMessageBooking(userInput);
                if (userInput) {
                    console.log('user: ',userInput);
                    formData.append('userText', userInput);
                    console.log(formData);
                    typingMessage();
                    const uri = '/img';

                    fetch(uri, {
                        method: 'POST',
                        body: formData
                    })
                    .then(response => {
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        return response.json();
                    })
                    .then(data => {
                        console.log('Success:', data);
                        if (data.generated_content) {
                            var responseMarkdown = data.generated_content;
                            var converter = new showdown.Converter();
                            var responseHTML = converter.makeHtml(responseMarkdown);
                            var typingSpeed = 1e-15;
                            var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 22px;">
                                <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                            </div></div><div class="bot-message-chat-3 typing2" style="line-height: 1.5;"><div class="bot-message-img">`;
                            chatContainer.innerHTML += botMessageHTML;
                            var currentTime = new Date().toLocaleTimeString();
                            var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

                            function typeWriter() {
                                var botMessageElement = chatContainer.querySelector('.bot-message-chat-3.typing2');
                                var words = responseHTML.split(' ');
                                var currentText = words.slice(0, index).join(' ');
                                botMessageElement.innerHTML = currentText;
                                index++;  
                                
                                if (index <= words.length) {
                                    setTimeout(typeWriter, typingSpeed * 1000);
                                    scrollToBottom();
                                } else {
                                    botMessageElement.classList.remove('typing2');
                                    scrollToBottom();
                                    chatContainer.innerHTML += botTimeHTML;
                                    // Ask for user input again
                                    formData.delete('userText');
                                    userInput = '';
                                    userInputElement.removeEventListener('change', onChange);
                                    handleUserInput(formData); // Focus on input field
                                }
                            }
                                
                            var index = 0;
                                
                            typeWriter();
                        } else {
                            var errorMessageHTML = `
                                <div class="message-container">
                                    <div class="bot-message">City not found. Please check the spelling and try again.</div>
                                </div>
                            `;
                            chatContainer.innerHTML += errorMessageHTML;
                            scrollToBottom();
                        }
                        closeType();
                    })
                    .catch(error => {
                        console.error('Error:', error);
                        var errorMessageHTML = `
                            <div class="message-container">
                                <div class="bot-message">An error occurred while processing your request. Please try again later.</div>
                            </div>
                        `;
                        chatContainer.innerHTML += errorMessageHTML;
                        closeType();
                        scrollToBottom();
                    });
                } else {
                    console.log('User input is empty');
                }
            });
        }

        function handleRegularInput(userInput) {
            console.log('Handling regular input:', userInput);
            sendUserMessage(userInput);
        }

        var downButton = document.getElementById('mydownButton');
        downButton.style.display = "block";

        function scrollToBottomIfNeeded() {
            var chatContainer = document.getElementById("chat-container");
            var isAtBottom = chatContainer.scrollHeight - chatContainer.clientHeight <= chatContainer.scrollTop + 100;
        
            if (!isAtBottom) {
                downButton.style.display = "block";
            } else {
                downButton.style.display = "none";
            }
        }        

        setInterval(scrollToBottomIfNeeded, 100);

        function customButtonClick2() {
            console.log('clicked');
            scrollToBottom();
        }
        
        document.addEventListener("DOMContentLoaded", function() {
            var parentElement = document.body;
            parentElement.addEventListener("click", function(event) {
                if (event.target.id === "mydownButton") {
                    customButtonClick2();
                }
            });
        });

        var modal = document.getElementById("modalPopup");

        var img = document.getElementById("thumbnail");
        var modalImg = document.getElementById("modalImage");
        img.onclick = function(){
            modal.style.display = "block";
            modalImg.src = this.src;
        }

        var span = document.getElementsByClassName("close-2")[0];

        function closeModal() {
            modal.style.display = "none";
        }  

        document.addEventListener('keydown', function(event) {
            if ((event.ctrlKey || event.metaKey) && event.key === 'q') {
                var button = document.getElementById('customButton');
                button.click();
            }
        });
        
        function customButtonClick() {
            fetch('/chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    user_input: {
                        'general': "refresh",
                        'current_date': formattedDate,
                        'tenantid': tenantid,
                        'officeid': officeid,
                        'userid': userid
                    }
                }),
            })
            var chatContainer = document.getElementById("chat-container");
            var h1 = document.querySelector('h1');
        
            if (chatContainer) {
                chatContainer.style.display = 'none';
                h1.classList.add('show-after');
                location.reload();
            } else {
                location.reload();
            }
        }        

        document.getElementById("customButton").addEventListener("click", customButtonClick);

        function refreshScreen() {
            var inputForm = document.getElementById("user-input");
            inputForm.style.display = 'block';
            var userInputElement = document.getElementById('user-input');
            if (userInputElement._listener) {
                userInputElement.removeEventListener('keypress', userInputElement._listener);
            }
        }

        var chatContainer = document.getElementById('chat-container');
        var tags = {{ tags | tojson }};
        var patternsByTag = {{ patterns_by_tag | tojson }};
        var inputData = {{ input_data | tojson }};
        var randomQs = {{ randomQs | tojson }};

        var tenantid = inputData.tenantid;
        var environment = inputData.environment;
        var ffrid = inputData.ffrid;
        var userid2 = inputData.userid2;
        var trpid = inputData.trpid;
        var chaid = inputData.chaid;
        var officeid = inputData.officeid;
        var userid = inputData.userid;
        var now = new Date();
        var year = now.getFullYear();
        var month = ('0' + (now.getMonth() + 1)).slice(-2);
        var day = ('0' + now.getDate()).slice(-2);
        var hours = ('0' + now.getHours()).slice(-2);
        var minutes = ('0' + now.getMinutes()).slice(-2);

        var formattedDate = year + '-' + month + '-' + day + ' ' + hours + ':' + minutes;

        document.getElementById('main-container').style.display = 'block';

        function capitalizeFirstLetter(string) {
            return string.charAt(0).toUpperCase() + string.slice(1).toLowerCase();
        }  
        
        function setHelpMessage2() {
            var userInput = document.getElementById('user-input');
            userInput.focus();
            scrollToBottom();
            console.log("Setting help message");
            var responseHTML = `Hi,&nbsp;${(userid ? "<b>" + capitalizeFirstLetter(userid) + "</b>" : "")}&nbsp;How can I assist you today?`;
            var botMessageHTML = `<div class="message-container-start"><div class="bot-avatar-start"><div id="dp" title="EzeeBot" style="width: calc(78px + 0.1vw); cursor: pointer; height: calc(78px + 0.1vw);; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 3px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 17px 0);"></div>
                </div></div><div class="bot-message-chat-top" style="opacity: 0;">${responseHTML}</div>`;
            chatContainer.innerHTML += botMessageHTML;
            console.log(randomQs);
        
            var botMessageElement = chatContainer.querySelector('.bot-message-chat-top');
            setTimeout(function () {
                botMessageElement.style.opacity = 1;
            }, 20000);
        
            var currentTime = new Date().toLocaleTimeString();
            var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
            var iconClasses = {
                'Sales': 'fas fa-dollar-sign',
                'Documentation / Operation': 'fas fa-calendar-check',
                'Accounts': 'fas fa-chart-line',
                'Search Engine': 'fas fa-search',
                'AI - Powered Pdf / Image processing': 'fas fa-file-pdf'
            };
            
            var tagsHTML = tags.map(function (tag) {
                var trimmedTag = tag.trim();
                var normalizedTag = trimmedTag.toLowerCase();
                var buttonClass = normalizedTag === 'primary' ? 'button-primary' : 'button-secondary';

                var iconClass = iconClasses[Object.keys(iconClasses).find(key => key.toLowerCase() === normalizedTag)] || 'fas fa-question';
                
                return `<button class="button ${buttonClass}" onclick="selectTag('${trimmedTag}')">
                    <span class="button-text">
                        <i class="${iconClass}"></i>&nbsp;${trimmedTag}
                    </span>
                </button>`;
            }).join('');
            
            var randomQsHTML = randomQs.map(function(question) {
                return `<button class="button button-secondary" onclick="sendUserMessage('${question}')">
                    <span class="button-text">
                        ${capitalizeFirstLetter(question)}
                    </span>
                    </button>`;
            }).join('');
            
            chatContainer.innerHTML += '<div id="tags">' + tagsHTML + '</div>';
            chatContainer.innerHTML += '<div id="random-questions">' + randomQsHTML + '</div>';
            scrollToBottom();
        }                

        setHelpMessage2();

        function label(message) {
            var enquiryLabel = document.getElementById("enquirylabel");
            enquiryLabel.textContent = "ENTER THE " + message;

            var enqnumberContainer = document.getElementById("enqnumberContainer");
            enqnumberContainer.innerHTML = "";
        
            console.log(message);
        
            if (message.toLowerCase() === "shipment type") {
                createSelect("select", ["EXP_SEA_FCL", "EXP_SEA_LCL", "EXP_AIR", "IMP_SEA_FCL", "IMP_SEA_LCL", "IMP_AIR"]);
            } else if (message.toLowerCase() === "enquiry prospect") {
                createSelect("select", ["HOT", "WARM", "COLD"]);
            } else if (message.toLowerCase() === "shipment term") {
                createSelect("select", ["FOB", "CIF", "CI", "EXW", "FCA", "FAS", "CFR", "CPT", "CIP", "DAT", "DAP", "DDP"]);
            } else if (message.toLowerCase() === "status") {
                createSelect("select", ["BOOKING CREATED", "CANCELED", "OPEN"]);
            } else if (message.toLowerCase() === "quotation sent") {
                createSelect("select", ["ALL", "YES", "NO"]);
            } else if (message.toLowerCase() === "financial year") {
                createSelect("select", ["2017-18", "2018-19", "2019-20", "2020-21", "2021-22", "2022-23", "2023-24"]);
            } else if (message.toLowerCase() === "template") {
                createSelect("select", ["ENQTEST"]);
            } else if (message.toLowerCase() === "from date") {
                createInput("datetime-local");
            } else if (message.toLowerCase() === "to date") {
                createInput("datetime-local");
            } else if (message.toLowerCase() === "domestic/overseas") {
                createSelect("select", ["BOTH", "OVERSEAS", "DOMESTIC"]);
            } else if (message.toLowerCase() === "lead source") {
                createSelect("select", ["CUSTOMER", "INTER", "LS"]);
            } else if (message.toLowerCase() === "country") {
                createSelect("select", [
                "Afghanistan", "Albania", "Algeria", "Andorra", "Angola", "Antigua and Barbuda", "Argentina", "Armenia", "Australia", "Austria",
                "Azerbaijan", "Bahamas", "Bahrain", "Bangladesh", "Barbados", "Belarus", "Belgium", "Belize", "Benin", "Bhutan",
                "Bolivia", "Bosnia and Herzegovina", "Botswana", "Brazil", "Brunei", "Bulgaria", "Burkina Faso", "Burundi", "Cabo Verde", "Cambodia",
                "Cameroon", "Canada", "Central African Republic", "Chad", "Chile", "China", "Colombia", "Comoros", "Congo, Democratic Republic of the", "Congo, Republic of the",
                "Costa Rica", "Cote d'Ivoire", "Croatia", "Cuba", "Cyprus", "Czech Republic", "Denmark", "Djibouti", "Dominica", "Dominican Republic",
                "East Timor (Timor-Leste)", "Ecuador", "Egypt", "El Salvador", "Equatorial Guinea", "Eritrea", "Estonia", "Eswatini", "Ethiopia", "Fiji",
                "Finland", "France", "Gabon", "Gambia", "Georgia", "Germany", "Ghana", "Greece", "Grenada", "Guatemala",
                "Guinea", "Guinea-Bissau", "Guyana", "Haiti", "Honduras", "Hungary", "Iceland", "India", "Indonesia", "Iran",
                "Iraq", "Ireland", "Israel", "Italy", "Jamaica", "Japan", "Jordan", "Kazakhstan", "Kenya", "Kiribati",
                "Korea, North", "Korea, South", "Kosovo", "Kuwait", "Kyrgyzstan", "Laos", "Latvia", "Lebanon", "Lesotho", "Liberia",
                "Libya", "Liechtenstein", "Lithuania", "Luxembourg", "Madagascar", "Malawi", "Malaysia", "Maldives", "Mali", "Malta",
                "Marshall Islands", "Mauritania", "Mauritius", "Mexico", "Micronesia", "Moldova", "Monaco", "Mongolia", "Montenegro", "Morocco",
                "Mozambique", "Myanmar (Burma)", "Namibia", "Nauru", "Nepal", "Netherlands", "New Zealand", "Nicaragua", "Niger", "Nigeria",
                "North Macedonia", "Norway", "Oman", "Pakistan", "Palau", "Panama", "Papua New Guinea", "Paraguay", "Peru", "Philippines",
                "Poland", "Portugal", "Qatar", "Romania", "Russia", "Rwanda", "Saint Kitts and Nevis", "Saint Lucia", "Saint Vincent and the Grenadines", "Samoa",
                "San Marino", "Sao Tome and Principe", "Saudi Arabia", "Senegal", "Serbia", "Seychelles", "Sierra Leone", "Singapore", "Slovakia", "Slovenia",
                "Solomon Islands", "Somalia", "South Africa", "South Sudan", "Spain", "Sri Lanka", "Sudan", "Suriname", "Sweden", "Switzerland",
                "Syria", "Taiwan", "Tajikistan", "Tanzania", "Thailand", "Togo", "Tonga", "Trinidad and Tobago", "Tunisia", "Turkey",
                "Turkmenistan", "Tuvalu", "Uganda", "Ukraine", "United Arab Emirates", "United Kingdom", "United States", "Uruguay", "Uzbekistan", "Vanuatu",
                "Vatican City", "Venezuela", "Vietnam", "Yemen", "Zambia", "Zimbabwe"
            ]);
            } else if (message.toLowerCase() === "prospect") {
                createSelect("select", ["HOT", "WARM", "COLD"]);
            } else {
                console.log("Setting input type to text");
                createInput("text");
            }
        }
        
        function createSelect(type, options) {
            var selectElement = document.createElement(type);
            var enqnumberContainer = document.getElementById("enqnumberContainer");
            enqnumberContainer.appendChild(selectElement);
        
            if (type.toLowerCase() === "select") {
                var defaultOption = document.createElement("option");
                defaultOption.text = "---SELECT---";
                defaultOption.disabled = true;
                defaultOption.selected = true;

                selectElement.appendChild(defaultOption);

                if (options && options.length > 0) {
                    options.forEach(function(option) {
                        var optionElement = document.createElement("option");
                        optionElement.text = option;
                        selectElement.appendChild(optionElement);
                    });
                }
            }
        }     
        
        function createInput(type) {
            var inputElement = document.createElement("input");
            inputElement.type = type;
            inputElement.addEventListener("input", function() {
                console.log("Input entered:", inputElement.value);
            });
        
            var enqnumberContainer = document.getElementById("enqnumberContainer");
            enqnumberContainer.appendChild(inputElement);
        }     
        
        function selectTag(tag) {
            if (tag.toLowerCase() === 'search engine') {
                var tagsDiv = document.getElementById('tags');
                if (tagsDiv) {
                    tagsDiv.parentNode.removeChild(tagsDiv);
                }
                var randomDiv = document.getElementById('random-questions');
                if (randomDiv) {
                    randomDiv.parentNode.removeChild(randomDiv);
                }
                sendUserMessageBooking(tag);
                sendPattern2(tag);
            } else if (tag.toLowerCase() === 'ai - powered pdf / image processing') {
                var tagsDiv = document.getElementById('tags');
                if (tagsDiv) {
                    tagsDiv.parentNode.removeChild(tagsDiv);
                }
                var randomDiv = document.getElementById('random-questions');
                if (randomDiv) {
                    randomDiv.parentNode.removeChild(randomDiv);
                }
                sendUserMessageBooking(tag);
                var responseHTML = `How do you want your <b>PDF / Image</b> to be processed?`;
                var typingSpeed = 1e-15;
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat typingimgq">`;
                chatContainer.innerHTML += botMessageHTML;
                var currentTime = new Date().toLocaleTimeString();
                var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

                function typeWriter() {
                    var botMessageElement = chatContainer.querySelector('.bot-message-chat.typingimgq');
                    botMessageElement.innerHTML = responseHTML.substring(0, index);
                    index++;
                                        
                    if (index <= responseHTML.length) {
                        setTimeout(typeWriter, typingSpeed * 1000);
                        scrollToBottom();
                    } else {
                        botMessageElement.classList.remove('typingimgq');
                        scrollToBottom();
                        chatContainer.innerHTML += botTimeHTML;
                        var imgButton = `<div id="patterns">
                        <button onclick="sendUserMessageBooking(\'OCR Reading\'); frightAirWayBillextract()">OCR Reading</button>
                        <button onclick="sendUserMessageBooking(\'AI document analysis\'); imgQuestions()">AI document analysis</button>
                        </div>`
                        chatContainer.innerHTML += imgButton;
                    }
                }
                                        
                var index = 0;
                                        
                typeWriter();
                //frightAirWayBillextract();
            } else {
                var mesCon = document.getElementsByClassName("message-container-start");
                if (mesCon.length > 0) {
                    console.log("is here");
                    for (var i = mesCon.length - 1; i >= 0; i--) {
                        mesCon[i].parentNode.removeChild(mesCon[i]);
                    }
                } else {
                    console.log("is not here");
                }
                var mesCon2 = document.getElementsByClassName("bot-message-chat-top");
                if (mesCon2.length > 0) {
                    console.log("is here");
                    for (var i = mesCon2.length - 1; i >= 0; i--) {
                        mesCon2[i].parentNode.removeChild(mesCon2[i]);
                    }
                } else {
                    console.log("is not here");
                }
                var userMessageHTML = '<div class="message-container"><div class="user-message">' + tag + '</div></div>';
            chatContainer.innerHTML += userMessageHTML;
            scrollToBottom();
        
            var patterns = patternsByTag[tag];
            var patternsHTML = patterns.map(function(pattern) {
                var buttonClass = tag === 'primary' ? 'button-primary' : 'button-secondary';
                return '<button class="button ' + buttonClass + '" onclick="sendUserMessage(\'' + pattern + '\')">' + pattern + '</button>';
            }).join('');
            
            //var botMessageHTML = '<div class="message-container"><div class="bot-avatar"><img src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 30px; height: auto;"></div><div class="bot-message">How can I assist you with ' + "<b>" + tag.toLowerCase() + "</b>" +'?</div></div>';
            var responseHTML = `How can I assist you with <b> ${tag.toLowerCase()}</b>?`;
            var typingSpeed = 1e-15;
            var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
            </div></div><div class="bot-message-chat typing3">`;
            chatContainer.innerHTML += botMessageHTML;
            var currentTime = new Date().toLocaleTimeString();
            var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

            function typeWriter() {
                var botMessageElement = chatContainer.querySelector('.bot-message-chat.typing3');
                botMessageElement.innerHTML = responseHTML.substring(0, index);
                index++;
                                    
                if (index <= responseHTML.length) {
                    setTimeout(typeWriter, typingSpeed * 1000);
                    scrollToBottom();
                } else {
                    botMessageElement.classList.remove('typing');
                    scrollToBottom();
                    chatContainer.innerHTML += botTimeHTML;
                    chatContainer.innerHTML += '<div id="patterns">' + patternsHTML + '</div>';
                }
            }
                                    
            var index = 0;
                                    
            typeWriter();
        
            var tagsDiv = document.getElementById('tags');
            if (tagsDiv) {
                tagsDiv.parentNode.removeChild(tagsDiv);
            }
            var randomDiv = document.getElementById('random-questions');
            if (randomDiv) {
                randomDiv.parentNode.removeChild(randomDiv);
            }
        
            scrollToBottom();
            }
        }      

        function sendUserMessage(message) {
            var mesCon = document.getElementsByClassName("message-container-start");
                if (mesCon.length > 0) {
                    console.log("is here");
                    for (var i = mesCon.length - 1; i >= 0; i--) {
                        mesCon[i].parentNode.removeChild(mesCon[i]);
                    }
                } else {
                    console.log("is not here");
                }
                var mesCon2 = document.getElementsByClassName("bot-message-chat-top");
                if (mesCon2.length > 0) {
                    console.log("is here");
                    for (var i = mesCon2.length - 1; i >= 0; i--) {
                        mesCon2[i].parentNode.removeChild(mesCon2[i]);
                    }
                } else {
                    console.log("is not here");
                }
            if (message.toLowerCase() === "lead" || message.toLowerCase() === "enquiry" || message.toLowerCase() === "quotation" || message.toLowerCase() === "buying" || message.toLowerCase() === "selling" || message.toLowerCase() === "payments" || message.toLowerCase() === "receipts"){
                sendUserMessageBooking(message);
                var responseHTML = `In what method you want to continue in <b>${message.toLowerCase()}</b>?`;
                var typingSpeed = 1e-15;
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat typingimgq">`;
                chatContainer.innerHTML += botMessageHTML;
                var currentTime = new Date().toLocaleTimeString();
                var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

                function typeWriter() {
                    var botMessageElement = chatContainer.querySelector('.bot-message-chat.typingimgq');
                    botMessageElement.innerHTML = responseHTML.substring(0, index);
                    index++;
                                        
                    if (index <= responseHTML.length) {
                        setTimeout(typeWriter, typingSpeed * 1000);
                        scrollToBottom();
                    } else {
                        botMessageElement.classList.remove('typingimgq');
                        scrollToBottom();
                        chatContainer.innerHTML += botTimeHTML;
                        var imgButton = `<div id="patterns">
                            <button onclick="sendUserMessageBooking('Questions about ${message.toLowerCase()}'); send_inputs2('${message.toLowerCase()}')">Questions about ${message.toLowerCase()}</button>
                            <button onclick="sendUserMessageBooking('Select from ${message.toLowerCase()} input choices'); sendPattern('${message.toLowerCase()}')">Select from ${message.toLowerCase()} input choices</button>
                        </div>`;        
                        chatContainer.innerHTML += imgButton;
                        scrollToBottom();
                    }
                }
                                        
                var index = 0;
                                        
                typeWriter();
            } else {
                const userInputElement = document.getElementById('user-input');
                userInputElement.value = "";
                var userMessageHTML = '<div class="message-container"><div class="user-message">' + capitalizeFirstLetter(message) + '</div></div>';
                chatContainer.innerHTML += userMessageHTML;
                var tagsDiv = document.getElementById('tags');
                    if (tagsDiv) {
                        tagsDiv.parentNode.removeChild(tagsDiv);
                    }
                var patternsDiv = document.getElementById('patterns');
                if (patternsDiv) {
                    patternsDiv.parentNode.removeChild(patternsDiv);
                }
                var randomDiv = document.getElementById('random-questions');
                if (randomDiv) {
                    randomDiv.parentNode.removeChild(randomDiv);
                }
                scrollToBottom();
                sendPattern(message);
            }
        }

        function sendUserMessage2(message) {
            var mesCon = document.getElementsByClassName("message-container-start");
                if (mesCon.length > 0) {
                    console.log("is here");
                    for (var i = mesCon.length - 1; i >= 0; i--) {
                        mesCon[i].parentNode.removeChild(mesCon[i]);
                    }
                } else {
                    console.log("is not here");
                }
                var mesCon2 = document.getElementsByClassName("bot-message-chat-top");
                if (mesCon2.length > 0) {
                    console.log("is here");
                    for (var i = mesCon2.length - 1; i >= 0; i--) {
                        mesCon2[i].parentNode.removeChild(mesCon2[i]);
                    }
                } else {
                    console.log("is not here");
                }
            if (message.toLowerCase() === "ffrbooking" || message.toLowerCase() === "billoflad" || message.toLowerCase() === "awb" || message.toLowerCase() === "custombooking" || message.toLowerCase() === "trpbooking"){
                if (message.toLowerCase() === "ffrbooking") {
                    sendUserMessageBooking('bookings');
                    var responseHTML = `In what method you want to continue in <b>bookings</b>?`;
                }
                else if (message.toLowerCase() === "billoflad") {
                    sendUserMessageBooking('bill of lading');
                    var responseHTML = `In what method you want to continue in <b>bill of lading</b>?`;
                }
                else if (message.toLowerCase() === "awb") {
                    sendUserMessageBooking('air way bills');
                    var responseHTML = `In what method you want to continue in <b>air way bills</b>?`;
                }
                else if (message.toLowerCase() === "custombooking") {
                    sendUserMessageBooking('bookings');
                    var responseHTML = `In what method you want to continue in <b>bookings</b>?`;
                }
                else if (message.toLowerCase() === "trpbooking") {
                    sendUserMessageBooking('bookings');
                    var responseHTML = `In what method you want to continue in <b>bookings</b>?`;
                }
                var typingSpeed = 1e-15;
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat typingimgq">`;
                chatContainer.innerHTML += botMessageHTML;
                var currentTime = new Date().toLocaleTimeString();
                var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

                function typeWriter() {
                    var botMessageElement = chatContainer.querySelector('.bot-message-chat.typingimgq');
                    botMessageElement.innerHTML = responseHTML.substring(0, index);
                    index++;
                                        
                    if (index <= responseHTML.length) {
                        setTimeout(typeWriter, typingSpeed * 1000);
                        scrollToBottom();
                    } else {
                        botMessageElement.classList.remove('typingimgq');
                        scrollToBottom();
                        chatContainer.innerHTML += botTimeHTML;
                        if (message.toLowerCase() === "ffrbooking") {
                            var imgButton = `<div id="patterns">
                                <button onclick="sendUserMessageBooking('Questions about bookings'); send_inputs2('${message.toLowerCase()}')">Questions about bookings</button>
                                <button onclick="sendUserMessageBooking('Select from bookings input choices'); frightBooking('${message.toLowerCase()}')">Select bookings input choices</button>
                            </div>`;     
                        }
                        else if (message.toLowerCase() === "billoflad") {
                            var imgButton = `<div id="patterns">
                                <button onclick="sendUserMessageBooking('Questions about bill of lading'); send_inputs2('${message.toLowerCase()}')">Questions about bill of lading</button>
                                <button onclick="sendUserMessageBooking('Select from bill of lading input choices'); frightBillOfLading('${message.toLowerCase()}')">Select bill of lading input choices</button>
                            </div>`;     
                        }
                        else if (message.toLowerCase() === "awb") {
                            var imgButton = `<div id="patterns">
                                <button onclick="sendUserMessageBooking('Questions about air way bills'); send_inputs2('${message.toLowerCase()}')">Questions about air way bills</button>
                                <button onclick="sendUserMessageBooking('Select from air way bills input choices'); frightAirWayBill('${message.toLowerCase()}')">Select air way bills input choices</button>
                            </div>`;     
                        }
                        else if (message.toLowerCase() === "custombooking") {
                            var imgButton = `<div id="patterns">
                                <button onclick="sendUserMessageBooking('Questions about bookings'); send_inputs2('${message.toLowerCase()}')">Questions about bookings</button>
                                <button onclick="sendUserMessageBooking('Select from bookings input choices'); customBooking('${message.toLowerCase()}')">Select bookings input choices</button>
                            </div>`;     
                        }
                        else if (message.toLowerCase() === "trpbooking") {
                            var imgButton = `<div id="patterns">
                                
                                <button onclick="sendUserMessageBooking('Select from bookings input choices'); trpBooking('${message.toLowerCase()}')">Select bookings input choices</button>
                            </div>`; 
                            //<button onclick="sendUserMessageBooking('Questions about bookings'); send_inputs2('${message.toLowerCase()}')">Questions about bookings</button>    
                        } 
                        chatContainer.innerHTML += imgButton;
                        scrollToBottom();
                    }
                }
                                        
                var index = 0;
                                        
                typeWriter();
            } else {
                const userInputElement = document.getElementById('user-input');
                userInputElement.value = "";
                var userMessageHTML = '<div class="message-container"><div class="user-message">' + capitalizeFirstLetter(message) + '</div></div>';
                chatContainer.innerHTML += userMessageHTML;
                var tagsDiv = document.getElementById('tags');
                    if (tagsDiv) {
                        tagsDiv.parentNode.removeChild(tagsDiv);
                    }
                var patternsDiv = document.getElementById('patterns');
                if (patternsDiv) {
                    patternsDiv.parentNode.removeChild(patternsDiv);
                }
                var randomDiv = document.getElementById('random-questions');
                if (randomDiv) {
                    randomDiv.parentNode.removeChild(randomDiv);
                }
                scrollToBottom();
                sendPattern(message);
            }
        }

        function typingMessage() {
            // var botMessageHTML = `
            // <div class="message-container">
            //     <div class="bot-avatar">
            //         <div class="loading-circle"></div>
            //         <div id="dp" class="avatar-container">
            //             <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo">
            //         </div>
            //     </div>
            //     <div class="bot-message-chat">
            //         <span class="dot-pulse"></span><span class="dot-pulse"></span><span class="dot-pulse"></span>
            //     </div>
            // </div>`;

            var botMessageHTML = `
                <div class="message-container">
                    <div class="bot-avatar">
                        <div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                            <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                        </div>
                    </div>
                    <div class="bot-message-chat">
                        <span class="dot-pulse"></span><span class="dot-pulse"></span><span class="dot-pulse"></span>
                    </div>
                </div>`;
        
            chatContainer.innerHTML += botMessageHTML;
            scrollToBottom();
            return botMessageHTML;
        }               
        
        function closeType() {
            var elements = document.getElementsByClassName("message-container");
            if (elements.length > 0) {
                elements[elements.length - 2].remove();
            }
        }               

        function sendUserMessageBooking(message) {
            var mesCon = document.getElementsByClassName("message-container-start");
                if (mesCon.length > 0) {
                    console.log("is here");
                    for (var i = mesCon.length - 1; i >= 0; i--) {
                        mesCon[i].parentNode.removeChild(mesCon[i]);
                    }
                } else {
                    console.log("is not here");
                }
                var mesCon2 = document.getElementsByClassName("bot-message-chat-top");
                if (mesCon2.length > 0) {
                    console.log("is here");
                    for (var i = mesCon2.length - 1; i >= 0; i--) {
                        mesCon2[i].parentNode.removeChild(mesCon2[i]);
                    }
                } else {
                    console.log("is not here");
                }
            const userInputElement = document.getElementById('user-input');
            userInputElement.value = "";
            var userMessageHTML = '<div class="message-container"><div class="user-message">' + capitalizeFirstLetter(message) + '</div></div>';
            chatContainer.innerHTML += userMessageHTML;
            var tagsDiv = document.getElementById('patterns');
                if (tagsDiv) {
                    tagsDiv.parentNode.removeChild(tagsDiv);
                }
            var randomDiv = document.getElementById('random-questions');
            if (randomDiv) {
                randomDiv.parentNode.removeChild(randomDiv);
            }
            console.log(message)
        }

        document.getElementById('input-form').addEventListener('submit', function(event) {
            event.preventDefault(); 
            var userInput = document.getElementById('user-input').value;
            document.getElementById('user-input').value = '';
            //sendUserMessage(userInput); 
            if (!isImageSelected) {
                handleRegularInput(userInput);
            }
        })

        function sendCheckboxValueslead() {

            selectedPatterns = [];

            var checkboxes = document.querySelectorAll('.checkbox-group input[type="checkbox"]');
        
            checkboxes.forEach(function(checkbox) {
                if (checkbox.checked) {
                    var labelText = document.querySelector('label[for="' + checkbox.id + '"]').textContent.trim();
                    selectedPatterns.push(labelText);
                }
            });
        
            console.log(selectedPatterns);
            simpleUserMessage3(selectedPatterns);
            lead(selectedPatterns);

            checkboxes.forEach(function(checkbox) {
                checkbox.checked = false;
            });
            var botMessageCheck = document.querySelector('.bot-message-check-lead');
            if (botMessageCheck) {
                botMessageCheck.remove();
            }
        }

        function sendCheckboxValuesfright() {

            selectedPatterns = [];

            var checkboxes = document.querySelectorAll('.checkbox-group input[type="checkbox"]');
        
            checkboxes.forEach(function(checkbox) {
                if (checkbox.checked) {
                    var labelText = document.querySelector('label[for="' + checkbox.id + '"]').textContent.trim();
                    selectedPatterns.push(labelText);
                }
            });
        
            console.log(selectedPatterns);
            simpleUserMessage3(selectedPatterns);
            askBookingNumberfright(selectedPatterns);

            checkboxes.forEach(function(checkbox) {
                checkbox.checked = false;
            });
            var botMessageCheck = document.querySelector('.bot-message-check-fright');
            if (botMessageCheck) {
                botMessageCheck.remove();
            }
        }

        function sendCheckboxValuesfrightBillOfLading() {

            selectedPatterns = [];

            var checkboxes = document.querySelectorAll('.checkbox-group input[type="checkbox"]');
        
            checkboxes.forEach(function(checkbox) {
                if (checkbox.checked) {
                    var labelText = document.querySelector('label[for="' + checkbox.id + '"]').textContent.trim();
                    selectedPatterns.push(labelText);
                }
            });
        
            console.log(selectedPatterns);
            simpleUserMessage3(selectedPatterns);
            askBookingNumberfrightBillOfLading(selectedPatterns);

            checkboxes.forEach(function(checkbox) {
                checkbox.checked = false;
            });
            var botMessageCheck = document.querySelector('.bot-message-check-frightBillOfLading');
            if (botMessageCheck) {
                botMessageCheck.remove();
            }
        }

        function sendCheckboxValuesfrightawb() {

            selectedPatterns = [];

            var checkboxes = document.querySelectorAll('.checkbox-group input[type="checkbox"]');
        
            checkboxes.forEach(function(checkbox) {
                if (checkbox.checked) {
                    var labelText = document.querySelector('label[for="' + checkbox.id + '"]').textContent.trim();
                    selectedPatterns.push(labelText);
                }
            });
        
            console.log(selectedPatterns);
            simpleUserMessage3(selectedPatterns);
            askBookingNumberfrightawb(selectedPatterns);

            checkboxes.forEach(function(checkbox) {
                checkbox.checked = false;
            });
            var botMessageCheck = document.querySelector('.bot-message-check-frightawb');
            if (botMessageCheck) {
                botMessageCheck.remove();
            }
        }

        function sendCheckboxValuesselling() {

            selectedPatterns = [];

            var checkboxes = document.querySelectorAll('.checkbox-group input[type="checkbox"]');
        
            checkboxes.forEach(function(checkbox) {
                if (checkbox.checked) {
                    var labelText = document.querySelector('label[for="' + checkbox.id + '"]').textContent.trim();
                    selectedPatterns.push(labelText);
                }
            });
        
            console.log(selectedPatterns);
            simpleUserMessage3(selectedPatterns);
            askBookingNumberselling(selectedPatterns);

            checkboxes.forEach(function(checkbox) {
                checkbox.checked = false;
            });
            var botMessageCheck = document.querySelector('.bot-message-check-buy');
            if (botMessageCheck) {
                botMessageCheck.remove();
            }
        }

        function sendCheckboxValuesbuying() {

            selectedPatterns = [];

            var checkboxes = document.querySelectorAll('.checkbox-group input[type="checkbox"]');
        
            checkboxes.forEach(function(checkbox) {
                if (checkbox.checked) {
                    var labelText = document.querySelector('label[for="' + checkbox.id + '"]').textContent.trim();
                    selectedPatterns.push(labelText);
                }
            });
        
            console.log(selectedPatterns);
            simpleUserMessage3(selectedPatterns);
            askBookingNumberbuying(selectedPatterns);

            checkboxes.forEach(function(checkbox) {
                checkbox.checked = false;
            });
            var botMessageCheck = document.querySelector('.bot-message-check-selling');
            if (botMessageCheck) {
                botMessageCheck.remove();
            }
        }

        function sendCheckboxValuesreceipts() {

            selectedPatterns = [];

            var checkboxes = document.querySelectorAll('.checkbox-group input[type="checkbox"]');
        
            checkboxes.forEach(function(checkbox) {
                if (checkbox.checked) {
                    var labelText = document.querySelector('label[for="' + checkbox.id + '"]').textContent.trim();
                    selectedPatterns.push(labelText);
                }
            });
        
            console.log(selectedPatterns);
            simpleUserMessage3(selectedPatterns);
            askBookingNumberreceipts(selectedPatterns);

            checkboxes.forEach(function(checkbox) {
                checkbox.checked = false;
            });
            var botMessageCheck = document.querySelector('.bot-message-check-receipts');
            if (botMessageCheck) {
                botMessageCheck.remove();
            }
        }

        function sendCheckboxValuespay() {

            selectedPatterns = [];

            var checkboxes = document.querySelectorAll('.checkbox-group input[type="checkbox"]');
        
            checkboxes.forEach(function(checkbox) {
                if (checkbox.checked) {
                    var labelText = document.querySelector('label[for="' + checkbox.id + '"]').textContent.trim();
                    selectedPatterns.push(labelText);
                }
            });
        
            console.log(selectedPatterns);
            simpleUserMessage3(selectedPatterns);
            askBookingNumberpay(selectedPatterns);

            checkboxes.forEach(function(checkbox) {
                checkbox.checked = false;
            });
            var botMessageCheck = document.querySelector('.bot-message-check-pay');
            if (botMessageCheck) {
                botMessageCheck.remove();
            }
        }

        function sendCheckboxValuescustom() {

            selectedPatterns = [];

            var checkboxes = document.querySelectorAll('.checkbox-group input[type="checkbox"]');
        
            checkboxes.forEach(function(checkbox) {
                if (checkbox.checked) {
                    var labelText = document.querySelector('label[for="' + checkbox.id + '"]').textContent.trim();
                    selectedPatterns.push(labelText);
                }
            });
        
            console.log(selectedPatterns);
            simpleUserMessage3(selectedPatterns);
            askBookingNumbercustom(selectedPatterns);

            checkboxes.forEach(function(checkbox) {
                checkbox.checked = false;
            });
            var botMessageCheck = document.querySelector('.bot-message-check-custom');
            if (botMessageCheck) {
                botMessageCheck.remove();
            }
        }

        function sendCheckboxValuestrp() {

            selectedPatterns = [];

            var checkboxes = document.querySelectorAll('.checkbox-group input[type="checkbox"]');
        
            checkboxes.forEach(function(checkbox) {
                if (checkbox.checked) {
                    var labelText = document.querySelector('label[for="' + checkbox.id + '"]').textContent.trim();
                    selectedPatterns.push(labelText);
                }
            });
        
            console.log(selectedPatterns);
            simpleUserMessage3(selectedPatterns);
            askBookingNumbertrp(selectedPatterns);

            checkboxes.forEach(function(checkbox) {
                checkbox.checked = false;
            });
            var botMessageCheck = document.querySelector('.bot-message-check-trpBooking');
            if (botMessageCheck) {
                botMessageCheck.remove();
            }
        }

        function sendCheckboxValuescustomSB() {

            selectedPatterns = [];

            var checkboxes = document.querySelectorAll('.checkbox-group input[type="checkbox"]');
        
            checkboxes.forEach(function(checkbox) {
                if (checkbox.checked) {
                    var labelText = document.querySelector('label[for="' + checkbox.id + '"]').textContent.trim();
                    selectedPatterns.push(labelText);
                }
            });
        
            console.log(selectedPatterns);
            simpleUserMessage3(selectedPatterns);
            askBookingNumbercustomSB(selectedPatterns);

            checkboxes.forEach(function(checkbox) {
                checkbox.checked = false;
            });
            var botMessageCheck = document.querySelector('.bot-message-check-customSB');
            if (botMessageCheck) {
                botMessageCheck.remove();
            }
        }

        function sendCheckboxValuescustomBE() {

            selectedPatterns = [];

            var checkboxes = document.querySelectorAll('.checkbox-group input[type="checkbox"]');
        
            checkboxes.forEach(function(checkbox) {
                if (checkbox.checked) {
                    var labelText = document.querySelector('label[for="' + checkbox.id + '"]').textContent.trim();
                    selectedPatterns.push(labelText);
                }
            });
        
            console.log(selectedPatterns);
            simpleUserMessage3(selectedPatterns);
            askBookingNumbercustomBE(selectedPatterns);

            checkboxes.forEach(function(checkbox) {
                checkbox.checked = false;
            });
            var botMessageCheck = document.querySelector('.bot-message-check-customBE');
            if (botMessageCheck) {
                botMessageCheck.remove();
            }
        }

        function sendCheckboxValuesenquiry() {

            selectedPatterns = [];

            var checkboxes = document.querySelectorAll('.checkbox-group input[type="checkbox"]');
        
            checkboxes.forEach(function(checkbox) {
                if (checkbox.checked) {
                    var labelText = document.querySelector('label[for="' + checkbox.id + '"]').textContent.trim();
                    selectedPatterns.push(labelText);
                }
            });
        
            console.log(selectedPatterns);
            simpleUserMessage3(selectedPatterns);
            enquiry(selectedPatterns);

            checkboxes.forEach(function(checkbox) {
                checkbox.checked = false;
            });
            var botMessageCheck = document.querySelector('.bot-message-check-enquiry');
            if (botMessageCheck) {
                botMessageCheck.remove();
            }
        }

        function sendCheckboxValuesquotation() {

            selectedPatterns = [];

            var checkboxes = document.querySelectorAll('.checkbox-group input[type="checkbox"]');
        
            checkboxes.forEach(function(checkbox) {
                if (checkbox.checked) {
                    var labelText = document.querySelector('label[for="' + checkbox.id + '"]').textContent.trim();
                    selectedPatterns.push(labelText);
                }
            });
        
            console.log(selectedPatterns);
            simpleUserMessage3(selectedPatterns);
            quotation(selectedPatterns);

            checkboxes.forEach(function(checkbox) {
                checkbox.checked = false;
            });
            var botMessageCheck = document.querySelector('.bot-message-check-quotation');
            if (botMessageCheck) {
                botMessageCheck.remove();
            }
        }

        function fromDateToDateCheck() {
            var fromDateCheckbox = document.getElementById("fromDateCheckbox");
            var toDateCheckbox = document.getElementById("toDateCheckbox");
        
            fromDateCheckbox.addEventListener("change", function() {
                if (fromDateCheckbox.checked) {
                    toDateCheckbox.checked = true;
                } else {
                    toDateCheckbox.checked = false;
                }
            });
        
            toDateCheckbox.addEventListener("change", function() {
                if (toDateCheckbox.checked) {
                    fromDateCheckbox.checked = true;
                } else {
                    fromDateCheckbox.checked = false;
                }
            });
        }

        function fromDateToDateCheck2() {
            var fromDateCheckbox = document.getElementById("bkfromDateCheckbox");
            var toDateCheckbox = document.getElementById("bktoDateCheckbox");
        
            fromDateCheckbox.addEventListener("change", function() {
                if (fromDateCheckbox.checked) {
                    toDateCheckbox.checked = true;
                } else {
                    toDateCheckbox.checked = false;
                }
            });
        
            toDateCheckbox.addEventListener("change", function() {
                if (toDateCheckbox.checked) {
                    fromDateCheckbox.checked = true;
                } else {
                    fromDateCheckbox.checked = false;
                }
            });
        }

        function directIndirect() {
            var indirectCheckbox = document.getElementById("indirectCheckbox");
            var directCheckbox = document.getElementById("directCheckbox");
        
            indirectCheckbox.addEventListener("change", function() {
                if (indirectCheckbox.checked) {
                    directCheckbox.checked = false;
                } else {
                    directCheckbox.checked = true;
                }
            });
        
            directCheckbox.addEventListener("change", function() {
                if (directCheckbox.checked) {
                    indirectCheckbox.checked = false;
                } else {
                    indirectCheckbox.checked = true;
                }
            });
        }

        function sendPattern(pattern) {
            if (pattern.toLowerCase() === 'lead') {
                var responseHTML = `What specific criteria are you looking to use in your <b>lead</b> search?`;
                var typingSpeed = 1e-15;
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat typinglead">`;
                chatContainer.innerHTML += botMessageHTML;
                var currentTime = new Date().toLocaleTimeString();
                var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

                function typeWriter() {
                    var botMessageElement = chatContainer.querySelector('.bot-message-chat.typinglead');
                    botMessageElement.innerHTML = responseHTML.substring(0, index);
                    index++;
                                        
                    if (index <= responseHTML.length) {
                        setTimeout(typeWriter, typingSpeed * 1000);
                        scrollToBottom();
                    } else {
                        botMessageElement.classList.remove('typing');
                        scrollToBottom();
                        chatContainer.innerHTML += botTimeHTML;
                        chatContainer.innerHTML += '<div class="bot-message-check-lead">'+
                            '<div id="patterns">' +
                                '<div class="checkbox-group">' +
                                    '<div class="column" style="float: left;">' +
                                        '<label for="leadcompanyCheckbox" class="checkbox-label"><input type="checkbox" id="leadcompanyCheckbox"> Company Name</label>' +
                                        '<label for="leadsalesCheckbox" class="checkbox-label"><input type="checkbox" id="leadsalesCheckbox"> Sales Executive</label>' +
                                    '</div>' +
                                    '<div class="column" style="float: left; margin-left: 10px;">' +
                                        '<label for="fromDateCheckbox" class="checkbox-label"><input type="checkbox" id="fromDateCheckbox"> From Date</label>' +
                                        '<label for="toDateCheckbox" class="checkbox-label"><input type="checkbox" id="toDateCheckbox"> To Date</label>' +
                                    '</div>' +
                                '</div>' +
                                '<button onclick="sendCheckboxValueslead()" style="width: 100%">Send</button>' +
                            '</div>'+
                        '</div>';
                        scrollToBottom();
                        fromDateToDateCheck();
                    }
                }
                                        
                var index = 0;
                                        
                typeWriter();                                                               
            } else if (pattern.toLowerCase() === 'enquiry') {
                var responseHTML = `What specific criteria are you looking to use in your <b>enquiry</b> search?`;
                var typingSpeed = 1e-15;
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat typingenq">`;
                chatContainer.innerHTML += botMessageHTML;
                var currentTime = new Date().toLocaleTimeString();
                var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

                function typeWriter() {
                    var botMessageElement = chatContainer.querySelector('.bot-message-chat.typingenq');
                    botMessageElement.innerHTML = responseHTML.substring(0, index);
                    index++;
                                        
                    if (index <= responseHTML.length) {
                        setTimeout(typeWriter, typingSpeed * 1000);
                        scrollToBottom();
                    } else {
                        botMessageElement.classList.remove('typing');
                        scrollToBottom();
                        chatContainer.innerHTML += botTimeHTML;
                        chatContainer.innerHTML += '<div class="bot-message-check-enquiry">'+
                            '<div id="patterns">' +
                                '<div class="checkbox-group">' +
                                    '<div class="column" style="float: left;">' +
                                        '<label for="enquiryenqnoCheckbox" class="checkbox-label"><input type="checkbox" id="enquiryenqnoCheckbox"> Enquiry Number </label>' +
                                        '<label for="enquirycontactnameCheckbox" class="checkbox-label"><input type="checkbox" id="enquirycontactnameCheckbox"> Contact Name </label>' +
                                        '<label for="enquirycompanyCheckbox" class="checkbox-label"><input type="checkbox" id="enquirycompanyCheckbox"> Company </label>' +
                                    '</div>' +
                                    '<div class="column" style="float: left; margin-left: 10px;">' +
                                        '<label for="fromDateCheckbox" class="checkbox-label"><input type="checkbox" id="fromDateCheckbox"> From Date </label>' +
                                        '<label for="toDateCheckbox" class="checkbox-label"><input type="checkbox" id="toDateCheckbox"> To Date </label>' +
                                    '</div>' +
                                '</div>' +
                                '<button onclick="sendCheckboxValuesenquiry()" style="width: 100%;">Send</button>' +
                            '</div>'+
                        '</div>';
                        scrollToBottom();
                        fromDateToDateCheck();
                    }
                }
                                        
                var index = 0;
                                        
                typeWriter();                                
            } else if (pattern.toLowerCase() === 'quotation') {
                var responseHTML = `What specific criteria are you looking to use in your <b>quotation</b> search?`;
                var typingSpeed = 1e-15;
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat typingquo">`;
                chatContainer.innerHTML += botMessageHTML;
                var currentTime = new Date().toLocaleTimeString();
                var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

                function typeWriter() {
                    var botMessageElement = chatContainer.querySelector('.bot-message-chat.typingquo');
                    botMessageElement.innerHTML = responseHTML.substring(0, index);
                    index++;
                                        
                    if (index <= responseHTML.length) {
                        setTimeout(typeWriter, typingSpeed * 1000);
                        scrollToBottom();
                    } else {
                        botMessageElement.classList.remove('typing');
                        scrollToBottom();
                        chatContainer.innerHTML += botTimeHTML;
                        chatContainer.innerHTML += '<div class="bot-message-check-quotation">'+
                            '<div id="patterns">' +
                                '<div class="checkbox-group">' +
                                    '<div class="column" style="float: left;">' +
                                        '<label for="quotationquonoCheckbox" class="checkbox-label"><input type="checkbox" id="quotationquonoCheckbox"> Quotation Number </label>' +
                                        '<label for="quotationquorefnoCheckbox" class="checkbox-label"><input type="checkbox" id="quotationquorefnoCheckbox"> Quotation Ref </label>' +
                                    '</div>' +
                                    '<div class="column" style="float: left; margin-left: 10px;">' +
                                        '<label for="quotationcontactnameCheckbox" class="checkbox-label"><input type="checkbox" id="quotationcontactnameCheckbox"> Contact Name </label>' +
                                        '<label for="quotationcompanyCheckbox" class="checkbox-label"><input type="checkbox" id="quotationcompanyCheckbox"> Company </label>' +
                                    '</div>' +
                                    '<div class="column" style="float: left; margin-left: 10px;">' +
                                        '<label for="fromDateCheckbox" class="checkbox-label"><input type="checkbox" id="fromDateCheckbox"> From Date </label>' +
                                        '<label for="toDateCheckbox" class="checkbox-label"><input type="checkbox" id="toDateCheckbox"> To Date </label>' +
                                    '</div>' +
                                '</div>' +
                                '<button onclick="sendCheckboxValuesquotation()" style="width: 100%;">Send</button>' +
                            '</div>'+
                        '</div>'; 
                        scrollToBottom();
                        fromDateToDateCheck();
                    }
                }
                                        
                var index = 0;
                                        
                typeWriter();                         
            } else if (pattern.toLowerCase() === 'payments') {
                var responseHTML = `What specific criteria are you looking to use in your <b>payments</b> search?`;
                var typingSpeed = 1e-15;
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat typingpay">`;
                chatContainer.innerHTML += botMessageHTML;
                var currentTime = new Date().toLocaleTimeString();
                var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

                function typeWriter() {
                    var botMessageElement = chatContainer.querySelector('.bot-message-chat.typingpay');
                    botMessageElement.innerHTML = responseHTML.substring(0, index);
                    index++;
                                        
                    if (index <= responseHTML.length) {
                        setTimeout(typeWriter, typingSpeed * 1000);
                        scrollToBottom();
                    } else {
                        botMessageElement.classList.remove('typing');
                        scrollToBottom();
                        chatContainer.innerHTML += botTimeHTML;
                        chatContainer.innerHTML += '<div class="bot-message-check-pay">'+
                            '<div id="patterns">' +
                                '<div class="checkbox-group">' +
                                    '<div class="column" style="float: left;">' +
                                        '<label for="payamountCheckbox" class="checkbox-label"><input type="checkbox" id="payamountCheckbox"> Amount </label>' +
                                        '<label for="paychequeCheckbox" class="checkbox-label"><input type="checkbox" id="paychequeCheckbox"> Cheque Number </label>' +
                                        '<label for="paynameCheckbox" class="checkbox-label"><input type="checkbox" id="paynameCheckbox"> Payable To </label>' +
                                        '</div>' +
                                        '<div class="column" style="float: left; margin-left: 10px;">' +
                                        '<label for="fromDateCheckbox" class="checkbox-label"><input type="checkbox" id="fromDateCheckbox"> From Date </label>' +
                                        '<label for="toDateCheckbox" class="checkbox-label"><input type="checkbox" id="toDateCheckbox"> To Date </label>' +
                                        '</div>' +
                                        '<div class="column" style="float: left; margin-left: 10px;">' +
                                        '<label for="paybookingCheckbox" class="checkbox-label"><input type="checkbox" id="paybookingCheckbox"> Booking Number </label>' +
                                        '<label for="paybillCheckbox" class="checkbox-label"><input type="checkbox" id="paybillCheckbox"> Bill Number </label>' +
                                    '</div>' +
                                '</div>' +
                                '<button onclick="sendCheckboxValuespay()" style="width: 100%;">Send</button>' +
                            '</div>'+
                        '</div>';
                        scrollToBottom();
                        fromDateToDateCheck(); 
                    }
                }
                                        
                var index = 0;
                                        
                typeWriter();                          
            } else if (pattern.toLowerCase() === 'receipts') {
                var responseHTML = `What specific criteria are you looking to use in your <b>receipts</b> search?`;
                var typingSpeed = 1e-15;
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat typingres">`;
                chatContainer.innerHTML += botMessageHTML;
                var currentTime = new Date().toLocaleTimeString();
                var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

                function typeWriter() {
                    var botMessageElement = chatContainer.querySelector('.bot-message-chat.typingres');
                    botMessageElement.innerHTML = responseHTML.substring(0, index);
                    index++;
                                        
                    if (index <= responseHTML.length) {
                        setTimeout(typeWriter, typingSpeed * 1000);
                        scrollToBottom();
                    } else {
                        botMessageElement.classList.remove('typing');
                        scrollToBottom();
                        chatContainer.innerHTML += botTimeHTML;
                        chatContainer.innerHTML += '<div class="bot-message-check-receipts">'+
                            '<div id="patterns">' +
                                '<div class="checkbox-group">' +
                                    '<div class="column" style="float: left;">' +
                                        '<label for="recieptsamountCheckbox" class="checkbox-label"><input type="checkbox" id="recieptsamountCheckbox"> Amount </label>' +
                                        '<label for="fromDateCheckbox" class="checkbox-label"><input type="checkbox" id="fromDateCheckbox"> From Date </label>' +
                                        '<label for="toDateCheckbox" class="checkbox-label"><input type="checkbox" id="toDateCheckbox"> To Date </label>' +
                                    '</div>' +
                                    '<div class="column" style="float: left; margin-left: 10px;">' +
                                        '<label for="receiptfromCheckbox" class="checkbox-label"><input type="checkbox" id="receiptfromCheckbox"> Receipt From </label>' +
                                        '<label for="recieptsbookingnoCheckbox" class="checkbox-label"><input type="checkbox" id="recieptsbookingnoCheckbox"> Booking Number </label>' +
                                        '<label for="recieptsbillnoCheckbox" class="checkbox-label"><input type="checkbox" id="recieptsbillnoCheckbox"> Bill Number </label>' +
                                    '</div>' +
                                '</div>' +
                                '<button onclick="sendCheckboxValuesreceipts()" style="width: 100%;">Send</button>' +
                            '</div>'+
                        '</div>'; 
                        scrollToBottom();
                        fromDateToDateCheck();
                    }
                }
                                        
                var index = 0;
                                        
                typeWriter();                          
            } else if (pattern.toLowerCase() === 'buying') {
                var responseHTML = `What specific criteria are you looking to use in your <b>buying</b> search?`;
                var typingSpeed = 1e-15;
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat typingbuy">`;
                chatContainer.innerHTML += botMessageHTML;
                var currentTime = new Date().toLocaleTimeString();
                var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

                function typeWriter() {
                    var botMessageElement = chatContainer.querySelector('.bot-message-chat.typingbuy');
                    botMessageElement.innerHTML = responseHTML.substring(0, index);
                    index++;
                                        
                    if (index <= responseHTML.length) {
                        setTimeout(typeWriter, typingSpeed * 1000);
                        scrollToBottom();
                    } else {
                        botMessageElement.classList.remove('typing');
                        scrollToBottom();
                        chatContainer.innerHTML += botTimeHTML;
                        chatContainer.innerHTML += '<div class="bot-message-check-buy">'+
                            '<div id="patterns">' +
                                '<div class="checkbox-group">' +
                                    '<div class="column" style="float: left;">' +
                                        '<label for="buyingcompanyCheckbox" class="checkbox-label"><input type="checkbox" id="buyingcompanyCheckbox"> Company </label>' +
                                        '<label for="fromDateCheckbox" class="checkbox-label"><input type="checkbox" id="fromDateCheckbox"> From Date </label>' +
                                        '<label for="toDateCheckbox" class="checkbox-label"><input type="checkbox" id="toDateCheckbox"> To Date </label>' +
                                        '</div>' +
                                        '<div class="column" style="float: left; margin-left: 10px;">' +
                                        '<label for="indirectCheckbox" class="checkbox-label"><input type="checkbox" id="indirectCheckbox"> Indirect Purchase </label>' +
                                        '<label for="directCheckbox" class="checkbox-label"><input type="checkbox" id="directCheckbox" checked> Direct Purchase </label>' +
                                    '</div>' +
                                '</div>' +
                                '<button onclick="sendCheckboxValuesselling()" style="width: 100%;">Send</button>' +
                            '</div>'+
                        '</div>'; 
                        scrollToBottom();
                        fromDateToDateCheck();
                        directIndirect();
                    }
                }
                                        
                var index = 0;
                                        
                typeWriter();                          
            } else if (pattern.toLowerCase() === 'selling') {
                var responseHTML = `What specific criteria are you looking to use in your <b>selling</b> search?`;
                var typingSpeed = 1e-15;
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat typingsell">`;
                chatContainer.innerHTML += botMessageHTML;
                var currentTime = new Date().toLocaleTimeString();
                var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

                function typeWriter() {
                    var botMessageElement = chatContainer.querySelector('.bot-message-chat.typingsell');
                    botMessageElement.innerHTML = responseHTML.substring(0, index);
                    index++;
                                        
                    if (index <= responseHTML.length) {
                        setTimeout(typeWriter, typingSpeed * 1000);
                        scrollToBottom();
                    } else {
                        botMessageElement.classList.remove('typing');
                        scrollToBottom();
                        chatContainer.innerHTML += botTimeHTML;
                        chatContainer.innerHTML += '<div class="bot-message-check-selling">'+
                            '<div id="patterns">' +
                                '<div class="checkbox-group">' +
                                    '<div class="column" style="float: left;">' +
                                        '<label for="billnoCheckbox" class="checkbox-label"><input type="checkbox" id="billnoCheckbox"> Bill Number </label>' +
                                        '<label for="bookingnoCheckbox" class="checkbox-label"><input type="checkbox" id="bookingnoCheckbox"> Booking Number </label>' +
                                        '<label for="bookingrefCheckbox" class="checkbox-label"><input type="checkbox" id="bookingrefCheckbox"> Booking Ref </label>' +
                                        '<label for="invoicenoCheckbox" class="checkbox-label"><input type="checkbox" id="invoicenoCheckbox"> Invoice Number </label>' +
                                        '</div>' +
                                        '<div class="column" style="float: left; margin-left: 10px;">' +
                                        '<label for="companynameCheckbox" class="checkbox-label"><input type="checkbox" id="companynameCheckbox"> Company Name </label>' +
                                        '<label for="fromDateCheckbox" class="checkbox-label"><input type="checkbox" id="fromDateCheckbox"> From Date </label>' +
                                        '<label for="toDateCheckbox" class="checkbox-label"><input type="checkbox" id="toDateCheckbox"> To Date </label>' +
                                        '<label for="containernoCheckbox" class="checkbox-label"><input type="checkbox" id="containernoCheckbox"> Container Number </label>' +
                                        '</div>' +
                                        '<div class="column" style="float: left; margin-left: 10px;">' +
                                        '<label for="sbnoCheckbox" class="checkbox-label"><input type="checkbox" id="sbnoCheckbox"> SB Number </label>' +
                                        '<label for="benoCheckbox" class="checkbox-label"><input type="checkbox" id="benoCheckbox"> BE Number </label>' +
                                        '<label for="hblnoCheckbox" class="checkbox-label"><input type="checkbox" id="hblnoCheckbox"> HBL Number </label>' +
                                        '<label for="mblnoCheckbox" class="checkbox-label"><input type="checkbox" id="mblnoCheckbox"> MBL Number </label>' +
                                        '</div>' +
                                        '<div class="column" style="float: left; margin-left: 10px;">' +
                                        '<label for="hawbnoCheckbox" class="checkbox-label"><input type="checkbox" id="hawbnoCheckbox"> HAWB Number </label>' +
                                        '<label for="mawbnoCheckbox" class="checkbox-label"><input type="checkbox" id="mawbnoCheckbox"> MAWB Number </label>' +
                                    '</div>' +
                                '</div>' +
                                '<button onclick="sendCheckboxValuesbuying()" style="width: 100%;">Send</button>' +
                            '</div>'+
                        '</div>'; 
                        scrollToBottom();
                        fromDateToDateCheck();
                    }
                }
                                        
                var index = 0;
                                        
                typeWriter();
            } else if (pattern.toLowerCase() === 'freight forwarding') {
                var responseHTML = `What specific criteria are you looking to use in your <b>freight forwarding</b> search?`;
                var typingSpeed = 1e-15;
                var buttonsHTML = `
                    <div id="patterns">
                        <button onclick="sendUserMessage2(\'ffrbooking\');">bookings</button>
                        <button onclick="sendUserMessage2(\'billoflad\');">bill of lading</button>
                        <button onclick="sendUserMessage2(\'awb\');">airway bills</button>
                    </div>
                `;
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat typingffr">`;
                chatContainer.innerHTML += botMessageHTML;
                var currentTime = new Date().toLocaleTimeString();
                var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

                function typeWriter() {
                    var botMessageElement = chatContainer.querySelector('.bot-message-chat.typingffr');
                    botMessageElement.innerHTML = responseHTML.substring(0, index);
                    index++;
                                        
                    if (index <= responseHTML.length) {
                        setTimeout(typeWriter, typingSpeed * 1000);
                        scrollToBottom();
                    } else {
                        botMessageElement.classList.remove('typing');
                        scrollToBottom();
                        chatContainer.innerHTML += botTimeHTML;
                        chatContainer.innerHTML += buttonsHTML; 
                        scrollToBottom();
                    }
                }
                                        
                var index = 0;
                                        
                typeWriter();
            } else if (pattern.toLowerCase() === 'customs broker') {
                var responseHTML = `What specific criteria are you looking to use in your <b>customs broker</b> search?`;
                var typingSpeed = 1e-15;
                var buttonsHTML = `
                    <div id="patterns">
                        <button onclick="sendUserMessage2(\'custombooking\');">bookings</button>
                        <button onclick="sendUserMessageBooking(\'shipping bills\'); customShippingBills()">shipping bills</button>
                        <button onclick="sendUserMessageBooking(\'bills of entry\'); customBillOfEntry()">bills of entry</button>
                    </div>
                `;
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat typingchai">`;
                chatContainer.innerHTML += botMessageHTML;
                var currentTime = new Date().toLocaleTimeString();
                var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

                function typeWriter() {
                    var botMessageElement = chatContainer.querySelector('.bot-message-chat.typingchai');
                    botMessageElement.innerHTML = responseHTML.substring(0, index);
                    index++;
                                        
                    if (index <= responseHTML.length) {
                        setTimeout(typeWriter, typingSpeed * 1000);
                        scrollToBottom();
                    } else {
                        botMessageElement.classList.remove('typing');
                        scrollToBottom();
                        chatContainer.innerHTML += botTimeHTML;
                        chatContainer.innerHTML += buttonsHTML; 
                        scrollToBottom();
                    }
                }
                                        
                var index = 0;
                                        
                typeWriter();
            } else if (pattern.toLowerCase() === 'transport') {
                var responseHTML = `What specific criteria are you looking to use in your <b>transport</b> search?`;
                var typingSpeed = 1e-15;
                var buttonsHTML = `
                    <div id="patterns">
                        <button onclick="sendUserMessage2(\'trpbooking\');">bookings</button>
                    </div>
                `;
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat typingchai">`;
                chatContainer.innerHTML += botMessageHTML;
                var currentTime = new Date().toLocaleTimeString();
                var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

                function typeWriter() {
                    var botMessageElement = chatContainer.querySelector('.bot-message-chat.typingchai');
                    botMessageElement.innerHTML = responseHTML.substring(0, index);
                    index++;
                                        
                    if (index <= responseHTML.length) {
                        setTimeout(typeWriter, typingSpeed * 1000);
                        scrollToBottom();
                    } else {
                        botMessageElement.classList.remove('typing');
                        scrollToBottom();
                        chatContainer.innerHTML += botTimeHTML;
                        chatContainer.innerHTML += buttonsHTML; 
                        scrollToBottom();
                    }
                }
                                        
                var index = 0;
                                        
                typeWriter();
            } else {
                            typingMessage();
                            fetch('/chat', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({
                                    user_input: {
                                        'general': pattern,
                                        'current_date': formattedDate,
                                        'tenantid': tenantid,
                                        'officeid': officeid,
                                        'userid': userid
                                    }
                                }),
                            })
                            .then(response => response.json())
                            .then(data => {
                                if (typeof showdown !== 'undefined') {
                                } else {
                                    console.error("Showdown library is not loaded!");
                                }
                                if (data.response) {
                                    var responseMarkdown = data.response;
                                    var converter = new showdown.Converter();
                                    var responseHTML = converter.makeHtml(responseMarkdown);
                                    var typingSpeed = 0.01;
                                    var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 22px;">
                                        <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                                    </div></div><div class="bot-message-chat-2 typing" style="line-height: 1.5;"></div></div>`;
                                    chatContainer.innerHTML += botMessageHTML;
                                    var currentTime = new Date().toLocaleTimeString();
                                    var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

                                    function typeWriter() {
                                        var botMessageElement = chatContainer.querySelector('.bot-message-chat-2.typing');
                                        var words = responseHTML.split(' ');
                                        var currentText = words.slice(0, index).join(' ');
                                        botMessageElement.innerHTML = currentText;
                                        index++;  
                                        
                                        if (index <= words.length) {
                                            setTimeout(typeWriter, typingSpeed * 1000);
                                            scrollToBottom();
                                        } else {
                                            botMessageElement.classList.remove('typing');
                                            scrollToBottom();
                                            chatContainer.innerHTML += botTimeHTML;
                                            scrollToBottom();
                                        }
                                    }
                                
                                    var index = 0;
                                
                                    typeWriter();
                                    closeType();
                                } else{
                                var botMessageHTML = '<div class="message-container"><div class="bot-message">City not found, Check the spelling and try again.</div></div>';
                                chatContainer.innerHTML += botMessageHTML;
                                var currentTime = new Date().toLocaleTimeString();
                                var botTimeHTML = '<div class="bot-time">'+ 'EZEEBOT , ' + currentTime + '</div>';
                                chatContainer.innerHTML += botTimeHTML;
                                closeType();
                                scrollToBottom();
                            }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                            });
                        }
        }

        function customBooking(){
                var responseHTML = `In customs broker, What specific criteria are you looking to use in your <b>booking</b> search?`;
                var typingSpeed = 1e-15;
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat typingbook">`;
                chatContainer.innerHTML += botMessageHTML;
                var currentTime = new Date().toLocaleTimeString();
                var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

                function typeWriter() {
                    var botMessageElement = chatContainer.querySelector('.bot-message-chat.typingbook');
                    botMessageElement.innerHTML = responseHTML.substring(0, index);
                    index++;
                                        
                    if (index <= responseHTML.length) {
                        setTimeout(typeWriter, typingSpeed * 1000);
                        scrollToBottom();
                    } else {
                        botMessageElement.classList.remove('typing');
                        scrollToBottom();
                        chatContainer.innerHTML += botTimeHTML;
                        chatContainer.innerHTML += '<div class="bot-message-check-custom">'+
                            '<div id="patterns">' +
                                '<div class="checkbox-group">' +
                                    '<div class="column" style="float: left;">' +
                                        '<label for="custombookingnoCheckbox" class="checkbox-label"><input type="checkbox" id="custombookingnoCheckbox"> Booking Number </label>' +
                                        '<label for="custombookingrefCheckbox" class="checkbox-label"><input type="checkbox" id="custombookingrefCheckbox"> Booking Ref </label>' +
                                        '<label for="custominvoicenoCheckbox" class="checkbox-label"><input type="checkbox" id="custominvoicenoCheckbox"> Invoice Number </label>' +
                                        '<label for="customlinerbkCheckbox" class="checkbox-label"><input type="checkbox" id="customlinerbkCheckbox"> Liner BK Number </label>' +
                                        '</div>' +
                                        '<div class="column" style="float: left; margin-left: 10px;">' +
                                        '<label for="customcntrCheckbox" class="checkbox-label"><input type="checkbox" id="customcntrCheckbox"> CNTR Number </label>' +
                                        '<label for="customindentCheckbox" class="checkbox-label"><input type="checkbox" id="customindentCheckbox"> Indent Number </label>' +
                                        '<label for="customshipperrefCheckbox" class="checkbox-label"><input type="checkbox" id="customshipperrefCheckbox"> Shipper Ref </label>' +
                                        '<label for="customconsigneerefCheckbox" class="checkbox-label"><input type="checkbox" id="customconsigneerefCheckbox"> Consignee Ref</label>' +
                                    '</div>' +
                                    '<div class="column"style="float: right; margin-left: 30px;">' +
                                        '<label for="fromDateCheckbox" class="checkbox-label"><input type="checkbox" id="fromDateCheckbox"> From Date </label>' +
                                        '<label for="toDateCheckbox" class="checkbox-label"><input type="checkbox" id="toDateCheckbox"> To Date </label>' +
                                        '<label for="customsbnoCheckbox" class="checkbox-label"><input type="checkbox" id="customsbnoCheckbox"> SB Number </label>' +
                                        '<label for="custombenoCheckbox" class="checkbox-label"><input type="checkbox" id="custombenoCheckbox"> BE Number </label>' +
                                        '</div>' +
                                        '<div class="column" style="float: left; margin-left: 10px;">' +
                                        '<label for="customhblnoCheckbox" class="checkbox-label"><input type="checkbox" id="customhblnoCheckbox"> HBL/HAWB Number </label>' +
                                        '<label for="custommblnoCheckbox" class="checkbox-label"><input type="checkbox" id="custommblnoCheckbox"> MBL/MAWB Number </label>' +
                                        '<label for="customplrecipCheckbox" class="checkbox-label"><input type="checkbox" id="customplrecipCheckbox"> Place of Receipt </label>' +
                                        '<label for="custompldelCheckbox" class="checkbox-label"><input type="checkbox" id="custompldelCheckbox"> Place of Delivery </label>' +
                                    '</div>' +
                                '</div>' +
                                '<button onclick="sendCheckboxValuescustom()" style="width: 100%;">Send</button>' +
                            '</div>'+
                        '</div>'; 
                        scrollToBottom();
                        fromDateToDateCheck();
                    }
                }
                                        
                var index = 0;
                                        
                typeWriter();
        }

        function trpBooking(){
            var responseHTML = `In transport, What specific criteria are you looking to use in your <b>booking</b> search?`;
            var typingSpeed = 1e-15;
            var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
            </div></div><div class="bot-message-chat typingbook">`;
            chatContainer.innerHTML += botMessageHTML;
            var currentTime = new Date().toLocaleTimeString();
            var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

            function typeWriter() {
                var botMessageElement = chatContainer.querySelector('.bot-message-chat.typingbook');
                botMessageElement.innerHTML = responseHTML.substring(0, index);
                index++;
                                    
                if (index <= responseHTML.length) {
                    setTimeout(typeWriter, typingSpeed * 1000);
                    scrollToBottom();
                } else {
                    botMessageElement.classList.remove('typing');
                    scrollToBottom();
                    chatContainer.innerHTML += botTimeHTML;
                    chatContainer.innerHTML += '<div class="bot-message-check-trp">'+
                        '<div id="patterns">' +
                            '<div class="checkbox-group">' +
                                '<div class="column" style="float: left;">' +
                                    '<label for="custombookingnoCheckbox" class="checkbox-label"><input type="checkbox" id="custombookingnoCheckbox"> Booking Number </label>' +
                                    '<label for="custombookingrefCheckbox" class="checkbox-label"><input type="checkbox" id="custombookingrefCheckbox"> Booking Ref </label>' +
                                    '<label for="customcustnameCheckbox" class="checkbox-label"><input type="checkbox" id="customcustnameCheckbox"> Customer Name </label>' +
                                '</div>' +
                                '<div class="column"style="float: right; margin-left: 30px;">' +
                                    '<label for="fromDateCheckbox" class="checkbox-label"><input type="checkbox" id="fromDateCheckbox"> From Date </label>' +
                                    '<label for="toDateCheckbox" class="checkbox-label"><input type="checkbox" id="toDateCheckbox"> To Date </label>' +
                                '</div>' +
                            '</div>' +
                            '<button onclick="sendCheckboxValuestrp()" style="width: 100%;">Send</button>' +
                        '</div>'+
                    '</div>'; 
                    scrollToBottom();
                    fromDateToDateCheck();
                }
            }
                                    
            var index = 0;
                                    
            typeWriter();
        }

        function customShippingBills(){
            var responseHTML = `WIn customs broker, What specific criteria are you looking to use in your <b>shipping bills</b> search?`;
                var typingSpeed = 1e-15;
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat typingsb">`;
                chatContainer.innerHTML += botMessageHTML;
                var currentTime = new Date().toLocaleTimeString();
                var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

                function typeWriter() {
                    var botMessageElement = chatContainer.querySelector('.bot-message-chat.typingsb');
                    botMessageElement.innerHTML = responseHTML.substring(0, index);
                    index++;
                                        
                    if (index <= responseHTML.length) {
                        setTimeout(typeWriter, typingSpeed * 1000);
                        scrollToBottom();
                    } else {
                        botMessageElement.classList.remove('typing');
                        chatContainer.innerHTML += botTimeHTML;
                        chatContainer.innerHTML += '<div class="bot-message-check-customSB">'+
                            '<div id="patterns">' +
                                '<div class="checkbox-group">' +
                                    '<div class="column" style="float: left;">' +
                                        '<label for="customSBbookingnoCheckbox" class="checkbox-label"><input type="checkbox" id="customSBbookingnoCheckbox"> Booking Number </label>' +
                                        '<label for="customSBbookingrefCheckbox" class="checkbox-label"><input type="checkbox" id="customSBbookingrefCheckbox"> Booking Ref </label>' +
                                        '<label for="customSBjobnoCheckbox" class="checkbox-label"><input type="checkbox" id="customSBjobnoCheckbox"> Job Number </label>' +
                                        '</div>' +
                                        '<div class="column" style="float: left; margin-left: 10px;">' +
                                        '<label for="customSBSBnoCheckbox" class="checkbox-label"><input type="checkbox" id="customSBSBnoCheckbox"> SB Number </label>' +
                                        '<label for="customSBlicenserefCheckbox" class="checkbox-label"><input type="checkbox" id="customSBlicenserefCheckbox"> License reg Number </label>' +
                                        '<label for="customSBinvoicenoCheckbox" class="checkbox-label"><input type="checkbox" id="customSBinvoicenoCheckbox"> Invoice Number </label>' +
                                        '</div>' +
                                        '<div class="column" style="float: left; margin-left: 10px;">' +
                                        '<label for="fromDateCheckbox" class="checkbox-label"><input type="checkbox" id="fromDateCheckbox"> SB From Date </label>' +
                                        '<label for="toDateCheckbox" class="checkbox-label"><input type="checkbox" id="toDateCheckbox"> SB To Date </label>' +
                                        '<label for="customSBhscodeCheckbox" class="checkbox-label"><input type="checkbox" id="customSBhscodeCheckbox"> HSCODE </label>' +
                                    '</div>' +
                                '</div>' +
                                '<button onclick="sendCheckboxValuescustomSB()" style="width: 100%;">Send</button>' +
                            '</div>'+
                        '</div>';
                        scrollToBottom();
                        fromDateToDateCheck();
                    }
                }
                                        
                var index = 0;
                                        
                typeWriter();
        }

        function customBillOfEntry(){
            var responseHTML = `In customs broker, What specific criteria are you looking to use in your <b>bill of entry</b> search?`;
                var typingSpeed = 1e-15;
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat typingbe">`;
                chatContainer.innerHTML += botMessageHTML;
                var currentTime = new Date().toLocaleTimeString();
                var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

                function typeWriter() {
                    var botMessageElement = chatContainer.querySelector('.bot-message-chat.typingbe');
                    botMessageElement.innerHTML = responseHTML.substring(0, index);
                    index++;
                                        
                    if (index <= responseHTML.length) {
                        setTimeout(typeWriter, typingSpeed * 1000);
                        scrollToBottom();
                    } else {
                        botMessageElement.classList.remove('typing');
                        scrollToBottom();
                        chatContainer.innerHTML += botTimeHTML;
                        chatContainer.innerHTML += '<div class="bot-message-check-customBE">'+
                            '<div id="patterns">' +
                                '<div class="checkbox-group">' +
                                    '<div class="column" style="float: left;">' +
                                        '<label for="customBEbookingnoCheckbox" class="checkbox-label"><input type="checkbox" id="customBEbookingnoCheckbox"> Booking Number </label>' +
                                        '<label for="customBEbookingrefCheckbox" class="checkbox-label"><input type="checkbox" id="customBEbookingrefCheckbox"> Booking Ref </label>' +
                                        '<label for="customBEinvoicenoCheckbox" class="checkbox-label"><input type="checkbox" id="customBEinvoicenoCheckbox"> Invoice Number </label>' +
                                        '<label for="customBEhscodeCheckbox" class="checkbox-label"><input type="checkbox" id="customBEhscodeCheckbox"> HSCODE </label>' +
                                        '</div>' +
                                        '<div class="column" style="float: left; margin-left: 10px;">' +
                                        '<label for="customBEjobnoCheckbox" class="checkbox-label"><input type="checkbox" id="customBEjobnoCheckbox"> Job Number </label>' +
                                        '<label for="customBElicenseregCheckbox" class="checkbox-label"><input type="checkbox" id="customBElicenseregCheckbox"> License reg Number </label>' +
                                        '<label for="customBEBEnoCheckbox" class="checkbox-label"><input type="checkbox" id="customBEBEnoCheckbox"> BE Number </label>' +
                                        '<label for="customBEIECCheckbox" class="checkbox-label"><input type="checkbox" id="customBEIECCheckbox"> IEC Code </label>' +
                                        '</div>' +
                                        '<div class="column" style="float: left; margin-left: 10px;">' +
                                        '<label for="customBEIGMCheckbox" class="checkbox-label"><input type="checkbox" id="customBEIGMCheckbox"> IGM Number </label>' +
                                        '<label for="fromDateCheckbox" class="checkbox-label"><input type="checkbox" id="fromDateCheckbox"> BE From Date </label>' +
                                        '<label for="toDateCheckbox" class="checkbox-label"><input type="checkbox" id="toDateCheckbox"> BE To Date </label>' +
                                        '</div>' +
                                        '<div class="column" style="float: left; margin-left: 10px;">' +
                                        '<label for="customBEHAWBCheckbox" class="checkbox-label"><input type="checkbox" id="customBEHAWBCheckbox"> HAWB/HBL Number </label>' +
                                        '<label for="customBEMAWBCheckbox" class="checkbox-label"><input type="checkbox" id="customBEMAWBCheckbox"> MAWB/MBL Number </label>' +
                                    '</div>' +
                                '</div>' +
                                '<button onclick="sendCheckboxValuescustomBE()" style="width: 100%;">Send</button>' +
                            '</div>'+
                        '</div>'; 
                        scrollToBottom();
                        fromDateToDateCheck();
                    }
                }
                                        
                var index = 0;
                                        
                typeWriter();
        }

        function frightBooking(){
                var responseHTML = `In freight forwarding, What specific criteria are you looking to use in your <b>booking</b> search?`;
                var typingSpeed = 1e-15;
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat typingffrbk">`;
                chatContainer.innerHTML += botMessageHTML;
                var currentTime = new Date().toLocaleTimeString();
                var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

                function typeWriter() {
                    var botMessageElement = chatContainer.querySelector('.bot-message-chat.typingffrbk');
                    botMessageElement.innerHTML = responseHTML.substring(0, index);
                    index++;
                                        
                    if (index <= responseHTML.length) {
                        setTimeout(typeWriter, typingSpeed * 1000);
                        scrollToBottom();
                    } else {
                        botMessageElement.classList.remove('typing');
                        chatContainer.innerHTML += botTimeHTML;
                        chatContainer.innerHTML += '<div class="bot-message-check-fright">'+
                            '<div id="patterns">' +
                                '<div class="checkbox-group">' +
                                    '<div class="column" style="float: left;">' +
                                        '<label for="frightbookingnoCheckbox" class="checkbox-label"><input type="checkbox" id="frightbookingnoCheckbox"> Booking Number </label>' +
                                        '<label for="frightbookingrefCheckbox" class="checkbox-label"><input type="checkbox" id="frightbookingrefCheckbox"> Booking Ref </label>' +
                                        '<label for="frightinvoicenoCheckbox" class="checkbox-label"><input type="checkbox" id="frightinvoicenoCheckbox"> Invoice Number </label>' +
                                        '<label for="frightlinerbkCheckbox" class="checkbox-label"><input type="checkbox" id="frightlinerbkCheckbox"> Liner BK Number </label>' +
                                        '</div>' +
                                        '<div class="column" style="float: left; margin-left: 10px;">' +
                                        '<label for="frightcntrCheckbox" class="checkbox-label"><input type="checkbox" id="frightcntrCheckbox"> CNTR Number </label>' +
                                        '<label for="frightindentCheckbox" class="checkbox-label"><input type="checkbox" id="frightindentCheckbox"> Indent Number </label>' +
                                        '<label for="frightshipperrefCheckbox" class="checkbox-label"><input type="checkbox" id="frightshipperrefCheckbox"> Shipper Ref </label>' +
                                        '<label for="frightconsigneerefCheckbox" class="checkbox-label"><input type="checkbox" id="frightconsigneerefCheckbox"> Consignee Ref</label>' +
                                        '</div>' +
                                        '<div class="column" style="float: left; margin-left: 10px;">' +
                                        '<label for="fromDateCheckbox" class="checkbox-label"><input type="checkbox" id="fromDateCheckbox"> From Date </label>' +
                                        '<label for="toDateCheckbox" class="checkbox-label"><input type="checkbox" id="toDateCheckbox"> To Date </label>' +
                                        '<label for="frightsbnoCheckbox" class="checkbox-label"><input type="checkbox" id="frightsbnoCheckbox"> SB Number </label>' +
                                        '<label for="frightbenoCheckbox" class="checkbox-label"><input type="checkbox" id="frightbenoCheckbox"> BE Number </label>' +
                                        '</div>' +
                                        '<div class="column" style="float: left; margin-left: 10px;">' +
                                        '<label for="frighthblnoCheckbox" class="checkbox-label"><input type="checkbox" id="frighthblnoCheckbox"> HBL/HAWB Number </label>' +
                                        '<label for="frightmblnoCheckbox" class="checkbox-label"><input type="checkbox" id="frightmblnoCheckbox"> MBL/MAWB Number </label>' +
                                        '<label for="frightplrecipCheckbox" class="checkbox-label"><input type="checkbox" id="frightplrecipCheckbox"> Place of Receipt </label>' +
                                        '<label for="frightpldelCheckbox" class="checkbox-label"><input type="checkbox" id="frightpldelCheckbox"> Place of Delivery </label>' +
                                    '</div>' +
                                '</div>' +
                                '<button onclick="sendCheckboxValuesfright()" style="width: 100%;">Send</button>' +
                            '</div>'+
                        '</div>'; 
                        scrollToBottom();
                        fromDateToDateCheck();
                    }
                }
                                        
                var index = 0;
                                        
                typeWriter();
        }

        function frightBillOfLading(){
            var responseHTML = `In freight forwarding, What specific criteria are you looking to use in your <b>bill of lading</b> search?`;
                var typingSpeed = 1e-15;
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat typingbol">`;
                chatContainer.innerHTML += botMessageHTML;
                var currentTime = new Date().toLocaleTimeString();
                var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

                function typeWriter() {
                    var botMessageElement = chatContainer.querySelector('.bot-message-chat.typingbol');
                    botMessageElement.innerHTML = responseHTML.substring(0, index);
                    index++;
                                        
                    if (index <= responseHTML.length) {
                        setTimeout(typeWriter, typingSpeed * 1000);
                        scrollToBottom();
                    } else {
                        botMessageElement.classList.remove('typing');
                        chatContainer.innerHTML += botTimeHTML;
                        chatContainer.innerHTML += '<div class="bot-message-check-frightBillOfLading">'+
                            '<div id="patterns">' +
                                '<div class="checkbox-group">' +
                                    '<div class="column" style="float: left;">' +
                                        '<label for="frightBillOfLadingbookingnoCheckbox" class="checkbox-label"><input type="checkbox" id="frightBillOfLadingbookingnoCheckbox"> BL Number </label>' +
                                        '<label for="frightBillOfLadinginvoicenoCheckbox" class="checkbox-label"><input type="checkbox" id="frightBillOfLadinginvoicenoCheckbox"> Booking Number </label>' +
                                        '<label for="frightBillOfLadingbookingrefCheckbox" class="checkbox-label"><input type="checkbox" id="frightBillOfLadingbookingrefCheckbox"> Booking Ref </label>' +
                                        '</div>' +
                                        '<div class="column" style="float: left; margin-left: 10px;">' +
                                        '<label for="frightBillOfLadingblrefCheckbox" class="checkbox-label"><input type="checkbox" id="frightBillOfLadingblrefCheckbox"> BL Ref </label>' +
                                        '<label for="frightBillOfLadingcontainernoCheckbox" class="checkbox-label"><input type="checkbox" id="frightBillOfLadingcontainernoCheckbox"> Container Number </label>' +
                                        '<label for="bkfromDateCheckbox" class="checkbox-label"><input type="checkbox" id="bkfromDateCheckbox"> BK From Date </label>' +
                                        '</div>' +
                                        '<div class="column" style="float: left; margin-left: 10px;">' +
                                        '<label for="bktoDateCheckbox" class="checkbox-label"><input type="checkbox" id="bktoDateCheckbox"> BK To Date </label>' +
                                        '<label for="fromDateCheckbox" class="checkbox-label"><input type="checkbox" id="fromDateCheckbox"> From Date </label>' +
                                        '<label for="toDateCheckbox" class="checkbox-label"><input type="checkbox" id="toDateCheckbox"> To Date </label>' +
                                        
                                    '</div>' +
                                '</div>' +
                                '<button onclick="sendCheckboxValuesfrightBillOfLading()" style="width: 100%;">Send</button>' +
                            '</div>'+
                        '</div>'; 
                        scrollToBottom();
                        fromDateToDateCheck();
                        fromDateToDateCheck2();
                    }
                }
                                        
                var index = 0;
                                        
                typeWriter();
        }

        function frightAirWayBill(){
            var responseHTML = `In freight forwarding, What specific criteria are you looking to use in your <b>air way bill</b> search?`;
                var typingSpeed = 1e-15;
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat typingawb">`;
                chatContainer.innerHTML += botMessageHTML;
                var currentTime = new Date().toLocaleTimeString();
                var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

                function typeWriter() {
                    var botMessageElement = chatContainer.querySelector('.bot-message-chat.typingawb');
                    botMessageElement.innerHTML = responseHTML.substring(0, index);
                    index++;
                                        
                    if (index <= responseHTML.length) {
                        setTimeout(typeWriter, typingSpeed * 1000);
                        scrollToBottom();
                    } else {
                        botMessageElement.classList.remove('typing');
                        chatContainer.innerHTML += botTimeHTML;
                        chatContainer.innerHTML += '<div class="bot-message-check-frightawb">'+
                            '<div id="patterns">' +
                                '<div class="checkbox-group">' +
                                    '<div class="column" style="float: left;">' +
                                        '<label for="frightawbawbnoCheckbox" class="checkbox-label"><input type="checkbox" id="frightawbawbnoCheckbox"> AWB Number </label>' +
                                        '<label for="frightawbbookingnoCheckbox" class="checkbox-label"><input type="checkbox" id="frightawbbookingnoCheckbox"> Booking Number </label>' +
                                        '<label for="bkfromDateCheckbox" class="checkbox-label"><input type="checkbox" id="bkfromDateCheckbox"> BK From Date </label>' +
                                        '</div>' +
                                        '<div class="column" style="float: left; margin-left: 10px;">' +
                                        '<label for="bktoDateCheckbox" class="checkbox-label"><input type="checkbox" id="bktoDateCheckbox"> BK To Date </label>' +
                                        '<label for="frightawbbookingrefCheckbox" class="checkbox-label"><input type="checkbox" id="frightawbbookingrefCheckbox"> Booking Ref </label>' +
                                        '<label for="frightawbawbrefCheckbox" class="checkbox-label"><input type="checkbox" id="frightawbawbrefCheckbox"> AWB Ref </label>' +
                                        '</div>' +
                                        '<div class="column" style="float: left; margin-left: 10px;">' +
                                        '<label for="fromDateCheckbox" class="checkbox-label"><input type="checkbox" id="fromDateCheckbox"> From Date </label>' +
                                        '<label for="toDateCheckbox" class="checkbox-label"><input type="checkbox" id="toDateCheckbox"> To Date </label>' +
                                        
                                    '</div>' +
                                '</div>' +
                                '<button onclick="sendCheckboxValuesfrightawb()" style="width: 100%;">Send</button>' +
                            '</div>'+
                        '</div>'; 
                        scrollToBottom();
                        fromDateToDateCheck();
                        fromDateToDateCheck2();
                    }
                }
                                        
                var index = 0;
                                        
                typeWriter();
        }

        function openPDFInNewWindow(src) {
            window.open(src, '_blank');
        }                                  

        function frightAirWayBillextract() {
            var tagsDiv = document.getElementById('patterns');
                if (tagsDiv) {
                    tagsDiv.parentNode.removeChild(tagsDiv);
                }
            var responseHTML = `Please upload the <b>document</b>.`;
                var typingSpeed = 1e-15;
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat typingawbex">`;
                chatContainer.innerHTML += botMessageHTML;
                var currentTime = new Date().toLocaleTimeString();
                var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

                function typeWriter() {
                    var botMessageElement = chatContainer.querySelector('.bot-message-chat.typingawbex');
                    botMessageElement.innerHTML = responseHTML.substring(0, index);
                    index++;
                                        
                    if (index <= responseHTML.length) {
                        setTimeout(typeWriter, typingSpeed * 1000);
                        scrollToBottom();
                    } else {
                        botMessageElement.classList.remove('typing');
                        chatContainer.innerHTML += botTimeHTML; 
                        scrollToBottom();
                    }
                }
                                        
                var index = 0;
                                        
                typeWriter();
        
            var imageUploadElement = document.getElementById('image-upload');
            if (imageUploadElement) {
                imageUploadElement.click();
                imageUploadElement.addEventListener('change', function() {
                    var file = imageUploadElement.files[0];
                    if (file) {
                        var formData = new FormData();
                        formData.append('image', file);
                        var reader = new FileReader();
                        reader.onload = function(event) {
                            var userMessageHTML = '';

                            if (file.type.startsWith('image/')) {
                                userMessageHTML = `
                                    <div class="message-container">
                                        <div class="user-message-img">
                                            <img src="${event.target.result}" alt="User Image" style="width: 200px; height: auto; cursor: pointer;" onclick="openModalimg('${event.target.result}')">
                                        </div>
                                    </div>
                                `;
                            } else if (file.type === 'application/pdf') {
                                userMessageHTML = `
                                    <div class="message-container">
                                        <div class="user-message-pdf" style="background-color: #007bff; padding: 5px; border-radius: 5px;">
                                            <i class="fas fa-file-pdf" style="padding-right: 5px; font-size: 34px;"></i>
                                            <a href="${event.target.result}" target="_blank" style="color: white; text-decoration: none; font-weight: bold;">
                                                ${file.name}<br>
                                                <span style="font-size: 10px; bottom: 30px; ">(${formatFileSize(file.size)})</span>
                                            </a>
                                        </div>
                                    </div>
                                `;
                            }
        
                            chatContainer.innerHTML += userMessageHTML;
                            typingMessage();
                            scrollToBottom();
                        };
                        reader.onerror = function(event) {
                            console.error("FileReader error:", event.target.error);
                        };
                        reader.readAsDataURL(file);
        
                        fetch('/awb', {
                            method: 'POST',
                            body: formData
                        })
                        .then(response => response.json())
                        .then(data => {
                            console.log('Success:', data);
                            if (data.generated_content) {
                                var responseMarkdown = data.generated_content;
                                var converter = new showdown.Converter();
                                var responseHTML = converter.makeHtml(responseMarkdown);
                                var typingSpeed = 1e-15;
                                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 22px;">
                                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                                </div></div><div class="bot-message-chat-2 typingimg" style="line-height: 1.5;"><div class="bot-message-img">`;
                                chatContainer.innerHTML += botMessageHTML;
                                var currentTime = new Date().toLocaleTimeString();
                                var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

                                function typeWriter() {
                                    var botMessageElement = chatContainer.querySelector('.bot-message-chat-2.typingimg');
                                    var words = responseHTML.split(' ');
                                    var currentText = words.slice(0, index).join(' ');
                                    botMessageElement.innerHTML = currentText;
                                    index++;  
                                    
                                    if (index <= words.length) {
                                        setTimeout(typeWriter, typingSpeed * 1000);
                                        scrollToBottom();
                                    } else {
                                        botMessageElement.classList.remove('typing');
                                        chatContainer.innerHTML += botTimeHTML;
                                        scrollToBottom();
                                    }
                                }
                                    
                                var index = 0;
                                    
                                typeWriter();
                            } else {
                                var errorMessageHTML = `
                                    <div class="message-container">
                                        <div class="bot-message">City not found. Please check the spelling and try again.</div>
                                    </div>
                                `;
                                chatContainer.innerHTML += errorMessageHTML;
                            }
                            closeType();
                            scrollToBottom();
                        })
                        .catch(error => {
                            console.error('Error sending image:', error);
                        });
                    }
                }, { once: true });
            }  
            scrollToBottom();
        }

        var userInputHistory = [];

        function value_search(pattern){
            var userInputElement = document.getElementById('user-input');
            var userInput = document.getElementById('user-input');
                                userInput.focus();
                                if (userInputElement._listener) {
                                    userInputElement.removeEventListener('keypress', userInputElement._listener);
                                }
                                userInputElement._listener = function(event) {
                                    if (event.key === 'Enter') {
                                        event.preventDefault();
                                        var userInput = this.value.trim();
                                        simpleUserMessage(userInput);
                                        var weather = this.value.trim();
                                        this.value = '';
                                        if (weather !== '') {
                                            typingMessage();
                                            fetch('/chat_input', {
                                                method: 'POST',
                                                headers: {
                                                    'Content-Type': 'application/json',
                                                },
                                                body: JSON.stringify({
                                                    user_input: {
                                                        'section': pattern,
                                                        'value_to_search': weather,
                                                        'time_period': 'Last Month',
                                                        'environment': environment,
                                                        'current_date': formattedDate,
                                                        'tenantid': tenantid,
                                                        'officeid': officeid,
                                                        'userid': userid
                                                    }
                                                }),
                                            })
                                            .then(response => response.json())
                                            .then(data => {
                                                var responseMarkdown = data.response;
                                                var converter = new showdown.Converter();
                                                var responseHTML = converter.makeHtml(responseMarkdown);
                                                var typingSpeed = 1e-15;
                                                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 22px;">
                                                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                                                </div></div><div class="bot-message-chat-2 typing11" style="line-height: 1.5;"></div></div>`;
                                                chatContainer.innerHTML += botMessageHTML;
                                                var currentTime = new Date().toLocaleTimeString();
                                                var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

                                                function typeWriter() {
                                                    var botMessageElement = chatContainer.querySelector('.bot-message-chat-2.typing11');
                                                    botMessageElement.innerHTML = responseHTML.substring(0, index);
                                                    index++;  
                                                
                                                    if (index <= responseHTML.length) {
                                                        setTimeout(typeWriter, typingSpeed * 1000);
                                                        scrollToBottom();
                                                    } else {
                                                        botMessageElement.classList.remove('typing11');
                                                        scrollToBottom();
                                                        chatContainer.innerHTML += botTimeHTML;
                                                        scrollToBottom();
                                                        setTimeout(function() {
                                                            value_search(pattern);
                                                        }, 0);
                                                        userInputElement.removeEventListener('keypress', userInputElement._listener);
                                                    }
                                                }
                                                
                                                var index = 0;
                                                closeType();
                                                typeWriter();
                                            })
                                            .catch(error => {
                                                console.error('Error:', error);
                                            });
                                        } else {
                                            alert('Please provide a valid booking number');
                                        }
                                    }
                                };
                                userInputElement.addEventListener('keypress', userInputElement._listener);
        }

        function populateInput(item) {
            document.getElementById('user-input').value = item;
            var userInput = document.getElementById('user-input');
            userInput.focus();
            var event = new KeyboardEvent('keypress', {
                key: 'Enter',
                keyCode: 13,
                bubbles: true,
                cancelable: true,
            });
            userInput.dispatchEvent(event);
            var patternsDivs = document.querySelectorAll('#patterns');
            patternsDivs.forEach(function(patternsDiv) {
                patternsDiv.parentNode.removeChild(patternsDiv);
            });
        }
        
        function send_inputs2(pattern) {
            typingMessage();
            var qsButtonsHTML = "";
            var responseMarkdown;
        
            if (pattern.toLowerCase() === "ffrbooking") {
                responseMarkdown = '> Ask me anything about **bookings**?';
            } else if (pattern.toLowerCase() === "billoflad") {
                responseMarkdown = '> Ask me anything about **bill of lading**?';
            } else if (pattern.toLowerCase() === "awb") {
                responseMarkdown = '> Ask me anything about **air way bills**?';
            } else if (pattern.toLowerCase() === "custombooking") {
                responseMarkdown = '> Ask me anything about **bookings**?';
            } else if (pattern.toLowerCase() === "lead" || pattern.toLowerCase() === "enquiry" || pattern.toLowerCase() === "quotation") {
                responseMarkdown = `> Ask me anything about **${pattern}**?`;
                console.log('yes');
        
                var uri = '/randomQs';
                var requestBody = {
                    'module': pattern.toLowerCase(),
                    'tenantid': tenantid,
                    'officeid': officeid
                };
        
                fetch(uri, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestBody)
                })
                .then(response => response.json())
                .then(data => {
                    console.log(data);
                    data.forEach(item => {
                        qsButtonsHTML += `
                            <div id="patterns">
                                <button onclick="populateInput('${item}')">
                                    ${item}
                                </button>
                            </div>
                        `;
                    });
                    appendResponse();
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                    appendResponse();
                });
        
                return;
            } else {
                responseMarkdown = `> Ask me anything about **${pattern}**?`;
            }
        
            function appendResponse() {
                var converter = new showdown.Converter();
                var responseHTML = converter.makeHtml(responseMarkdown);
                var typingSpeed = 1e-15;
                var botMessageHTML = `
                    <div class="message-container">
                        <div class="bot-avatar">
                            <div id="dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 22px;">
                                <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                            </div>
                        </div>
                        <div class="bot-message-chat-2 typing13" style="line-height: 1.5;"></div>
                    </div>
                `;
                chatContainer.innerHTML += botMessageHTML;
                var currentTime = new Date().toLocaleTimeString();
                var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
        
                function typeWriter() {
                    var botMessageElement = chatContainer.querySelector('.bot-message-chat-2.typing13');
                    botMessageElement.innerHTML = responseHTML.substring(0, index);
                    index++;
        
                    if (index <= responseHTML.length) {
                        setTimeout(typeWriter, typingSpeed * 1000);
                        scrollToBottom();
                    } else {
                        botMessageElement.classList.remove('typing13');
                        scrollToBottom();
                        if (qsButtonsHTML) {
                            chatContainer.innerHTML += botTimeHTML + qsButtonsHTML;
                        } else {
                            chatContainer.innerHTML += botTimeHTML;
                        }
                        scrollToBottom();
                        send_inputs(pattern);
                    }
                }
        
                var index = 0;
                closeType();
                typeWriter();
            }
        
            appendResponse();
        }        

        function send_inputs(pattern) {
            var userInput = document.getElementById('user-input');
            userInput.focus();

            var userInputElement = document.getElementById('user-input');

            if (userInputElement._listener) {
                userInputElement.removeEventListener('keypress', userInputElement._listener);
            }

            userInputElement._listener = function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    var botMessageCheck = document.querySelector('.bot-message-check-'+ pattern.toLowerCase() +'');
                    if (botMessageCheck) {
                        botMessageCheck.remove();
                    }
                    var patternsDivs = document.querySelectorAll('#patterns');
                    patternsDivs.forEach(function(patternsDiv) {
                        patternsDiv.parentNode.removeChild(patternsDiv);
                    });

                    var userInput = this.value.trim();

                    userInputHistory = [];
                    userInputHistory.push(userInput);

                    simpleUserMessage(userInput);

                    this.value = '';

                    if (userInput !== '') {
                        typingMessage();

                        fetch('/chat_input', {
                            method: 'POST',
                          
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                user_input: {
                                    'section': pattern,
                                    'input_text': userInput,
                                    'environment': environment,
                                    'current_date': formattedDate,
                                    'tenantid': tenantid,
                                    'officeid': officeid,
                                    'userid': userid,
                                    'ffrid': ffrid,
                                    'chaid': chaid,
                                }
                            }),
                        })
                        .then(response => response.json())
                        .then(data => {
                            if (data.response === 'The gross total for last month is last_month_gross_total.') {
                                var ntype = 'gross';
                                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                                </div></div><div class="bot-message-chat">Select a time frame</div></div>`;
                                var currentTime = new Date().toLocaleTimeString();
                                var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                                var buttonContainerHTML = '<div id="patterns" class="button-container">' +
                                    '<button onclick="handleButtonClick(\'today\', \'1\', \'' + pattern + '\', \'' + userInputHistory + '\', \'' + ntype + '\')">Today</button>' +
                                    '<button onclick="handleButtonClick(\'Last Week\', \'7\', \'' + pattern + '\', \'' + userInputHistory + '\', \'' + ntype + '\')">Last Week</button>' +
                                    '<button onclick="handleButtonClick(\'Last Month\', \'30\', \'' + pattern + '\', \'' + userInputHistory + '\', \'' + ntype + '\')">Last Month</button>' +
                                    '<button onclick="handleButtonClick(\'Six Month\', \'180\', \'' + pattern + '\', \'' + userInputHistory + '\', \'' + ntype + '\')">Six Month</button>' +
                                    '<button onclick="handleButtonClick(\'One Year\', \'365\', \'' + pattern + '\', \'' + userInputHistory + '\', \'' + ntype + '\')">One Year</button>' +
                                    '</div>';
                                chatContainer.innerHTML += botMessageHTML + botTimeHTML + buttonContainerHTML;
                                closeType();
                                scrollToBottom();
                            } else if (data.response === 'Sure, what are you looking for?') {
                                var responseMarkdown = '> Sure, What are you looking to search for?';
                                var converter = new showdown.Converter();
                                var responseHTML = converter.makeHtml(responseMarkdown);
                                var typingSpeed = 1e-15;
                                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 22px;">
                                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                                </div></div><div class="bot-message-chat-2 typing13" style="line-height: 1.5;"></div></div>`;
                                chatContainer.innerHTML += botMessageHTML;
                                var currentTime = new Date().toLocaleTimeString();
                                var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

                                function typeWriter() {
                                    var botMessageElement = chatContainer.querySelector('.bot-message-chat-2.typing13');
                                    botMessageElement.innerHTML = responseHTML.substring(0, index);
                                    index++;  
                                                
                                    if (index <= responseHTML.length) {
                                        setTimeout(typeWriter, typingSpeed * 1000);
                                        scrollToBottom();
                                    } else {
                                        botMessageElement.classList.remove('typing13');
                                        scrollToBottom();
                                        chatContainer.innerHTML += botTimeHTML;
                                        scrollToBottom();
                                    }
                                }
                                                
                                var index = 0;
                                closeType();
                                typeWriter();
                                var userInput = document.getElementById('user-input');
                                userInput.focus();
                                if (userInputElement._listener) {
                                    userInputElement.removeEventListener('keypress', userInputElement._listener);
                                }
                                userInputElement._listener = function(event) {
                                    if (event.key === 'Enter') {
                                        event.preventDefault();
                                        var userInput = this.value.trim();
                                        simpleUserMessage(userInput);
                                        var weather = this.value.trim();
                                        this.value = '';
                                        if (weather !== '') {
                                            typingMessage();
                                            fetch('/chat_input', {
                                                method: 'POST',
                                                headers: {
                                                    'Content-Type': 'application/json',
                                                },
                                                body: JSON.stringify({
                                                    user_input: {
                                                        'section': pattern,
                                                        'value_to_search': weather,
                                                        'time_period': 'Last Month',
                                                        'environment': environment,
                                                        'current_date': formattedDate,
                                                        'tenantid': tenantid,
                                                        'officeid': officeid,
                                                        'userid': userid
                                                    }
                                                }),
                                            })
                                            .then(response => response.json())
                                            .then(data => {
                                                var responseMarkdown = data.response;
                                                var converter = new showdown.Converter();
                                                var responseHTML = converter.makeHtml(responseMarkdown);
                                                var typingSpeed = 1e-15;
                                                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 22px;">
                                                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                                                </div></div><div class="bot-message-chat-2 typing11" style="line-height: 1.5;"></div></div>`;
                                                chatContainer.innerHTML += botMessageHTML;
                                                var currentTime = new Date().toLocaleTimeString();
                                                var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

                                                function typeWriter() {
                                                    var botMessageElement = chatContainer.querySelector('.bot-message-chat-2.typing11');
                                                    botMessageElement.innerHTML = responseHTML.substring(0, index);
                                                    index++;  
                                                
                                                    if (index <= responseHTML.length) {
                                                        setTimeout(typeWriter, typingSpeed * 1000);
                                                        scrollToBottom();
                                                    } else {
                                                        botMessageElement.classList.remove('typing11');
                                                        scrollToBottom();
                                                        var buttonContainerHTML = '<div id="patterns" class="button-container">' +
                                                            '<button onclick="handleButtonClick(\'today\', \'1\', \'' + pattern + '\', \'' + userInputHistory + '\', \'' + ntype + '\')">Today</button>' +
                                                            '<button onclick="handleButtonClick(\'last week\', \'7\', \'' + pattern + '\', \'' + userInputHistory + '\', \'' + ntype + '\')">Last Week</button>'+
                                                            '<button onclick="handleButtonClick(\'last month\', \'30\', \'' + pattern + '\', \'' + userInputHistory + '\', \'' + ntype + '\')">Last Month</button>' +
                                                            '<button onclick="handleButtonClick(\'six month\', \'180\', \'' + pattern + '\', \'' + userInputHistory + '\', \'' + ntype + '\')">Six Month</button>' +
                                                            '<button onclick="handleButtonClick(\'one year\', \'365\', \'' + pattern + '\', \'' + userInputHistory + '\', \'' + ntype + '\')">One Year</button>' +
                                                            '</div>';
                                                        chatContainer.innerHTML += botTimeHTML;
                                                        scrollToBottom();
                                                        setTimeout(function() {
                                                            value_search(pattern);
                                                        }, 0);
                                                        userInputElement.removeEventListener('keypress', userInputElement._listener);
                                                    }
                                                }
                                                
                                                var index = 0;
                                                closeType();
                                                typeWriter();
                                            })
                                            .catch(error => {
                                                console.error('Error:', error);
                                            });
                                        } else {
                                            alert('Please provide a valid booking number');
                                        }
                                    }
                                };
                                userInputElement.addEventListener('keypress', userInputElement._listener);
                            } else if (data.response2 === 'The number of quotations from name is namequotation.' || data.response2 === 'The number of buyings from name is namebuying.' || data.response2 === 'The number of enquirys from name is nameenquiry.' || data.response2 === 'The number of leads from name is namelead.' || data.response2 === 'The number of sellings from name is nameselling.' || data.response2 === 'The number of payments from name is namepayment.' || data.response2 === 'The number of receipts from name is namereceipt.' || data.response2 === 'The number of ffrBookings from name is nameffrBooking.' || data.response2 === 'The number of billoflads from name is namebilloflad.' || data.response2 === 'The number of awbs from name is nameawb.' || data.response2 === 'The number of custombookings from name is namecustombooking.' || data.response2 === 'The number of for last month with name is leadquery.' || data.response2 === 'The number of for last month with name is enquiryquery.' || data.response2 === 'The number of for last month with name is quotationquery.') {
                                var ntype = 'non_gross'
                                var responseMarkdown = data.response + 'Select the time frame if you want to know the same details in that time frame.';
                                var converter = new showdown.Converter();
                                var responseHTML = converter.makeHtml(responseMarkdown);
                                
                                var typingSpeed = 1e-15;
                                
                                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id="dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 22px;">
                                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                                </div></div><div class="bot-message-chat-res typingmon" style="line-height: 1.5;"></div></div>`;
                                
                                chatContainer.innerHTML += botMessageHTML;
                                
                                var currentTime = new Date().toLocaleTimeString();
                                var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                                
                                function typeWriter() {
                                    var botMessageElement = chatContainer.querySelector('.bot-message-chat-res.typingmon');
                                    var words = responseHTML.split(' ');
                                    var currentText = words.slice(0, index).join(' ');
                                    botMessageElement.innerHTML = currentText;
                                    index++;  
                                    
                                    if (index <= words.length) {
                                        setTimeout(typeWriter, typingSpeed * 1000);
                                        scrollToBottombottable();
                                        scrollToBottom();
                                    } else {
                                        botMessageElement.classList.remove('typingmon');
                                        
                                        var buttonContainerHTML = '<div id="patterns" class="button-container">' +
                                            '<button onclick="handleButtonClick(\'today\', \'1\', \'' + pattern + '\', \'' + userInputHistory + '\', \'' + ntype + '\')">Today</button>' +
                                            '<button onclick="handleButtonClick(\'last week\', \'7\', \'' + pattern + '\', \'' + userInputHistory + '\', \'' + ntype + '\')">Last Week</button>' +
                                            '<button onclick="handleButtonClick(\'last month\', \'30\', \'' + pattern + '\', \'' + userInputHistory + '\', \'' + ntype + '\')">Last Month</button>' +
                                            '<button onclick="handleButtonClick(\'six month\', \'180\', \'' + pattern + '\', \'' + userInputHistory + '\', \'' + ntype + '\')">Six Month</button>' +
                                            '<button onclick="handleButtonClick(\'one year\', \'365\', \'' + pattern + '\', \'' + userInputHistory + '\', \'' + ntype + '\')">One Year</button>' +
                                            '</div>';

                                        chatContainer.innerHTML += botTimeHTML + buttonContainerHTML;
                                        scrollToBottom();
                                        
                                        setTimeout(function() {
                                            send_inputs(pattern);
                                        }, 0);
                                        
                                        userInputElement.removeEventListener('keypress', userInputElement._listener);
                                    }
                                }                                
                                
                                var index = 0;
                                closeType();
                                typeWriter();                                
                                
                            } else {
                                var responseMarkdown = data.response;
                                var converter = new showdown.Converter();
                                var responseHTML = converter.makeHtml(responseMarkdown);
                                var typingSpeed = 1e-15;
                                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 22px;">
                                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                                </div></div><div class="bot-message-chat-2 typingmon" style="line-height: 1.5;"></div></div>`;
                                chatContainer.innerHTML += botMessageHTML;
                                var currentTime = new Date().toLocaleTimeString();
                                var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

                                function typeWriter() {
                                    var botMessageElement = chatContainer.querySelector('.bot-message-chat-2.typingmon');
                                    botMessageElement.innerHTML = responseHTML.substring(0, index);
                                    index++;  
                                
                                    if (index <= responseHTML.length) {
                                        setTimeout(typeWriter, typingSpeed * 1000);
                                        scrollToBottom();
                                    } else {
                                        botMessageElement.classList.remove('typingmon');
                                        scrollToBottom();
                                        chatContainer.innerHTML += botTimeHTML;
                                        scrollToBottom();
                                        setTimeout(function() {
                                            send_inputs(pattern);
                                        }, 0);
                                        userInputElement.removeEventListener('keypress', userInputElement._listener);
                                    }
                                }
                                
                                var index = 0;
                                closeType();
                                typeWriter();
                            }
                        })
                        .catch(error => {
                            console.error('Error:', error);
                        });
                    } else {
                        alert('Please provide a valid input');
                    } 
                }
            };
        
            userInputElement.addEventListener('keypress', userInputElement._listener);
        }        

        function handleButtonClick(message, month, pattern, userInputHistory, ntype) {
            simpleUserMessage(message);
            months_input(month, pattern, message, userInputHistory, ntype);
        }   

        function months_input(month, pattern, message, userInputHistory, ntype){
            typingMessage();
                            fetch('/chat_input', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json',
                                },
                                body: JSON.stringify({
                                    user_input: {
                                        'month': month,
                                        'user_text': userInputHistory,
                                        'field': ntype,
                                        'section': pattern,
                                        'time_period': message,
                                        'environment': environment,
                                        'current_date': formattedDate,
                                        'tenantid': tenantid,
                                        'officeid': officeid,
                                        'userid': userid,
                                        'ffrid': ffrid,
                                        'chaid': chaid
                                    }
                                }),
                            })
                            .then(response => response.json())
                            .then(data => {
                                if (data.response){
                                    var responseMarkdown = data.response  + 'Select the time frame if you want to know the same details in that time frame.';
                                    var converter = new showdown.Converter();
                                    var responseHTML = converter.makeHtml(responseMarkdown);
                                    var typingSpeed = 1e-15;
                                    var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 22px;">
                                        <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                                    </div></div><div class="bot-message-chat-res typingmon" style="line-height: 1.5;"></div></div>`;
                                    chatContainer.innerHTML += botMessageHTML;
                                    var currentTime = new Date().toLocaleTimeString();
                                    var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

                                    function typeWriter() {
                                        var botMessageElement = chatContainer.querySelector('.bot-message-chat-res.typingmon');
                                        var words = responseHTML.split(' '); // Split the response HTML into words
                                        var currentText = words.slice(0, index).join(' '); // Join the words up to the current index
                                        botMessageElement.innerHTML = currentText;
                                        index++;  
                                        
                                        if (index <= words.length) { // Check if there are more words to type
                                            setTimeout(typeWriter, typingSpeed * 1000); // Multiply by 1000 to convert seconds to milliseconds
                                            scrollToBottom();
                                        } else {
                                            botMessageElement.classList.remove('typingmon');
                                            
                                            var buttonContainerHTML = '<div id="patterns" class="button-container">' +
                                                '<button onclick="handleButtonClick(\'today\', \'1\', \'' + pattern + '\', \'' + userInputHistory + '\', \'' + ntype + '\')">Today</button>' +
                                                '<button onclick="handleButtonClick(\'last week\', \'7\', \'' + pattern + '\', \'' + userInputHistory + '\', \'' + ntype + '\')">Last Week</button>' +
                                                '<button onclick="handleButtonClick(\'last month\', \'30\', \'' + pattern + '\', \'' + userInputHistory + '\', \'' + ntype + '\')">Last Month</button>' +
                                                '<button onclick="handleButtonClick(\'six month\', \'180\', \'' + pattern + '\', \'' + userInputHistory + '\', \'' + ntype + '\')">Six Month</button>' +
                                                '<button onclick="handleButtonClick(\'one year\', \'365\', \'' + pattern + '\', \'' + userInputHistory + '\', \'' + ntype + '\')">One Year</button>' +
                                                '</div>';

                                            chatContainer.innerHTML += botTimeHTML + buttonContainerHTML;
                                            scrollToBottom();
                                            
                                            setTimeout(function() {
                                                send_inputs(pattern);
                                            }, 0);
                                            
                                            userInputElement.removeEventListener('keypress', userInputElement._listener);
                                        }
                                    }
                                
                                    var index = 0;
                                    closeType();
                                    typeWriter();
                                    
                            }
                            })
                            .catch(error => {
                                console.error('Error:', error);
                            });
                        }
        function sendPattern2(tag){
            var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
            </div></div><div class="bot-message-chat">Please type in to Search...</b></div></div>`;
            //var botMessageHTML = '<div class="message-container"><div class="bot-avatar"><img src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 30px; height: auto;"></div><div class="bot-message">Please type in to Search...</div></div>';
            chatContainer.innerHTML += botMessageHTML;
            scrollToBottom();
            sendPattern3(tag);
        }  
        
        function loadIframe(linkElement, link) {
            if (confirm("Do you want to open this link here? Click 'OK' to open in iframe or 'Cancel' to open in a new tab.")) {
                var formattedLink = link.startsWith("http") ? link : "https://" + link;
            var iframeHTML = `
                <div class="iframe-container">
                    <iframe class="news-iframe" src="${formattedLink}" frameborder="0"></iframe>
                    <button class="close-button">Close</button>
                </div>
            `;
            var iframeContainer = document.createElement('div');
            iframeContainer.innerHTML = iframeHTML;
        
            linkElement.parentElement.innerHTML = iframeContainer.innerHTML;

            document.addEventListener('click', function(event) {
                if (event.target.classList.contains('close-button')) {
                    var linkHTML = `<a class="news-link" href="#" onclick="loadIframe(this, '${link}')">${link}</a>`;
                    var iframeContainer = event.target.closest('.iframe-container');
                    if (iframeContainer) {
                        iframeContainer.innerHTML = linkHTML;
                    }
                }
            });
            } else {
                window.open(link, '_blank');
            }
        }                                                             

        function sendPattern3(tag){
            var userInput = document.getElementById('user-input');
            userInput.focus();

            var userInputElement = document.getElementById('user-input');

            if (userInputElement._listener) {
                userInputElement.removeEventListener('keypress', userInputElement._listener);
            }

            userInputElement._listener = function(event) {
                if (event.key === 'Enter') {
                    event.preventDefault();
                    var botMessageCheck = document.querySelector('.bot-message-check-'+ tag.toLowerCase() +'');
                    if (botMessageCheck) {
                        botMessageCheck.remove();
                    }

                    var userInput = this.value.trim();

                    userInputHistory = [];
                    userInputHistory.push(userInput);

                    simpleUserMessage(userInput);

                    this.value = '';

                    if (userInput !== '') {
                        typingMessage();

                        fetch('/chat', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify({
                                user_input: {
                                    'tag': tag,
                                    'input': userInput,
                                    'environment': environment,
                                    'current_date': formattedDate,
                                    'tenantid': tenantid,
                                    'officeid': officeid,
                                    'userid': userid
                                }
                            }),
                        })
                        .then(response => response.json())
                        .then(data => {
                            console.log(data.response);
                            if (Array.isArray(data.response)) {
                                var newsItems = data.response;
                                var newsResultsHTML = '';
                        
                                newsItems.forEach(newsItem => {
                                    newsResultsHTML += `
                                        <div class="news-item">
                                            <h2 class="news-title">${newsItem.title}</h2>
                                            <p><a class="news-link" href="#" onclick="loadIframe(this, '${newsItem.link}')">${newsItem.link}</a></p>
                                            <p class="news-snippet">${newsItem.snippet}</p>
                                        </div>
                                    `;
                                });
                                var responseHTML = newsResultsHTML + '<div style="margin-top: 20px;">These are the go-to websites relevant to your search.</div>';
                                var typingSpeed = 1e-15;
                                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                                </div></div><div class="bot-message-chat typingcse">`;
                                chatContainer.innerHTML += botMessageHTML;
                                var currentTime = new Date().toLocaleTimeString();
                                var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';

                                function typeWriter() {
                                    var botMessageElement = chatContainer.querySelector('.bot-message-chat.typingcse');
                                    var words = responseHTML.split(' ');
                                    var currentText = words.slice(0, index).join(' ');
                                    botMessageElement.innerHTML = currentText;
                                    index++;
                                                        
                                    if (index <= words.length) {
                                        setTimeout(typeWriter, typingSpeed * 1000);
                                        scrollToBottom();
                                    } else {
                                        botMessageElement.classList.remove('typingcse');
                                        chatContainer.innerHTML += botTimeHTML;   
                                        scrollToBottom();
                                    }
                                }
                                                        
                                var index = 0;               
                                typeWriter();
                                
                            } else {
                                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                                </div></div><div class="bot-message-chat">${data.response}</b></div></div>`;
                        
                                var currentTime = new Date().toLocaleTimeString();
                                var botTimeHTML = `<div class="bot-time">EZEEBOT, ${currentTime}</div>`;
                        
                                chatContainer.innerHTML += botMessageHTML + botTimeHTML;
                            }
                        
                            closeType();
                            scrollToBottom();
                            setTimeout(function() {
                                sendPattern3(tag);
                            }, 0);
                            userInputElement.removeEventListener('keypress', userInputElement._listener);
                        })                                                
                        .catch(error => {
                            console.error('Error:', error);
                        });
                    } else {
                        alert('Please provide a valid input');
                    } 
                }
            };
        
            userInputElement.addEventListener('keypress', userInputElement._listener);
        }

        function simpleUserMessage(message){
            var userMessageHTML = '<div class="message-container"><div class="user-message">' + capitalizeFirstLetter(message) + '</div></div>';
            chatContainer.innerHTML += userMessageHTML;
            var tagsDiv = document.getElementById('patterns');
                if (tagsDiv) {
                    tagsDiv.parentNode.removeChild(tagsDiv);
                }
        }

        function simpleUserMessage3(message) {
            var formattedMessage = message;
            if (Array.isArray(message)) {
                formattedMessage = message.join(', ');
            }

            formattedMessage = formattedMessage.replace(/(?:^|, )(\w+)/g, function(match) {
                return match.charAt(0).toUpperCase() + match.slice(1);
            });
        
            var userMessageHTML = '<div class="message-container"><div class="user-message">' + formattedMessage + '</div></div>';
            chatContainer.innerHTML += userMessageHTML;

            var tagsDiv = document.getElementById('patterns');
            if (tagsDiv) {
                tagsDiv.parentNode.removeChild(tagsDiv);
            }
        }                

        function simpleUserMessage2(message){
            var userMessageHTML = '<div class="message-container"><div class="user-message">' + message + '</div></div>';
            chatContainer.innerHTML += userMessageHTML;
            askBookingNumber2(message);
            var tagsDiv = document.getElementById('patterns');
                if (tagsDiv) {
                    tagsDiv.parentNode.removeChild(tagsDiv);
                }
        }

        function quotation(messages){
            var inputValues = {};
            var currentIndex = 0;
            var userInputElement = document.getElementById('user-input');
        
            function displayPrompt() {
                var message = messages[currentIndex];
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat">`;
                //var botMessageHTML = '<div class="message-container"><div class="bot-avatar"><img src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 30px; height: auto;"></div><div class="bot-message">';
                var botMessageHTML2 = '<div class="message-container"><div class="bot-message-time">';

                    if (message.toLowerCase() === "from date") {
                        botMessageHTML += 'Please enter the "<b>' + message + '</b>"';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        var currentDate = new Date();
                        currentDate.setMonth(currentDate.getMonth() - 1);
    
                        var year = currentDate.getFullYear();
                        var month = String(currentDate.getMonth() + 1).padStart(2, '0');
                        var day = String(currentDate.getDate()).padStart(2, '0');
                        var hours = String(currentDate.getHours()).padStart(2, '0');
                        var minutes = String(currentDate.getMinutes()).padStart(2, '0');
                        var defaultDate = year + '-' + month + '-' + day + 'T' + hours + ':' + minutes;
    
                        botMessageHTML2 += '<input type="datetime-local" id="datetime-input" value="' + defaultDate + '">';
                        chatContainer.innerHTML += botMessageHTML2;
                        setTimeout(function() {
                            var datetimeInput = document.getElementById('datetime-input');
                            datetimeInput.focus();
                        }, 0);
                        scrollToBottom();
                
                        var datetimeInput = document.getElementById('datetime-input');
    
                        userInputElement.style.display = 'none';
                
                        datetimeInput.addEventListener('blur', function(event) {
                            var userInput = this.value.trim().split("T")[0];
                            simpleUserMessage(userInput);
                
                            inputValues["quo" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
    
                            var botMessageCheck = document.querySelector('.bot-message-time');
                            if (botMessageCheck) {
                                botMessageCheck.remove();
                            }
    
                            userInputElement.style.display = 'block';
                
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        });
                    } else if (message.toLowerCase() === "to date") {
                        botMessageHTML += 'Please enter the "<b>' + message + '</b>"';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        var defaultDate = new Date().toISOString().slice(0, 16);
                        botMessageHTML2 += '<input type="datetime-local" id="datetime-input" value="' + defaultDate + '">';
                        chatContainer.innerHTML += botMessageHTML2;
                        setTimeout(function() {
                            var datetimeInput = document.getElementById('datetime-input');
                            datetimeInput.focus();
                        }, 0);
                        scrollToBottom();
                
                        var datetimeInput = document.getElementById('datetime-input');
    
                        userInputElement.style.display = 'none';
                
                        datetimeInput.addEventListener('blur', function(event) {
                            var userInput = this.value.trim().split("T")[0];
                            simpleUserMessage(userInput);
                
                            inputValues["quo" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
    
                            var botMessageCheck = document.querySelector('.bot-message-time');
                            if (botMessageCheck) {
                                botMessageCheck.remove();
                            }
    
                            userInputElement.style.display = 'block';
                
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        });
                    } else {
                    botMessageHTML += 'Please type in the "<b>' + message + '</b>"';
                    chatContainer.innerHTML += botMessageHTML;
                    var currentTime = new Date().toLocaleTimeString();
                    var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                    chatContainer.innerHTML += botTimeHTML;
                    scrollToBottom();
            
                    userInputElement.focus();
            
                    if (userInputElement._listener) {
                        userInputElement.removeEventListener('keypress', userInputElement._listener);
                    }
            
                    userInputElement._listener = function (event) {
                        if (event.key === 'Enter') {
                            event.preventDefault();
                            var userInput = this.value.trim();
                            simpleUserMessage(userInput);
            
                            inputValues["quo" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
            
                            this.value = '';
            
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        }
                    };
            
                    userInputElement.addEventListener('keypress', userInputElement._listener);
                }
            }
        
            function sendAllInputs() {
                typingMessage();
                fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_input: {
                            ...inputValues,
                            'current_date': formattedDate,
                            'tenantid': tenantid,
                            'officeid': officeid,
                            'userid': userid,
                            'userid2': userid2,
                            'environment': environment,
                            'userid2': userid2
                        }
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    var inputSummary = '<b>[ </b>' + Object.keys(inputValues).map(function(key, index, array) {
                        var displayKey = key.replace(/^quo/, '').replace(/_/g, ' ');
                        var comma = (index !== array.length - 1) ? ', ' : '';
                        return '<b>' + displayKey + ':</b> ' + inputValues[key] + comma;
                    }).join('') + '<b> ]</b>';        
                    
                    var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                        <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                    </div></div><div class="bot-message-booking"><b>Quotation search result based on your criteria </b>${formatKeyValueList(inputSummary)}`;
                    
                    //var botMessageHTML = '<div class="message-container"><div class="bot-avatar"><img src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 30px; height: auto;"></div><div class="bot-message-booking"><b>Quotation search result based on your criteria <br><br></b>' + '<span style="font-size:14px;">' + formatKeyValueList(inputSummary) + '</span><br><br>';

                        var bookingSets = data.response.split('},');

                        if (bookingSets.length > 1) {
                            botMessageHTML += '<b>Multiple entries found. Please pick one to view more details</b><br><br>';
                            var counter = 1;
                            var buttonHTML = '';
                        
                            bookingSets.forEach((bookingSet, index) => {
                                var cleanedBookingSet = bookingSet.replace(/[\[\]{}"]/g, '');
                        
                                if (cleanedBookingSet.trim() !== '') {
                                    cleanedBookingSet = cleanedBookingSet.trim();
                        
                                    var keyValuePairs = cleanedBookingSet.split(',');
                        
                                    var bookingNumber = '';
                                    var statusCode = '';
                                    var det = '';
                                    var bookingHTML = '<table class="booking-details">';
                                    keyValuePairs.forEach(pair => {
                                        var parts = pair.split(':');
                                        var key = parts[0].trim();
                                        var value = parts.slice(1).join(':').trim();
                        
                                        if (key.toUpperCase() === 'QUOTATION NUMBER') {
                                            if (value === 'null') {
                                                bookingNumber = null;
                                            } else {
                                                bookingNumber = value;
                                            }
                                        } else if (key.toUpperCase() === 'SEARCH COMPANY') {
                                            if (value === 'null') {
                                                searchcompany = null;
                                            } else {
                                                searchcompany = value;
                                            }
                                        } else if (key.toUpperCase() === 'STATUS' && !bookingNumber) {
                                            statusCode = value;
                                        } else if (key.toUpperCase() === 'SHIPMENT TYPE') {
                                            det += value;
                                        } else if (key.toUpperCase() === 'CONTACT NAME') {
                                            det += value;
                                        } else if (key.toUpperCase() === 'SHIPMENT TERM') {
                                            det += value;
                                        } else if (key.toUpperCase() === 'ORIGIN') {
                                            det += value;
                                        } else if (key.toUpperCase() === 'DESTINATION') {
                                            det += value;
                                        } else if (key.toUpperCase() === 'STATUS') {
                                            det += value;
                                        } else if (key.toUpperCase() === 'QUOTATION DATE') {
                                            quodate = value;
                                        }
                        
                                        bookingHTML += '<tr><td><span class="key">' + key + '</span></td><td><span class="value">' + value + '</span></td></tr>\n';
                                    });
                                    bookingHTML += '</table>';
                        
                                    if (!bookingNumber) {
                                        buttonHTML += '<button class="booking-button" onclick="showBookingDetails(\'' + bookingNumber + '\', ' + counter + ')"><div style="float: left; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; border-right: 2px solid #f2f2f2;">' + searchcompany + '<span color: transparent;' + det +'</span></div><div style="display: inline-block; text-align: center; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center;">' + quodate + '</div><div style="float: right; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: right; border-left: 2px solid #f2f2f2;">' + statusCode + '</div></button><br>';
                                    } else {
                                        buttonHTML += '<button class="booking-button" onclick="showBookingDetails(\'' + bookingNumber + '\', ' + counter + ')"><div style="float: left; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; border-right: 2px solid #f2f2f2;">' + searchcompany + '<span color: transparent;' + det +'</span></div><div style="display: inline-block; text-align: center; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center;">' + quodate + '</div><div style="float: right; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: right; border-left: 2px solid #f2f2f2;">' + bookingNumber + '</div></button><br>';
                                    }

                                    buttonHTML += '<div id="' + counter + 'bookingDetails_' + bookingNumber + '" style="display: none;">' + bookingHTML + '</div><br>';
                                    counter++;
                                }
                            });

                            var botDiv = `<div style="border: 1px solid transparent; padding-top: 10px; padding-left: 2px; padding-right: 2px; padding-bottom: 3px; border-radius: 10px; margin-top: 10px; background-color: #c0c0c0;">`;
                            botDiv += '<input type="text" id="search-input" style="width: 100%;" placeholder="Global Search...">';
                            var botDiv2 = `<div style="border-left: 1px solid transparent; background-color: #e5e4e2; padding: 4px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px;">`;
                            botDiv2 += '<div id="num" style="font-size: 14px; display: flex; padding: 5px; align-items: left; justify-content: left;"></div>';
                            botDiv2 += '<div><table style="border-collapse: collapse; width: 100%; margin-bottom: 5px;"><thead style="background-color: #002147; color: white;"><tr><th style="border: 1px solid #dddddd; text-align: left; padding: 8px; width: 33.17%;">COMPANY</th><th style="border: 1px solid #dddddd; text-align: center; padding: 8px; width: 33.16%;">QUOTATION DATE</th><th style="border: 1px solid #dddddd; text-align: right; padding: 8px; width: 33.66%;">QUOTATION NO</th></tr></thead></table></div>';
                            botDiv2 +=  '<div id="bot-message-scroll" style="max-height: 250px; overflow-y: auto; overflow-x: hidden;">' + buttonHTML +'</div>';
                            botDiv2 += `</div>`;
                            botDiv += botDiv2;
                            botDiv += `</div>`;
                            botMessageHTML += botDiv;
                            botMessageHTML += '<div style="margin-top: 20px;"><b>If you have any questions or concerns about the results, please verify them using our application or contact our support team.</b></div>';
                        }
                         else {
                            bookingSets.forEach(bookingSet => {
                                var cleanedBookingSet = bookingSet.replace(/[\[\]{}"]/g, '');
                        
                                if (cleanedBookingSet.trim() !== '') {
                                    cleanedBookingSet = cleanedBookingSet.trim();
                        
                                    var keyValuePairs = cleanedBookingSet.split(',');
                        
                                    var bookingHTML = '<table class="booking-details">';
                                    keyValuePairs.forEach(pair => {
                                        var parts = pair.split(':');
                                        var key = parts[0].trim();
                                        var value = parts.slice(1).join(':').trim();
                        
                                        bookingHTML += '<tr><td><span class="key">' + key + '</span></td><td><span class="value">' + value + '</span></td></tr>\n';
                                    });
                                    bookingHTML += '</table><br>';
                                    botMessageHTML += bookingHTML;
                                }
                            });
                        }
                        
                        botMessageHTML += '</div></div>';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">'+ 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        document.addEventListener('input', function (event) {
                            if (event.target.id === 'search-input') {
                                var searchValue = event.target.value.toLowerCase();
                                var botMessageScroll = document.getElementById('bot-message-scroll');
                                var buttons = botMessageScroll.getElementsByClassName('booking-button');
                                var moduleName = 'quotations';

                                filterButtons(searchValue, buttons, moduleName);
                            }
                        });
                        closeType(); 
                        scrollToBottom();
                
                    userInputElement.removeEventListener('keypress', userInputElement._listener);
                })
                .catch(error => {
                    console.error('Error:', error);
                });                
        
            }
            displayPrompt();
        } 
        
        function filterButtons(searchValue, buttons, moduleName) {
            console.log('enter');
            var botMessageScroll = document.getElementById('bot-message-scroll');
            var existingNoRecordsMessage = botMessageScroll.querySelector('.no-records-message');
        
            for (var i = 0; i < buttons.length; i++) {
                buttons[i].style.display = 'none';
            }
        
            var buttonsFound = false;
            var filteredCount = 0;
        
            function debounce(func) {
                var timeoutId;
                return function () {
                    var context = this;
                    var args = arguments;
                    clearTimeout(timeoutId);
                    timeoutId = setTimeout(function () {
                        func.apply(context, args);
                    });
                };
            }
        
            var debouncedFilter = debounce(function () {
                for (var i = 0; i < buttons.length; i++) {
                    var button = buttons[i];
                    var buttonHTML = button.outerHTML.toLowerCase();
                    if (buttonHTML.includes(searchValue.toLowerCase())) {
                        button.style.display = 'block';
                        button.style.marginBottom = '20px';
                        botMessageScroll.prepend(button);
                        buttonsFound = true;
                        filteredCount++;
                    }
                }
        
                if (!buttonsFound && !existingNoRecordsMessage) {
                    var noRecordsMessage = document.createElement('div');
                    noRecordsMessage.className = 'no-records-message';
                    noRecordsMessage.innerText = 'No records found';
                    botMessageScroll.prepend(noRecordsMessage);
                }
        
                if (buttonsFound && existingNoRecordsMessage) {
                    existingNoRecordsMessage.remove();
                }
        
                console.log('Filtered Button Count:', filteredCount);
                
                var filterCountDiv = document.getElementById('num');
                if (filterCountDiv) {
                    if (searchValue.toLowerCase() === '') {
                        filterCountDiv.innerHTML = '<b>Total number of&nbsp;' + moduleName + '&nbsp;are&nbsp<span style="color: red">' + filteredCount + '</span></b>';
                    }else{
                        filterCountDiv.innerHTML = "<b>Number of&nbsp;" + moduleName + "&nbsp;for your search&nbsp;'" + searchValue.toUpperCase() + "'&nbsp;is&nbsp;<span style='color: red'>" + filteredCount + "</span></b>";
                    }
                }
                
                botMessageScroll.scrollTop = 0;
            });
        
            debouncedFilter();
        }                                            
        
        function showBookingDetails(bookingNumber, counter) {
            var currentDetailsDiv = document.getElementById('booking-details');
            if (currentDetailsDiv !== null) {
                currentDetailsDiv.parentNode.removeChild(currentDetailsDiv);
            }
        
            var bookingDetailsDivs = document.querySelectorAll('[id^="' + counter + 'bookingDetails_"]');
        
            bookingDetailsDivs.forEach(function(bookingDetailsDiv) {
                var actualBookingNumber = bookingDetailsDiv.id.split('_')[1];
        
                if (actualBookingNumber === bookingNumber) {
                    var messageDiv = document.createElement('div');
                    messageDiv.id = 'message-det';
                    messageDiv.style.position = 'relative';
                    messageDiv.style.border = '1px solid black';
                    messageDiv.style.marginTop = '0px';
                    messageDiv.style.height = '25px';
                    var textSpan = document.createElement('span');
                    textSpan.textContent = 'DETAILS OF ' + bookingNumber;
                    textSpan.style.position = 'absolute';
                    textSpan.style.top = '5px';
                    textSpan.style.left = '5px';
                    textSpan.style.display = 'block';

                    messageDiv.appendChild(textSpan);

                    var detailsDiv = document.createElement('div');
                    detailsDiv.id = 'booking-details';
                    detailsDiv.className = 'booking-details';
        
                    var clonedDetails = bookingDetailsDiv.cloneNode(true);
        
                    clonedDetails.style.display = 'block';
                    clonedDetails.style.overflowY = 'auto';
        
                    detailsDiv.style.height = '300px';
                    detailsDiv.style.overflowY = 'auto';
                    
                    detailsDiv.appendChild(messageDiv);
                    detailsDiv.appendChild(clonedDetails);
        
                    var botMessageScrolls = document.querySelectorAll('#bot-message-scroll');
                    var botMessageScroll = botMessageScrolls[botMessageScrolls.length - 1];
                    detailsDiv.style.display = 'inline-block';
                    detailsDiv.style.marginBottom = '20px';
                    detailsDiv.style.borderTop = '1px solid black';
                    
                    botMessageScroll.insertAdjacentElement('afterbegin', detailsDiv);
                    scrollToBottom();
                    botScroll();
        
                    if (!document.getElementById('close-button')) {
                        var closeButton = document.createElement('button');
                        closeButton.id = 'close-button';
                        var textSpan2 = document.createElement('span');
                        textSpan2.textContent = 'X';
                        textSpan2.style.position = 'absolute';
                        textSpan2.style.fontSize = '12px';
                        textSpan2.style.top = '0.5px';
                        textSpan2.style.right = '4.5px';
                        textSpan2.style.display = 'block';
                        closeButton.appendChild(textSpan2);
                        closeButton.style.fontWeight = 'bold';
                        closeButton.style.borderRadius = '2px';
                        closeButton.style.cursor = 'pointer';
                        closeButton.style.backgroundColor = '#ff0000';
                        closeButton.style.color = 'white';
                        closeButton.style.position = 'absolute';
                        closeButton.style.top = '4px';
                        closeButton.style.height = '17px';
                        closeButton.style.width = '19px';
                        closeButton.style.right = '2px';
                        closeButton.addEventListener('click', function() {
                            detailsDiv.style.display = 'none';
                            closeButton.parentNode.removeChild(closeButton);
                        });
                        //detailsDiv.parentNode.insertBefore(closeButton, detailsDiv.nextSibling);
                        messageDiv.appendChild(closeButton);
                    } else {
                        closeButton = document.getElementById('close-button');
                        closeButton.addEventListener('click', function() {
                            detailsDiv.style.display = 'none';
                            closeButton.parentNode.removeChild(closeButton);
                        });
                    }
                }
            });
        }      

        function botScroll() {
            var botScroll = document.getElementById('bot-message-scroll');
            botScroll.scrollTop = 0;
        }

        function lead(messages) {
            var inputValues = {};
            var currentIndex = 0;
            var userInputElement = document.getElementById('user-input');
        
            function displayPrompt() {
                var message = messages[currentIndex];
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat">`;
                //var botMessageHTML = '<div class="message-container"><div class="bot-avatar"><img src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 30px; height: auto;"></div><div class="bot-message">';
                var botMessageHTML2 = '<div class="message-container"><div class="bot-message-time">';

                    if (message.toLowerCase() === "from date") {
                        botMessageHTML += 'Please enter the "<b>' + message + '</b>"';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        var currentDate = new Date();
                        currentDate.setMonth(currentDate.getMonth() - 1);
    
                        var year = currentDate.getFullYear();
                        var month = String(currentDate.getMonth() + 1).padStart(2, '0');
                        var day = String(currentDate.getDate()).padStart(2, '0');
                        var hours = String(currentDate.getHours()).padStart(2, '0');
                        var minutes = String(currentDate.getMinutes()).padStart(2, '0');
                        var defaultDate = year + '-' + month + '-' + day + 'T' + hours + ':' + minutes;
    
                        botMessageHTML2 += '<input type="datetime-local" id="datetime-input" value="' + defaultDate + '">';
                        chatContainer.innerHTML += botMessageHTML2;
                        setTimeout(function() {
                            var datetimeInput = document.getElementById('datetime-input');
                            datetimeInput.focus();
                        }, 0);
                        scrollToBottom();
                
                        var datetimeInput = document.getElementById('datetime-input');
    
                        userInputElement.style.display = 'none';
                
                        datetimeInput.addEventListener('blur', function(event) {
                            var userInput = this.value.trim().split("T")[0];
                            simpleUserMessage(userInput);
                
                            inputValues["lead" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
    
                            var botMessageCheck = document.querySelector('.bot-message-time');
                            if (botMessageCheck) {
                                botMessageCheck.remove();
                            }
    
                            userInputElement.style.display = 'block';
                
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        });
                    } else if (message.toLowerCase() === "to date") {
                        botMessageHTML += 'Please enter the "<b>' + message + '</b>"';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        var defaultDate = new Date().toISOString().slice(0, 16);
                        botMessageHTML2 += '<input type="datetime-local" id="datetime-input" value="' + defaultDate + '">';
                        chatContainer.innerHTML += botMessageHTML2;
                        setTimeout(function() {
                            var datetimeInput = document.getElementById('datetime-input');
                            datetimeInput.focus();
                        }, 0);
                        scrollToBottom();
                
                        var datetimeInput = document.getElementById('datetime-input');
    
                        userInputElement.style.display = 'none';
                
                        datetimeInput.addEventListener('blur', function(event) {
                            var userInput = this.value.trim().split("T")[0];
                            simpleUserMessage(userInput);
                
                            inputValues["lead" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
    
                            var botMessageCheck = document.querySelector('.bot-message-time');
                            if (botMessageCheck) {
                                botMessageCheck.remove();
                            }
    
                            userInputElement.style.display = 'block';
                
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        });
                    } else {
                    botMessageHTML += 'Please type in the "<b>' + message + '</b>"';
                    chatContainer.innerHTML += botMessageHTML;
                    var currentTime = new Date().toLocaleTimeString();
                    var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                    chatContainer.innerHTML += botTimeHTML;
                    scrollToBottom();
            
                    userInputElement.focus();
            
                    if (userInputElement._listener) {
                        userInputElement.removeEventListener('keypress', userInputElement._listener);
                    }
            
                    userInputElement._listener = function (event) {
                        if (event.key === 'Enter') {
                            event.preventDefault();
                            var userInput = this.value.trim();
                            simpleUserMessage(userInput);
            
                            inputValues["lead" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
            
                            this.value = '';
            
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        }
                    };
            
                    userInputElement.addEventListener('keypress', userInputElement._listener);
                }
            }            
        
            function sendAllInputs() {
                typingMessage();
                fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_input: {
                            ...inputValues,
                            'current_date': formattedDate,
                            'tenantid': tenantid,
                            'officeid': officeid,
                            'userid': userid,
                            'userid2': userid2,
                            'environment': environment,
                            'userid2': userid2
                        }
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    var inputSummary = '<b>[ </b>' + Object.keys(inputValues).map(function(key, index, array) {
                        var displayKey = key.replace(/^lead/, '').replace(/_/g, ' ');
                        var comma = (index !== array.length - 1) ? ', ' : '';
                        return '<b>' + displayKey + ':</b> ' + inputValues[key] + comma;
                    }).join('') + '<b> ]</b>';                                                            
                    
                    var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                        <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                    </div></div><div class="bot-message-booking"><b>Lead search result based on your criteria </b>${formatKeyValueList(inputSummary)}`;
                    //var botMessageHTML = '<div class="message-container"><div class="bot-avatar"><img src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 30px; height: auto;"></div><div class="bot-message-booking"><b>Lead search result based on your criteria <br><br></b>' + '<span style="font-size:14px;">' + formatKeyValueList(inputSummary) + '</span><br><br>';

                        var bookingSets = data.response.split('},');

                        if (bookingSets.length > 1) {
                            botMessageHTML += '<b>Multiple entries found. Please pick one to view more details</b><br><br>';
                            var counter = 1;
                            var buttonHTML = '';
                        
                            bookingSets.forEach((bookingSet, index) => {
                                var cleanedBookingSet = bookingSet.replace(/[\[\]{}"]/g, '');
                        
                                if (cleanedBookingSet.trim() !== '') {
                                    cleanedBookingSet = cleanedBookingSet.trim();
                        
                                    var keyValuePairs = cleanedBookingSet.split(',');
                        
                                    var bookingNumber = '';
                                    var statusCode = '';
                                    var det = '';
                                    var bookingHTML = '<table class="booking-details">';
                                    keyValuePairs.forEach(pair => {
                                        var parts = pair.split(':');
                                        var key = parts[0].trim();
                                        var value = parts.slice(1).join(':').trim();
                        
                                        if (key.toUpperCase() === 'NAME') {
                                            if (value === 'null') {
                                                bookingNumber = null;
                                            } else {
                                                bookingNumber = value;
                                            }
                                        } else if (key.toUpperCase() === 'STATUS' && !bookingNumber) {
                                            statusCode = value;
                                        } else if (key.toUpperCase() === 'CREATED DATE') {
                                            createddate = value;
                                        }
                                        
                                        det += value + ',';
                                        bookingHTML += '<tr><td><span class="key">' + key + '</span></td><td><span class="value">' + value + '</span></td></tr>\n';
                                    });
                                    bookingHTML += '</table>';
                        
                                    if (!bookingNumber) {
                                        buttonHTML += '<button class="booking-button" onclick="showBookingDetails(\'' + bookingNumber + '\', ' + counter + ')"><div style="float: left; width: 50%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; border-right: 2px solid #f2f2f2;">' + statusCode + '<span color: transparent;' + det +'</span></div><div style="float: right; width: 40%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: right;">' + createddate + '</div></button><br>';
                                    } else {
                                        buttonHTML += '<button class="booking-button" onclick="showBookingDetails(\'' + bookingNumber + '\', ' + counter + ')"><div style="float: left; width: 50%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; border-right: 2px solid #f2f2f2;">' + bookingNumber + '<span color: transparent;' + det +'</span></div><div style="float: right; width: 40%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: right;">' + createddate + '</div></button><br>';
                                    }
                        
                                    buttonHTML += '<div id="' + counter + 'bookingDetails_' + bookingNumber + '" style="display: none;">' + bookingHTML + '</div><br>';
                                    counter++;
                                }
                            });

                                var botDiv = `<div style="border: 1px solid transparent; padding-top: 10px; padding-left: 2px; padding-right: 2px; padding-bottom: 3px; border-radius: 10px; margin-top: 10px; background-color: #c0c0c0;">`;
                                botDiv += '<input type="text" id="search-input" style="width: 100%;" placeholder="Global Search...">';
                            var botDiv2 = `<div style="border-left: 1px solid transparent; background-color: #e5e4e2; padding: 4px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px;">`;
                            botDiv2 += '<div id="num" style="font-size: 14px; display: flex; padding: 5px; align-items: left; justify-content: left;"></div>';
                                botDiv2 += '<div><table style="border-collapse: collapse; margin-left: -1px; width: 100%; margin-bottom: 5px;"><thead style="background-color: #002147; color: white;"><tr><th style="border: 1px solid #dddddd; text-align: left; padding: 8px; width: 50%;">NAME</th><th style="border: 1px solid #dddddd; text-align: right; padding: 8px; width: 50%;">CREATED DATE</th></tr></thead></table></div>';
                                botDiv2 += '<div id="bot-message-scroll" style="max-height: 250px; overflow-y: auto; overflow-x: hidden;">'+ buttonHTML +'</div>'; 
                                botDiv2 += `</div>`;
                                botDiv += botDiv2;
                                botDiv += `</div>`;
                                botMessageHTML += botDiv;     
                                botMessageHTML += '<div style="margin-top: 20px;"><b>If you have any questions or concerns about the results, please verify them using our application or contact our support team.</b></div>'; 
                        }
                         else {
                            bookingSets.forEach(bookingSet => {
                                var cleanedBookingSet = bookingSet.replace(/[\[\]{}"]/g, '');
                        
                                if (cleanedBookingSet.trim() !== '') {
                                    cleanedBookingSet = cleanedBookingSet.trim();
                        
                                    var keyValuePairs = cleanedBookingSet.split(',');
                        
                                    var bookingHTML = '<table class="booking-details">';
                                    keyValuePairs.forEach(pair => {
                                        var parts = pair.split(':');
                                        var key = parts[0].trim();
                                        var value = parts.slice(1).join(':').trim();
                        
                                        bookingHTML += '<tr><td><span class="key">' + key + '</span></td><td><span class="value">' + value + '</span></td></tr>\n';
                                    });
                                    bookingHTML += '</table><br>';
                                    botMessageHTML += bookingHTML;
                                }
                            });
                        }
                        
                        botMessageHTML += '</div></div>';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">'+ 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        document.addEventListener('input', function (event) {
                            if (event.target.id === 'search-input') {
                                var searchValue = event.target.value.toLowerCase();
                                var botMessageScroll = document.getElementById('bot-message-scroll');
                                var buttons = botMessageScroll.getElementsByClassName('booking-button');
                                var moduleName = 'leads';

                                filterButtons(searchValue, buttons, moduleName);
                            }
                        });
                        closeType();
                        scrollToBottom();
                
                    userInputElement.removeEventListener('keypress', userInputElement._listener);
                })
                .catch(error => {
                    console.error('Error:', error);
                });                
        
            }
            displayPrompt();
        }       

        function enquiry(messages){
            var inputValues = {};
            var currentIndex = 0;
            var userInputElement = document.getElementById('user-input');
        
            function displayPrompt() {
                var message = messages[currentIndex];
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat">`;
                //var botMessageHTML = '<div class="message-container"><div class="bot-avatar"><img src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 30px; height: auto;"></div><div class="bot-message">';
                var botMessageHTML2 = '<div class="message-container"><div class="bot-message-time">';

                    if (message.toLowerCase() === "from date") {
                        botMessageHTML += 'Please enter the "<b>' + message + '</b>"';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        var currentDate = new Date();
                        currentDate.setMonth(currentDate.getMonth() - 1);
    
                        var year = currentDate.getFullYear();
                        var month = String(currentDate.getMonth() + 1).padStart(2, '0');
                        var day = String(currentDate.getDate()).padStart(2, '0');
                        var hours = String(currentDate.getHours()).padStart(2, '0');
                        var minutes = String(currentDate.getMinutes()).padStart(2, '0');
                        var defaultDate = year + '-' + month + '-' + day + 'T' + hours + ':' + minutes;
    
                        botMessageHTML2 += '<input type="datetime-local" id="datetime-input" value="' + defaultDate + '">';
                        chatContainer.innerHTML += botMessageHTML2;
                        setTimeout(function() {
                            var datetimeInput = document.getElementById('datetime-input');
                            datetimeInput.focus();
                        }, 0);
                        scrollToBottom();
                
                        var datetimeInput = document.getElementById('datetime-input');
    
                        userInputElement.style.display = 'none';
                
                        datetimeInput.addEventListener('blur', function(event) {
                            var userInput = this.value.trim().split("T")[0];
                            simpleUserMessage(userInput);
                
                            inputValues["enq" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
    
                            var botMessageCheck = document.querySelector('.bot-message-time');
                            if (botMessageCheck) {
                                botMessageCheck.remove();
                            }
    
                            userInputElement.style.display = 'block';
                
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        });
                    } else if (message.toLowerCase() === "to date") {
                        botMessageHTML += 'Please enter the "<b>' + message + '</b>"';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        var defaultDate = new Date().toISOString().slice(0, 16);
                        botMessageHTML2 += '<input type="datetime-local" id="datetime-input" value="' + defaultDate + '">';
                        chatContainer.innerHTML += botMessageHTML2;
                        setTimeout(function() {
                            var datetimeInput = document.getElementById('datetime-input');
                            datetimeInput.focus();
                        }, 0);
                        scrollToBottom();
                
                        var datetimeInput = document.getElementById('datetime-input');
    
                        userInputElement.style.display = 'none';
                
                        datetimeInput.addEventListener('blur', function(event) {
                            var userInput = this.value.trim().split("T")[0];
                            simpleUserMessage(userInput);
                
                            inputValues["enq" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
    
                            var botMessageCheck = document.querySelector('.bot-message-time');
                            if (botMessageCheck) {
                                botMessageCheck.remove();
                            }
    
                            userInputElement.style.display = 'block';
                
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        });
                    } else {
                    botMessageHTML += 'Please type in the "<b>' + message + '</b>"';
                    chatContainer.innerHTML += botMessageHTML;
                    var currentTime = new Date().toLocaleTimeString();
                    var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                    chatContainer.innerHTML += botTimeHTML;
                    scrollToBottom();
            
                    userInputElement.focus();
            
                    if (userInputElement._listener) {
                        userInputElement.removeEventListener('keypress', userInputElement._listener);
                    }
            
                    userInputElement._listener = function (event) {
                        if (event.key === 'Enter') {
                            event.preventDefault();
                            var userInput = this.value.trim();
                            simpleUserMessage(userInput);
            
                            inputValues["enq" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
            
                            this.value = '';
            
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        }
                    };
            
                    userInputElement.addEventListener('keypress', userInputElement._listener);
                }
            }
        
            function sendAllInputs() {
                typingMessage();
                fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_input: {
                            ...inputValues,
                            'current_date': formattedDate,
                            'tenantid': tenantid,
                            'officeid': officeid,
                            'userid': userid,
                            'userid2': userid2,
                            'environment': environment,
                            'userid2': userid2
                        }
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    var inputSummary = '<b>[ </b>' + Object.keys(inputValues).map(function(key, index, array) {
                        var displayKey = key.replace(/^enq/, '').replace(/_/g, ' ');
                        var comma = (index !== array.length - 1) ? ', ' : '';
                        return '<b>' + displayKey + ':</b> ' + inputValues[key] + comma;
                    }).join('') + '<b> ]</b>';       

                    var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                        <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                    </div></div><div class="bot-message-booking"><b>Enquiry search result based on your criteria </b>${formatKeyValueList(inputSummary)}`;
                    //var botMessageHTML = '<div class="message-container"><div class="bot-avatar"><img src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 30px; height: auto;"></div><div class="bot-message-booking"><b>Enquiry search result based on your criteria <br><br></b>' + '<span style="font-size:14px;">' + formatKeyValueList(inputSummary) + '</span><br><br>';

                        var bookingSets = data.response.split('},');

                        if (bookingSets.length > 1) {
                            botMessageHTML += '<b>Multiple entries found. Please pick one to view more details</b><br><br>';
                            var counter = 1;
                            var buttonHTML = '';
                        
                            bookingSets.forEach((bookingSet, index) => {
                                var cleanedBookingSet = bookingSet.replace(/[\[\]{}"]/g, '');
                        
                                if (cleanedBookingSet.trim() !== '') {
                                    cleanedBookingSet = cleanedBookingSet.trim();
                        
                                    var keyValuePairs = cleanedBookingSet.split(',');
                                    var bookingNumber = '';
                                    var statusCode = '';
                                    var det = '';
                                    var bookingHTML = '';
                                    bookingHTML += '<table class="booking-details">';
                                    keyValuePairs.forEach(pair => {
                                        var parts = pair.split(':');
                                        var key = parts[0].trim();
                                        var value = parts.slice(1).join(':').trim();
                        
                                        if (key.toUpperCase() === 'ENQUIRY NUMBER') {
                                            if (value === 'null') {
                                                bookingNumber = null;
                                            } else {
                                                bookingNumber = value;
                                            }
                                        } else if (key.toUpperCase() === 'COMPANY') {
                                            if (value === 'null') {
                                                customername = null;
                                            } else {
                                                customername = value;
                                            }
                                        } else if (key.toUpperCase() === 'STATUS' && !bookingNumber) {
                                            statusCode = value;
                                        } else if (key.toUpperCase() === 'CREATED DATE') {
                                            createddate = value;
                                        }
                                        
                                        det += value + ',';
                                        bookingHTML += '<tr><td><span class="key">' + key + '</span></td><td><span class="value">' + value + '</span></td></tr>\n';
                                    });
                                    bookingHTML += '</table>';
                                    
                                    var botMessageHTM = '';
                                    if (!bookingNumber) {
                                        buttonHTML += '<button class="booking-button" onclick="showBookingDetails(\'' + bookingNumber + '\', ' + counter + ')"><div style="float: left; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; border-right: 2px solid #f2f2f2;">' + customername + '<span color: transparent;' + det +'</span></div><div style="display: inline-block; text-align: center; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center;">' + createddate + '</div><div style="float: right; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: right; border-left: 2px solid #f2f2f2;">' + statusCode + '</div></button><br>';
                                    } else {
                                        buttonHTML += '<button class="booking-button" onclick="showBookingDetails(\'' + bookingNumber + '\', ' + counter + ')"><div style="float: left; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; border-right: 2px solid #f2f2f2;">' + customername + '<span color: transparent;' + det +'</span></div><div style="display: inline-block; text-align: center; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center;">' + createddate + '</div><div style="float: right; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: right; border-left: 2px solid #f2f2f2;">' + bookingNumber + '</div></button><br>';
                                    }

                                    buttonHTML += '<div id="' + counter + 'bookingDetails_' + bookingNumber + '" style="display: none;">' + bookingHTML + '</div><br>';
                                    counter++;
                                }
                            });

                            var botDiv = `<div style="border: 1px solid transparent; padding-top: 10px; padding-left: 2px; padding-right: 2px; padding-bottom: 3px; border-radius: 10px; margin-top: 10px; background-color: #c0c0c0;">`;
                            botDiv += '<input type="text" id="search-input" style="width: 100%;" placeholder="Global Search...">';
                            var botDiv2 = `<div style="border-left: 1px solid transparent; background-color: #e5e4e2; padding: 4px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px;">`;
                            botDiv2 += '<div id="num" style="font-size: 14px; display: flex; padding: 5px; align-items: left; justify-content: left;"></div>';
                            botDiv2 += '<div><table style="border-collapse: collapse; width: 100%; margin-bottom: 5px;"><thead style="background-color: #002147; color: white;"><tr><th style="border: 1px solid #dddddd; text-align: left; padding: 8px; width: 33.17%;">COMPANY</th><th style="border: 1px solid #dddddd; text-align: center; padding: 8px; width: 33.16%;">CREATED DATE</th><th style="border: 1px solid #dddddd; text-align: right; padding: 8px; width: 33.66%;">ENQUIRY NO</th></tr></thead></table></div>';
                            botDiv2 += '<div id="bot-message-scroll" style="max-height: 250px; overflow-y: auto; overflow-x: hidden;">'+ buttonHTML +'</div>';  
                            botDiv2 += `</div>`;
                            botDiv += botDiv2;
                            botDiv += `</div>`;  
                            botMessageHTML += botDiv; 
                            botMessageHTML += '<div style="margin-top: 20px;"><b>If you have any questions or concerns about the results, please verify them using our application or contact our support team.</b></div>';                      
                        }
                         else {
                            bookingSets.forEach(bookingSet => {
                                var cleanedBookingSet = bookingSet.replace(/[\[\]{}"]/g, '');
                        
                                if (cleanedBookingSet.trim() !== '') {
                                    cleanedBookingSet = cleanedBookingSet.trim();
                        
                                    var keyValuePairs = cleanedBookingSet.split(',');
                        
                                    var bookingHTML = '<table class="booking-details">';
                                    keyValuePairs.forEach(pair => {
                                        var parts = pair.split(':');
                                        var key = parts[0].trim();
                                        var value = parts.slice(1).join(':').trim();
                        
                                        bookingHTML += '<tr><td><span class="key">' + key + '</span></td><td><span class="value">' + value + '</span></td></tr>\n';
                                    });
                                    bookingHTML += '</table><br>';
                                    botMessageHTML += bookingHTML;
                                }
                            });
                        }
                        
                        botMessageHTML += '</div></div>';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">'+ 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        document.addEventListener('input', function (event) {
                            if (event.target.id === 'search-input') {
                                var searchValue = event.target.value.toLowerCase();
                                var botMessageScroll = document.getElementById('bot-message-scroll');
                                var buttons = botMessageScroll.getElementsByClassName('booking-button');
                                var moduleName = 'enquiries';

                                filterButtons(searchValue, buttons, moduleName);
                            }
                        });
                        closeType();
                        scrollToBottom();
                
                    userInputElement.removeEventListener('keypress', userInputElement._listener);
                })
                .catch(error => {
                    console.error('Error:', error);
                });                
        
            }
            displayPrompt();
        }     
        
        function askBookingNumberfright(messages) {
            var inputValues = {};
            var currentIndex = 0;
            var userInputElement = document.getElementById('user-input');
        
            function displayPrompt() {
                var message = messages[currentIndex];
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat">`;
                //var botMessageHTML = '<div class="message-container"><div class="bot-avatar"><img src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 30px; height: auto;"></div><div class="bot-message">';
                var botMessageHTML2 = '<div class="message-container"><div class="bot-message-time">';

                    if (message.toLowerCase() === "from date") {
                        botMessageHTML += 'Please enter the "<b>' + message + '</b>"';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        var currentDate = new Date();
                        currentDate.setMonth(currentDate.getMonth() - 1);
    
                        var year = currentDate.getFullYear();
                        var month = String(currentDate.getMonth() + 1).padStart(2, '0');
                        var day = String(currentDate.getDate()).padStart(2, '0');
                        var hours = String(currentDate.getHours()).padStart(2, '0');
                        var minutes = String(currentDate.getMinutes()).padStart(2, '0');
                        var defaultDate = year + '-' + month + '-' + day + 'T' + hours + ':' + minutes;
    
                        botMessageHTML2 += '<input type="datetime-local" id="datetime-input" value="' + defaultDate + '">';
                        chatContainer.innerHTML += botMessageHTML2;
                        setTimeout(function() {
                            var datetimeInput = document.getElementById('datetime-input');
                            datetimeInput.focus();
                        }, 0);
                        scrollToBottom();
                
                        var datetimeInput = document.getElementById('datetime-input');
    
                        userInputElement.style.display = 'none';
                
                        datetimeInput.addEventListener('blur', function(event) {
                            var userInput = this.value.trim().split("T")[0];
                            simpleUserMessage(userInput);
                
                            inputValues["booking" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
    
                            var botMessageCheck = document.querySelector('.bot-message-time');
                            if (botMessageCheck) {
                                botMessageCheck.remove();
                            }
    
                            userInputElement.style.display = 'block';
                
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        });
                    } else if (message.toLowerCase() === "to date") {
                        botMessageHTML += 'Please enter the "<b>' + message + '</b>"';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        var defaultDate = new Date().toISOString().slice(0, 16);
                        botMessageHTML2 += '<input type="datetime-local" id="datetime-input" value="' + defaultDate + '">';
                        chatContainer.innerHTML += botMessageHTML2;
                        setTimeout(function() {
                            var datetimeInput = document.getElementById('datetime-input');
                            datetimeInput.focus();
                        }, 0);
                        scrollToBottom();
                
                        var datetimeInput = document.getElementById('datetime-input');
    
                        userInputElement.style.display = 'none';
                
                        datetimeInput.addEventListener('blur', function(event) {
                            var userInput = this.value.trim().split("T")[0];
                            simpleUserMessage(userInput);
                
                            inputValues["booking" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
    
                            var botMessageCheck = document.querySelector('.bot-message-time');
                            if (botMessageCheck) {
                                botMessageCheck.remove();
                            }
    
                            userInputElement.style.display = 'block';
                
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        });
                    } else {
                    botMessageHTML += 'Please type in the "<b>' + message + '</b>"';
                    chatContainer.innerHTML += botMessageHTML;
                    var currentTime = new Date().toLocaleTimeString();
                    var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                    chatContainer.innerHTML += botTimeHTML;
                    scrollToBottom();
            
                    userInputElement.focus();
            
                    if (userInputElement._listener) {
                        userInputElement.removeEventListener('keypress', userInputElement._listener);
                    }
            
                    userInputElement._listener = function (event) {
                        if (event.key === 'Enter') {
                            event.preventDefault();
                            var userInput = this.value.trim();
                            simpleUserMessage(userInput);
            
                            inputValues["booking" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
            
                            this.value = '';
            
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        }
                    };
            
                    userInputElement.addEventListener('keypress', userInputElement._listener);
                }
            }
        
            function sendAllInputs() {
                typingMessage();
                fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_input: {
                            ...inputValues,
                            'current_date': formattedDate,
                            'tenantid': tenantid,
                            'officeid': officeid,
                            'userid': userid,
                            'userid2': userid2,
                            'environment': environment,
                            'userid2': userid2,
                            'ffrid': ffrid
                        }
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    var inputSummary = '<b>[ </b>' + Object.keys(inputValues).map(function(key, index, array) {
                        var displayKey = key.replace(/^booking/, '').replace(/_/g, ' ');
                        var comma = (index !== array.length - 1) ? ', ' : '';
                        return '<b>' + displayKey + ':</b> ' + inputValues[key] + comma;
                    }).join('') + '<b> ]</b>';   
                    
                    var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                        <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                    </div></div><div class="bot-message-booking"><b>Fright forwarding booking search result based on your criteria </b>${formatKeyValueList(inputSummary)}`;
                    
                    //var botMessageHTML = '<div class="message-container"><div class="bot-avatar"><img src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 30px; height: auto;"></div><div class="bot-message-booking"><b>Fright forwarding booking search result based on your criteria <br><br></b>' + '<span style="font-size:14px;">' + formatKeyValueList(inputSummary) + '</span><br><br>';

                        var bookingSets = data.response.split('},');

                        if (bookingSets.length > 1) {
                            botMessageHTML += '<b>Multiple entries found. Please pick one to view more details</b><br><br>';
                            var counter = 1;
                            var buttonHTML = '';
                        
                            bookingSets.forEach((bookingSet, index) => {
                                var cleanedBookingSet = bookingSet.replace(/[\[\]{}"]/g, '');
                        
                                if (cleanedBookingSet.trim() !== '') {
                                    cleanedBookingSet = cleanedBookingSet.trim();
                        
                                    var keyValuePairs = cleanedBookingSet.split(',');
                        
                                    var bookingNumber = '';
                                    var statusCode = '';
                                    var det = '';
                                    var bookingHTML = '<table class="booking-details">';
                                    keyValuePairs.forEach(pair => {
                                        var parts = pair.split(':');
                                        var key = parts[0].trim();
                                        var value = parts.slice(1).join(':').trim();
                        
                                        if (key.toUpperCase() === 'BOOKING NUMBER') {
                                            if (value === 'null') {
                                                bookingNumber = null;
                                            } else {
                                                bookingNumber = value;
                                            }
                                        } else if (key.toUpperCase() === 'STATUS' && !bookingNumber) {
                                            statusCode = value;
                                        } else if (key.toUpperCase() === 'BOOKING DATE') {
                                            bookingdate = value;
                                        } else if (key.toUpperCase() === 'BOOKING PARTY') {
                                            bookingparty = value;
                                        }
                                        
                                        det += value + ',';
                                        bookingHTML += '<tr><td><span class="key">' + key + '</span></td><td><span class="value">' + value + '</span></td></tr>\n';
                                    });
                                    bookingHTML += '</table>';
                        
                                    if (!bookingNumber) {
                                        buttonHTML += '<button class="booking-button" onclick="showBookingDetails(\'' + bookingNumber + '\', ' + counter + ')"><div style="float: left; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; border-right: 2px solid #f2f2f2;">' + bookingparty +'<span color: transparent;' + det +'</span></div><div style="display: inline-block; text-align: center; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center;">' + bookingdate + '</div><div style="float: right; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: right; border-left: 2px solid #f2f2f2;">' + statusCode + '</div></button><br>';
                                    } else {
                                        buttonHTML += '<button class="booking-button" onclick="showBookingDetails(\'' + bookingNumber + '\', ' + counter + ')"><div style="float: left; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; border-right: 2px solid #f2f2f2;">' + bookingparty +'<span color: transparent;' + det +'</span></div><div style="display: inline-block; text-align: center; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center;">' + bookingdate + '</div><div style="float: right; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: right; border-left: 2px solid #f2f2f2;">' + bookingNumber + '</div></button><br>';
                                    }
                        
                                    buttonHTML += '<div id="' + counter + 'bookingDetails_' + bookingNumber + '" style="display: none;">' + bookingHTML + '</div><br>';
                                    counter++;
                                }
                            });

                            var botDiv = `<div style="border: 1px solid transparent; padding-top: 10px; padding-left: 2px; padding-right: 2px; padding-bottom: 3px; border-radius: 10px; margin-top: 10px; background-color: #c0c0c0;">`;
                            botDiv += '<input type="text" id="search-input" style="width: 100%;" placeholder="Global Search...">';
                            var botDiv2 = `<div style="border-left: 1px solid transparent; background-color: #e5e4e2; padding: 4px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px;">`;
                            botDiv2 += '<div id="num" style="font-size: 14px; display: flex; padding: 5px; align-items: left; justify-content: left;"></div>';
                            botDiv2 += '<div><table style="border-collapse: collapse; width: 100%; margin-bottom: 5px;"><thead style="background-color: #002147; color: white;"><tr><th style="border: 1px solid #dddddd; text-align: left; padding: 8px; width: 33.17%;">BOOKING PARTY</th><th style="border: 1px solid #dddddd; text-align: center; padding: 8px; width: 33.16%;">BOOKING DATE</th><th style="border: 1px solid #dddddd; text-align: right; padding: 8px; width: 33.66%;">BOOKING NO</th></tr></thead></table></div>';
                            botDiv2 +=  '<div id="bot-message-scroll" style="max-height: 250px; overflow-y: auto; overflow-x: hidden;">' + buttonHTML +'</div>';
                            botDiv2 += `</div>`;
                            botDiv += botDiv2;
                            botDiv += `</div>`;
                            botMessageHTML += botDiv;
                            botMessageHTML += '<div style="margin-top: 20px;"><b>If you have any questions or concerns about the results, please verify them using our application or contact our support team.</b></div>';
                        }
                         else {
                            bookingSets.forEach(bookingSet => {
                                var cleanedBookingSet = bookingSet.replace(/[\[\]{}"]/g, '');
                        
                                if (cleanedBookingSet.trim() !== '') {
                                    cleanedBookingSet = cleanedBookingSet.trim();
                        
                                    var keyValuePairs = cleanedBookingSet.split(',');
                        
                                    var bookingHTML = '<table class="booking-details">';
                                    keyValuePairs.forEach(pair => {
                                        var parts = pair.split(':');
                                        var key = parts[0].trim();
                                        var value = parts.slice(1).join(':').trim();
                        
                                        bookingHTML += '<tr><td><span class="key">' + key + '</span></td><td><span class="value">' + value + '</span></td></tr>\n';
                                    });
                                    bookingHTML += '</table><br>';
                                    botMessageHTML += bookingHTML;
                                }
                            });
                        }
                        
                        botMessageHTML += '</div></div>';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">'+ 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        document.addEventListener('input', function (event) {
                            if (event.target.id === 'search-input') {
                                var searchValue = event.target.value.toLowerCase();
                                var botMessageScroll = document.getElementById('bot-message-scroll');
                                var buttons = botMessageScroll.getElementsByClassName('booking-button');
                                var moduleName = 'fright bookings';

                                filterButtons(searchValue, buttons, moduleName);
                            }
                        });
                        closeType();
                        scrollToBottom();
                
                    userInputElement.removeEventListener('keypress', userInputElement._listener);
                })
                .catch(error => {
                    console.error('Error:', error);
                });                
        
            }
            displayPrompt();
        }

        function askBookingNumberfrightawb(messages) {
            var inputValues = {};
            var currentIndex = 0;
            var userInputElement = document.getElementById('user-input');
        
            function displayPrompt() {
                var message = messages[currentIndex];
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat">`;
                //var botMessageHTML = '<div class="message-container"><div class="bot-avatar"><img src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 30px; height: auto;"></div><div class="bot-message">';
                var botMessageHTML2 = '<div class="message-container"><div class="bot-message-time">';

                    if (message.toLowerCase() === "from date" || message.toLowerCase() === "bk from date") {
                        botMessageHTML += 'Please enter the "<b>' + message + '</b>"';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        var currentDate = new Date();
                        currentDate.setMonth(currentDate.getMonth() - 1);
    
                        var year = currentDate.getFullYear();
                        var month = String(currentDate.getMonth() + 1).padStart(2, '0');
                        var day = String(currentDate.getDate()).padStart(2, '0');
                        var hours = String(currentDate.getHours()).padStart(2, '0');
                        var minutes = String(currentDate.getMinutes()).padStart(2, '0');
                        var defaultDate = year + '-' + month + '-' + day + 'T' + hours + ':' + minutes;
    
                        botMessageHTML2 += '<input type="datetime-local" id="datetime-input" value="' + defaultDate + '">';
                        chatContainer.innerHTML += botMessageHTML2;
                        setTimeout(function() {
                            var datetimeInput = document.getElementById('datetime-input');
                            datetimeInput.focus();
                        }, 0);
                        scrollToBottom();
                
                        var datetimeInput = document.getElementById('datetime-input');
    
                        userInputElement.style.display = 'none';
                
                        datetimeInput.addEventListener('blur', function(event) {
                            var userInput = this.value.trim().split("T")[0];
                            simpleUserMessage(userInput);
                
                            inputValues["awb" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
    
                            var botMessageCheck = document.querySelector('.bot-message-time');
                            if (botMessageCheck) {
                                botMessageCheck.remove();
                            }
    
                            userInputElement.style.display = 'block';
                
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        });
                    } else if (message.toLowerCase() === "to date" || message.toLowerCase() === "bk to date") {
                        botMessageHTML += 'Please enter the "<b>' + message + '</b>"';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        var defaultDate = new Date().toISOString().slice(0, 16);
                        botMessageHTML2 += '<input type="datetime-local" id="datetime-input" value="' + defaultDate + '">';
                        chatContainer.innerHTML += botMessageHTML2;
                        setTimeout(function() {
                            var datetimeInput = document.getElementById('datetime-input');
                            datetimeInput.focus();
                        }, 0);
                        scrollToBottom();
                
                        var datetimeInput = document.getElementById('datetime-input');
    
                        userInputElement.style.display = 'none';
                
                        datetimeInput.addEventListener('blur', function(event) {
                            var userInput = this.value.trim().split("T")[0];
                            simpleUserMessage(userInput);
                
                            inputValues["awb" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
    
                            var botMessageCheck = document.querySelector('.bot-message-time');
                            if (botMessageCheck) {
                                botMessageCheck.remove();
                            }
    
                            userInputElement.style.display = 'block';
                
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        });
                    } else {
                    botMessageHTML += 'Please type in the "<b>' + message + '</b>"';
                    chatContainer.innerHTML += botMessageHTML;
                    var currentTime = new Date().toLocaleTimeString();
                    var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                    chatContainer.innerHTML += botTimeHTML;
                    scrollToBottom();
            
                    userInputElement.focus();
            
                    if (userInputElement._listener) {
                        userInputElement.removeEventListener('keypress', userInputElement._listener);
                    }
            
                    userInputElement._listener = function (event) {
                        if (event.key === 'Enter') {
                            event.preventDefault();
                            var userInput = this.value.trim();
                            simpleUserMessage(userInput);
            
                            inputValues["awb" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
            
                            this.value = '';
            
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        }
                    };
            
                    userInputElement.addEventListener('keypress', userInputElement._listener);
                }
            }
        
            function sendAllInputs() {
                typingMessage();
                fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_input: {
                            ...inputValues,
                            'current_date': formattedDate,
                            'tenantid': tenantid,
                            'officeid': officeid,
                            'userid': userid,
                            'userid2': userid2,
                            'environment': environment,
                            'userid2': userid2,
                            'ffrid': ffrid
                        }
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    var inputSummary = '<b>[ </b>' + Object.keys(inputValues).map(function(key, index, array) {
                        var displayKey = key.replace(/^awb/, '').replace(/_/g, ' ');
                        var comma = (index !== array.length - 1) ? ', ' : '';
                        return '<b>' + displayKey + ':</b> ' + inputValues[key] + comma;
                    }).join('') + '<b> ]</b>';   
                    
                    var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                        <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                    </div></div><div class="bot-message-booking"><b>Air way bill search result based on your criteria </b>${formatKeyValueList(inputSummary)}`;
                    
                    //var botMessageHTML = '<div class="message-container"><div class="bot-avatar"><img src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 30px; height: auto;"></div><div class="bot-message-booking"><b>Air way bill search result based on your criteria <br><br></b>' + '<span style="font-size:14px;">' + formatKeyValueList(inputSummary) + '</span><br><br>';

                        var bookingSets = data.response.split('},');

                        if (bookingSets.length > 1) {
                            botMessageHTML += '<b>Multiple entries found. Please pick one to view more details</b><br><br>';
                            var counter = 1;
                            var buttonHTML = '';
                        
                            bookingSets.forEach((bookingSet, index) => {
                                var cleanedBookingSet = bookingSet.replace(/[\[\]{}"]/g, '');
                        
                                if (cleanedBookingSet.trim() !== '') {
                                    cleanedBookingSet = cleanedBookingSet.trim();
                        
                                    var keyValuePairs = cleanedBookingSet.split(',');
                        
                                    var bookingNumber = '';
                                    var statusCode = '';
                                    var det = '';
                                    var bookingHTML = '<table class="booking-details">';
                                    keyValuePairs.forEach(pair => {
                                        var parts = pair.split(':');
                                        var key = parts[0].trim();
                                        var value = parts.slice(1).join(':').trim();
                        
                                        if (key.toUpperCase() === 'BOOKING NUMBER') {
                                            if (value === 'null') {
                                                bookingNumber = null;
                                            } else {
                                                bookingNumber = value;
                                            }
                                        } else if (key.toUpperCase() === 'STATUS' && !bookingNumber) {
                                            statusCode = value;
                                        } else if (key.toUpperCase() === 'BOOKING DATE') {
                                            bookingdate = value;
                                        } else if (key.toUpperCase() === 'SHIPPER') {
                                            bookingparty = value;
                                        }
                                        
                                        det += value + ',';
                                        bookingHTML += '<tr><td><span class="key">' + key + '</span></td><td><span class="value">' + value + '</span></td></tr>\n';
                                    });
                                    bookingHTML += '</table>';
                        
                                    if (!bookingNumber) {
                                        buttonHTML += '<button class="booking-button" onclick="showBookingDetails(\'' + bookingNumber + '\', ' + counter + ')"><div style="float: left; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; border-right: 2px solid #f2f2f2;">' + bookingparty +'<span color: transparent;' + det +'</span></div><div style="display: inline-block; text-align: center; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center;">' + bookingdate + '</div><div style="float: right; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: right; border-left: 2px solid #f2f2f2;">' + statusCode + '</div></button><br>';
                                    } else {
                                        buttonHTML += '<button class="booking-button" onclick="showBookingDetails(\'' + bookingNumber + '\', ' + counter + ')"><div style="float: left; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; border-right: 2px solid #f2f2f2;">' + bookingparty +'<span color: transparent;' + det +'</span></div><div style="display: inline-block; text-align: center; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center;">' + bookingdate + '</div><div style="float: right; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: right; border-left: 2px solid #f2f2f2;">' + bookingNumber + '</div></button><br>';
                                    }
                        
                                    buttonHTML += '<div id="' + counter + 'bookingDetails_' + bookingNumber + '" style="display: none;">' + bookingHTML + '</div><br>';
                                    counter++;
                                }
                            });
                                
                            var botDiv = `<div style="border: 1px solid transparent; padding-top: 10px; padding-left: 2px; padding-right: 2px; padding-bottom: 3px; border-radius: 10px; margin-top: 10px; background-color: #c0c0c0;">`;
                            botDiv += '<input type="text" id="search-input" style="width: 100%;" placeholder="Global Search...">';
                            var botDiv2 = `<div style="border-left: 1px solid transparent; background-color: #e5e4e2; padding: 4px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px;">`;
                            botDiv2 += '<div id="num" style="font-size: 14px; display: flex; padding: 5px; align-items: left; justify-content: left;"></div>';
                            botDiv2 += '<div><table style="border-collapse: collapse; width: 100%; margin-bottom: 5px;"><thead style="background-color: #002147; color: white;"><tr><th style="border: 1px solid #dddddd; text-align: left; padding: 8px; width: 33.17%;">SHIPPER</th><th style="border: 1px solid #dddddd; text-align: center; padding: 8px; width: 33.16%;">BOOKING DATE</th><th style="border: 1px solid #dddddd; text-align: right; padding: 8px; width: 33.66%;">BOOKING NO</th></tr></thead></table></div>';
                            botDiv2 +=  '<div id="bot-message-scroll" style="max-height: 250px; overflow-y: auto; overflow-x: hidden;">' + buttonHTML +'</div>';
                            botDiv2 += `</div>`;
                            botDiv += botDiv2;
                            botDiv += `</div>`;
                            botMessageHTML += botDiv;
                            botMessageHTML += '<div style="margin-top: 20px;"><b>If you have any questions or concerns about the results, please verify them using our application or contact our support team.</b></div>';
                        }
                         else {
                            bookingSets.forEach(bookingSet => {
                                var cleanedBookingSet = bookingSet.replace(/[\[\]{}"]/g, '');
                        
                                if (cleanedBookingSet.trim() !== '') {
                                    cleanedBookingSet = cleanedBookingSet.trim();
                        
                                    var keyValuePairs = cleanedBookingSet.split(',');
                        
                                    var bookingHTML = '<table class="booking-details">';
                                    keyValuePairs.forEach(pair => {
                                        var parts = pair.split(':');
                                        var key = parts[0].trim();
                                        var value = parts.slice(1).join(':').trim();
                        
                                        bookingHTML += '<tr><td><span class="key">' + key + '</span></td><td><span class="value">' + value + '</span></td></tr>\n';
                                    });
                                    bookingHTML += '</table><br>';
                                    botMessageHTML += bookingHTML;
                                }
                            });
                        }
                        
                        botMessageHTML += '</div></div>';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">'+ 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        document.addEventListener('input', function (event) {
                            if (event.target.id === 'search-input') {
                                var searchValue = event.target.value.toLowerCase();
                                var botMessageScroll = document.getElementById('bot-message-scroll');
                                var buttons = botMessageScroll.getElementsByClassName('booking-button');
                                var moduleName = 'air way bills';

                                filterButtons(searchValue, buttons, moduleName);
                            }
                        });
                        closeType();
                        scrollToBottom();
                
                    userInputElement.removeEventListener('keypress', userInputElement._listener);
                })
                .catch(error => {
                    console.error('Error:', error);
                });                
        
            }
            displayPrompt();
        }

        function askBookingNumberfrightBillOfLading(messages) {
            var inputValues = {};
            var currentIndex = 0;
            var userInputElement = document.getElementById('user-input');
        
            function displayPrompt() {
                var message = messages[currentIndex];
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat">`;
                //var botMessageHTML = '<div class="message-container"><div class="bot-avatar"><img src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 30px; height: auto;"></div><div class="bot-message">';
                var botMessageHTML2 = '<div class="message-container"><div class="bot-message-time">';

                    if (message.toLowerCase() === "from date" || message.toLowerCase() === "bk from date") {
                        botMessageHTML += 'Please enter the "<b>' + message + '</b>"';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        var currentDate = new Date();
                        currentDate.setMonth(currentDate.getMonth() - 1);
    
                        var year = currentDate.getFullYear();
                        var month = String(currentDate.getMonth() + 1).padStart(2, '0');
                        var day = String(currentDate.getDate()).padStart(2, '0');
                        var hours = String(currentDate.getHours()).padStart(2, '0');
                        var minutes = String(currentDate.getMinutes()).padStart(2, '0');
                        var defaultDate = year + '-' + month + '-' + day + 'T' + hours + ':' + minutes;
    
                        botMessageHTML2 += '<input type="datetime-local" id="datetime-input" value="' + defaultDate + '">';
                        chatContainer.innerHTML += botMessageHTML2;
                        setTimeout(function() {
                            var datetimeInput = document.getElementById('datetime-input');
                            datetimeInput.focus();
                        }, 0);
                        scrollToBottom();
                
                        var datetimeInput = document.getElementById('datetime-input');
    
                        userInputElement.style.display = 'none';
                
                        datetimeInput.addEventListener('blur', function(event) {
                            var userInput = this.value.trim().split("T")[0];
                            simpleUserMessage(userInput);
                
                            inputValues["bol" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
    
                            var botMessageCheck = document.querySelector('.bot-message-time');
                            if (botMessageCheck) {
                                botMessageCheck.remove();
                            }
    
                            userInputElement.style.display = 'block';
                
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        });
                    } else if (message.toLowerCase() === "to date" || message.toLowerCase() === "bk to date") {
                        botMessageHTML += 'Please enter the "<b>' + message + '</b>"';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        var defaultDate = new Date().toISOString().slice(0, 16);
                        botMessageHTML2 += '<input type="datetime-local" id="datetime-input" value="' + defaultDate + '">';
                        chatContainer.innerHTML += botMessageHTML2;
                        setTimeout(function() {
                            var datetimeInput = document.getElementById('datetime-input');
                            datetimeInput.focus();
                        }, 0);
                        scrollToBottom();
                
                        var datetimeInput = document.getElementById('datetime-input');
    
                        userInputElement.style.display = 'none';
                
                        datetimeInput.addEventListener('blur', function(event) {
                            var userInput = this.value.trim().split("T")[0];
                            simpleUserMessage(userInput);
                
                            inputValues["bol" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
    
                            var botMessageCheck = document.querySelector('.bot-message-time');
                            if (botMessageCheck) {
                                botMessageCheck.remove();
                            }
    
                            userInputElement.style.display = 'block';
                
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        });
                    } else {
                    botMessageHTML += 'Please type in the "<b>' + message + '</b>"';
                    chatContainer.innerHTML += botMessageHTML;
                    var currentTime = new Date().toLocaleTimeString();
                    var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                    chatContainer.innerHTML += botTimeHTML;
                    scrollToBottom();
            
                    userInputElement.focus();
            
                    if (userInputElement._listener) {
                        userInputElement.removeEventListener('keypress', userInputElement._listener);
                    }
            
                    userInputElement._listener = function (event) {
                        if (event.key === 'Enter') {
                            event.preventDefault();
                            var userInput = this.value.trim();
                            simpleUserMessage(userInput);
            
                            inputValues["bol" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
            
                            this.value = '';
            
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        }
                    };
            
                    userInputElement.addEventListener('keypress', userInputElement._listener);
                }
            }
        
            function sendAllInputs() {
                typingMessage();
                fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_input: {
                            ...inputValues,
                            'current_date': formattedDate,
                            'tenantid': tenantid,
                            'officeid': officeid,
                            'userid': userid,
                            'userid2': userid2,
                            'environment': environment,
                            'userid2': userid2,
                            'ffrid': ffrid
                        }
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    var inputSummary = '<b>[ </b>' + Object.keys(inputValues).map(function(key, index, array) {
                        var displayKey = key.replace(/^bol/, '').replace(/_/g, ' ');
                        var comma = (index !== array.length - 1) ? ', ' : '';
                        return '<b>' + displayKey + ':</b> ' + inputValues[key] + comma;
                    }).join('') + '<b> ]</b>';     
                    
                    var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                        <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                    </div></div><div class="bot-message-booking"><b>Bill of lading search result based on your criteria </b>${formatKeyValueList(inputSummary)}`;
                    
                    //var botMessageHTML = '<div class="message-container"><div class="bot-avatar"><img src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 30px; height: auto;"></div><div class="bot-message-booking"><b>Bill of lading search result based on your criteria <br><br></b>' + '<span style="font-size:14px;">' + formatKeyValueList(inputSummary) + '</span><br><br>';

                        var bookingSets = data.response.split('},');

                        if (bookingSets.length > 1) {
                            botMessageHTML += '<b>Multiple entries found. Please pick one to view more details</b><br><br>';
                            var counter = 1;
                            var buttonHTML = '';
                        
                            bookingSets.forEach((bookingSet, index) => {
                                var cleanedBookingSet = bookingSet.replace(/[\[\]{}"]/g, '');
                        
                                if (cleanedBookingSet.trim() !== '') {
                                    cleanedBookingSet = cleanedBookingSet.trim();
                        
                                    var keyValuePairs = cleanedBookingSet.split(',');
                        
                                    var bookingNumber = '';
                                    var statusCode = '';
                                    var det = '';
                                    var bookingHTML = '<table class="booking-details">';
                                    keyValuePairs.forEach(pair => {
                                        var parts = pair.split(':');
                                        var key = parts[0].trim();
                                        var value = parts.slice(1).join(':').trim();
                        
                                        if (key.toUpperCase() === 'BOOKING NUMBER') {
                                            if (value === 'null') {
                                                bookingNumber = null;
                                            } else {
                                                bookingNumber = value;
                                            }
                                        } else if (key.toUpperCase() === 'STATUS' && !bookingNumber) {
                                            statusCode = value;
                                        } else if (key.toUpperCase() === 'BOOKING DATE') {
                                            bookingdate = value;
                                        } else if (key.toUpperCase() === 'SHIPPER') {
                                            bookingparty = value;
                                        }
                                        
                                        det += value + ',';
                                        bookingHTML += '<tr><td><span class="key">' + key + '</span></td><td><span class="value">' + value + '</span></td></tr>\n';
                                    });
                                    bookingHTML += '</table>';
                        
                                    if (!bookingNumber) {
                                        buttonHTML += '<button class="booking-button" onclick="showBookingDetails(\'' + bookingNumber + '\', ' + counter + ')"><div style="float: left; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; border-right: 2px solid #f2f2f2;">' + bookingparty +'<span color: transparent;' + det +'</span></div><div style="display: inline-block; text-align: center; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center;">' + bookingdate + '</div><div style="float: right; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: right; border-left: 2px solid #f2f2f2;">' + statusCode + '</div></button><br>';
                                    } else {
                                        buttonHTML += '<button class="booking-button" onclick="showBookingDetails(\'' + bookingNumber + '\', ' + counter + ')"><div style="float: left; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; border-right: 2px solid #f2f2f2;">' + bookingparty +'<span color: transparent;' + det +'</span></div><div style="display: inline-block; text-align: center; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center;">' + bookingdate + '</div><div style="float: right; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: right; border-left: 2px solid #f2f2f2;">' + bookingNumber + '</div></button><br>';
                                    }
                        
                                    buttonHTML += '<div id="' + counter + 'bookingDetails_' + bookingNumber + '" style="display: none;">' + bookingHTML + '</div><br>';
                                    counter++;
                                }
                            });
                            
                            var botDiv = `<div style="border: 1px solid transparent; padding-top: 10px; padding-left: 2px; padding-right: 2px; padding-bottom: 3px; border-radius: 10px; margin-top: 10px; background-color: #c0c0c0;">`;
                            botDiv += '<input type="text" id="search-input" style="width: 100%;" placeholder="Global Search...">';
                            var botDiv2 = `<div style="border-left: 1px solid transparent; background-color: #e5e4e2; padding: 4px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px;">`;
                            botDiv2 += '<div id="num" style="font-size: 14px; display: flex; padding: 5px; align-items: left; justify-content: left;"></div>';
                            botDiv2 += '<div><table style="border-collapse: collapse; width: 100%; margin-bottom: 5px;"><thead style="background-color: #002147; color: white;"><tr><th style="border: 1px solid #dddddd; text-align: left; padding: 8px; width: 33.17%;">SHIPPER</th><th style="border: 1px solid #dddddd; text-align: center; padding: 8px; width: 33.16%;">BOOKING DATE</th><th style="border: 1px solid #dddddd; text-align: right; padding: 8px; width: 33.66%;">BOOKING NO</th></tr></thead></table></div>';
                            botDiv2 +=  '<div id="bot-message-scroll" style="max-height: 250px; overflow-y: auto; overflow-x: hidden;">' + buttonHTML +'</div>';
                            botDiv2 += `</div>`;
                            botDiv += botDiv2;
                            botDiv += `</div>`;
                            botMessageHTML += botDiv;
                            botMessageHTML += '<div style="margin-top: 20px;"><b>If you have any questions or concerns about the results, please verify them using our application or contact our support team.</b></div>';
                        }
                         else {
                            bookingSets.forEach(bookingSet => {
                                var cleanedBookingSet = bookingSet.replace(/[\[\]{}"]/g, '');
                        
                                if (cleanedBookingSet.trim() !== '') {
                                    cleanedBookingSet = cleanedBookingSet.trim();
                        
                                    var keyValuePairs = cleanedBookingSet.split(',');
                        
                                    var bookingHTML = '<table class="booking-details">';
                                    keyValuePairs.forEach(pair => {
                                        var parts = pair.split(':');
                                        var key = parts[0].trim();
                                        var value = parts.slice(1).join(':').trim();
                        
                                        bookingHTML += '<tr><td><span class="key">' + key + '</span></td><td><span class="value">' + value + '</span></td></tr>\n';
                                    });
                                    bookingHTML += '</table><br>';
                                    botMessageHTML += bookingHTML;
                                }
                            });
                        }
                        
                        botMessageHTML += '</div></div>';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">'+ 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        document.addEventListener('input', function (event) {
                            if (event.target.id === 'search-input') {
                                var searchValue = event.target.value.toLowerCase();
                                var botMessageScroll = document.getElementById('bot-message-scroll');
                                var buttons = botMessageScroll.getElementsByClassName('booking-button');
                                var moduleName = 'bill of lading';

                                filterButtons(searchValue, buttons, moduleName);
                            }
                        });
                        closeType();
                        scrollToBottom();
                
                    userInputElement.removeEventListener('keypress', userInputElement._listener);
                })
                .catch(error => {
                    console.error('Error:', error);
                });                
        
            }
            displayPrompt();
        }

        function askBookingNumbercustom(messages) {
            var inputValues = {};
            var currentIndex = 0;
            var userInputElement = document.getElementById('user-input');
        
            function displayPrompt() {
                var message = messages[currentIndex];
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat">`;

                //var botMessageHTML = '<div class="message-container"><div class="bot-avatar"><img src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 30px; height: auto;"></div><div class="bot-message">';
                var botMessageHTML2 = '<div class="message-container"><div class="bot-message-time">';

                    if (message.toLowerCase() === "from date") {
                        botMessageHTML += 'Please enter the "<b>' + message + '</b>"';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        var currentDate = new Date();
                        currentDate.setMonth(currentDate.getMonth() - 1);
    
                        var year = currentDate.getFullYear();
                        var month = String(currentDate.getMonth() + 1).padStart(2, '0');
                        var day = String(currentDate.getDate()).padStart(2, '0');
                        var hours = String(currentDate.getHours()).padStart(2, '0');
                        var minutes = String(currentDate.getMinutes()).padStart(2, '0');
                        var defaultDate = year + '-' + month + '-' + day + 'T' + hours + ':' + minutes;
    
                        botMessageHTML2 += '<input type="datetime-local" id="datetime-input" value="' + defaultDate + '">';
                        chatContainer.innerHTML += botMessageHTML2;
                        setTimeout(function() {
                            var datetimeInput = document.getElementById('datetime-input');
                            datetimeInput.focus();
                        }, 0);
                        scrollToBottom();
                
                        var datetimeInput = document.getElementById('datetime-input');
    
                        userInputElement.style.display = 'none';
                
                        datetimeInput.addEventListener('blur', function(event) {
                            var userInput = this.value.trim().split("T")[0];
                            simpleUserMessage(userInput);
                
                            inputValues["booking" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
    
                            var botMessageCheck = document.querySelector('.bot-message-time');
                            if (botMessageCheck) {
                                botMessageCheck.remove();
                            }
    
                            userInputElement.style.display = 'block';
                
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        });
                    } else if (message.toLowerCase() === "to date") {
                        botMessageHTML += 'Please enter the "<b>' + message + '</b>"';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        var defaultDate = new Date().toISOString().slice(0, 16);
                        botMessageHTML2 += '<input type="datetime-local" id="datetime-input" value="' + defaultDate + '">';
                        chatContainer.innerHTML += botMessageHTML2;
                        setTimeout(function() {
                            var datetimeInput = document.getElementById('datetime-input');
                            datetimeInput.focus();
                        }, 0);
                        scrollToBottom();
                
                        var datetimeInput = document.getElementById('datetime-input');
    
                        userInputElement.style.display = 'none';
                
                        datetimeInput.addEventListener('blur', function(event) {
                            var userInput = this.value.trim().split("T")[0];
                            simpleUserMessage(userInput);
                
                            inputValues["booking" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
    
                            var botMessageCheck = document.querySelector('.bot-message-time');
                            if (botMessageCheck) {
                                botMessageCheck.remove();
                            }
    
                            userInputElement.style.display = 'block';
                
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        });
                    } else {
                    botMessageHTML += 'Please type in the "<b>' + message + '</b>"';
                    chatContainer.innerHTML += botMessageHTML;
                    var currentTime = new Date().toLocaleTimeString();
                    var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                    chatContainer.innerHTML += botTimeHTML;
                    scrollToBottom();
            
                    userInputElement.focus();
            
                    if (userInputElement._listener) {
                        userInputElement.removeEventListener('keypress', userInputElement._listener);
                    }
            
                    userInputElement._listener = function (event) {
                        if (event.key === 'Enter') {
                            event.preventDefault();
                            var userInput = this.value.trim();
                            simpleUserMessage(userInput);
            
                            inputValues["booking" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
            
                            this.value = '';
            
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        }
                    };
            
                    userInputElement.addEventListener('keypress', userInputElement._listener);
                }
            }
        
            function sendAllInputs() {
                typingMessage();
                fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_input: {
                            ...inputValues,
                            'current_date': formattedDate,
                            'tenantid': tenantid,
                            'officeid': officeid,
                            'userid': userid,
                            'userid2': userid2,
                            'environment': environment,
                            'userid2': userid2,
                            'chaid': chaid
                        }
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    var inputSummary = '<b>[ </b>' + Object.keys(inputValues).map(function(key, index, array) {
                        var displayKey = key.replace(/^booking/, '').replace(/_/g, ' ');
                        var comma = (index !== array.length - 1) ? ', ' : '';
                        return '<b>' + displayKey + ':</b> ' + inputValues[key] + comma;
                    }).join('') + '<b> ]</b>';    
                    
                    var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                        <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                    </div></div><div class="bot-message-booking"><b>Custom broker booking search result based on your criteria </b>${formatKeyValueList(inputSummary)}`;
                    
                    //var botMessageHTML = '<div class="message-container"><div class="bot-avatar"><img src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 30px; height: auto;"></div><div class="bot-message-booking"><b>Custom broker booking search result based on your criteria <br><br></b>' + '<span style="font-size:14px;">' + formatKeyValueList(inputSummary) + '</span><br><br>';

                        var bookingSets = data.response.split('},');

                        if (bookingSets.length > 1) {
                            botMessageHTML += '<b>Multiple result found. Please select and view the details</b><br><br>';
                            var counter = 1;
                            var buttonHTML = '';
                        
                            bookingSets.forEach((bookingSet, index) => {
                                var cleanedBookingSet = bookingSet.replace(/[\[\]{}"]/g, '');
                        
                                if (cleanedBookingSet.trim() !== '') {
                                    cleanedBookingSet = cleanedBookingSet.trim();
                        
                                    var keyValuePairs = cleanedBookingSet.split(',');
                        
                                    var bookingNumber = '';
                                    var statusCode = '';
                                    var det = '';
                                    var bookingHTML = '<table class="booking-details">';
                                    keyValuePairs.forEach(pair => {
                                        var parts = pair.split(':');
                                        var key = parts[0].trim();
                                        var value = parts.slice(1).join(':').trim();
                        
                                        if (key.toUpperCase() === 'BOOKING NUMBER') {
                                            if (value === 'null') {
                                                bookingNumber = null;
                                            } else {
                                                bookingNumber = value;
                                            }
                                        } else if (key.toUpperCase() === 'STATUS' && !bookingNumber) {
                                            statusCode = value;
                                        } else if (key.toUpperCase() === 'BOOKING DATE') {
                                            bookingdate = value;
                                        } else if (key.toUpperCase() === 'BOOKING PARTY') {
                                            bookingparty = value;
                                        }
                                        
                                        det += value + ',';
                                        console.log(det);
                                        bookingHTML += '<tr><td><span class="key">' + key + '</span></td><td><span class="value">' + value + '</span></td></tr>\n';
                                    });
                                    bookingHTML += '</table>';
            
                                    if (!bookingNumber) {
                                        buttonHTML += '<button class="booking-button" onclick="showBookingDetails(\'' + bookingNumber + '\', ' + counter + ')"><div style="float: left; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; border-right: 2px solid #f2f2f2;">' + bookingparty +'<span color: transparent;' + det +'</span></div><div style="display: inline-block; text-align: center; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center;">' + bookingdate + '</div><div style="float: right; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: right; border-left: 2px solid #f2f2f2;">' + statusCode + '</div></button><br>';
                                    } else {
                                        buttonHTML += '<button class="booking-button" onclick="showBookingDetails(\'' + bookingNumber + '\', ' + counter + ')"><div style="float: left; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; border-right: 2px solid #f2f2f2;">' + bookingparty +'<span color: transparent;' + det +'</span></div><div style="display: inline-block; text-align: center; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center;">' + bookingdate + '</div><div style="float: right; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: right; border-left: 2px solid #f2f2f2;">' + bookingNumber + '</div></button><br>';
                                    }

                                    buttonHTML += '<div id="' + counter + 'bookingDetails_' + bookingNumber + '" style="display: none;">' + bookingHTML + '</div><br>';
                                    counter++;
                                }
                            });

                            var botDiv = `<div style="border: 1px solid transparent; padding-top: 10px; padding-left: 2px; padding-right: 2px; padding-bottom: 3px; border-radius: 10px; margin-top: 10px; background-color: #c0c0c0;">`;    
                            botDiv += '<input type="text" id="search-input" style="width: 100%;" placeholder="Global Search...">';
                            var botDiv2 = `<div style="border-left: 1px solid transparent; background-color: #e5e4e2; padding: 4px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px;">`;
                            botDiv2 += '<div id="num" style="font-size: 14px; display: flex; padding: 5px; align-items: left; justify-content: left;"></div>';
                            botDiv2 += '<div><table style="border-collapse: collapse; width: 100%; margin-bottom: 5px;"><thead style="background-color: #002147; color: white;"><tr><th style="border: 1px solid #dddddd; text-align: left; padding: 8px; width: 33.17%;">BOOKING PARTY</th><th style="border: 1px solid #dddddd; text-align: center; padding: 8px; width: 33.16%;">BOOKING DATE</th><th style="border: 1px solid #dddddd; text-align: right; padding: 8px; width: 33.66%;">BOOKING NO</th></tr></thead></table></div>';
                            botDiv2 +=  '<div id="bot-message-scroll" style="max-height: 250px; overflow-y: auto; overflow-x: hidden;">' + buttonHTML +'</div>';
                            botDiv2 += `</div>`;
                            botDiv += botDiv2;
                            botDiv += `</div>`;
                            botMessageHTML += botDiv;
                            botMessageHTML += '<div style="margin-top: 20px;"><b>If you have any questions or concerns about the results, please verify them using our application or contact our support team.</b></div>';
                        }
                         else {
                            bookingSets.forEach(bookingSet => {
                                var cleanedBookingSet = bookingSet.replace(/[\[\]{}"]/g, '');
                        
                                if (cleanedBookingSet.trim() !== '') {
                                    cleanedBookingSet = cleanedBookingSet.trim();
                        
                                    var keyValuePairs = cleanedBookingSet.split(',');
                        
                                    var bookingHTML = '<table class="booking-details">';
                                    keyValuePairs.forEach(pair => {
                                        var parts = pair.split(':');
                                        var key = parts[0].trim();
                                        var value = parts.slice(1).join(':').trim();
                        
                                        bookingHTML += '<tr><td><span class="key">' + key + '</span></td><td><span class="value">' + value + '</span></td></tr>\n';
                                    });
                                    bookingHTML += '</table><br>';
                                    botMessageHTML += bookingHTML;
                                }
                            });
                        }
                        
                        botMessageHTML += '</div></div>';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">'+ 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        document.addEventListener('input', function (event) {
                            if (event.target.id === 'search-input') {
                                var searchValue = event.target.value.toLowerCase();
                                var botMessageScroll = document.getElementById('bot-message-scroll');
                                var buttons = botMessageScroll.getElementsByClassName('booking-button');
                                var moduleName = 'custom bookings';

                                filterButtons(searchValue, buttons, moduleName);
                            }
                        });
                        closeType();
                        scrollToBottom();
                
                    userInputElement.removeEventListener('keypress', userInputElement._listener);
                })
                .catch(error => {
                    console.error('Error:', error);
                });                
        
            }
            displayPrompt();
        }

        function askBookingNumbertrp(messages) {
            var inputValues = {};
            var currentIndex = 0;
            var userInputElement = document.getElementById('user-input');
        
            function displayPrompt() {
                var message = messages[currentIndex];
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat">`;

                //var botMessageHTML = '<div class="message-container"><div class="bot-avatar"><img src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 30px; height: auto;"></div><div class="bot-message">';
                var botMessageHTML2 = '<div class="message-container"><div class="bot-message-time">';

                    if (message.toLowerCase() === "from date") {
                        botMessageHTML += 'Please enter the "<b>' + message + '</b>"';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        var currentDate = new Date();
                        currentDate.setMonth(currentDate.getMonth() - 1);
    
                        var year = currentDate.getFullYear();
                        var month = String(currentDate.getMonth() + 1).padStart(2, '0');
                        var day = String(currentDate.getDate()).padStart(2, '0');
                        var hours = String(currentDate.getHours()).padStart(2, '0');
                        var minutes = String(currentDate.getMinutes()).padStart(2, '0');
                        var defaultDate = year + '-' + month + '-' + day + 'T' + hours + ':' + minutes;
    
                        botMessageHTML2 += '<input type="datetime-local" id="datetime-input" value="' + defaultDate + '">';
                        chatContainer.innerHTML += botMessageHTML2;
                        setTimeout(function() {
                            var datetimeInput = document.getElementById('datetime-input');
                            datetimeInput.focus();
                        }, 0);
                        scrollToBottom();
                
                        var datetimeInput = document.getElementById('datetime-input');
    
                        userInputElement.style.display = 'none';
                
                        datetimeInput.addEventListener('blur', function(event) {
                            var userInput = this.value.trim().split("T")[0];
                            simpleUserMessage(userInput);
                
                            inputValues["booking" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
    
                            var botMessageCheck = document.querySelector('.bot-message-time');
                            if (botMessageCheck) {
                                botMessageCheck.remove();
                            }
    
                            userInputElement.style.display = 'block';
                
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        });
                    } else if (message.toLowerCase() === "to date") {
                        botMessageHTML += 'Please enter the "<b>' + message + '</b>"';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        var defaultDate = new Date().toISOString().slice(0, 16);
                        botMessageHTML2 += '<input type="datetime-local" id="datetime-input" value="' + defaultDate + '">';
                        chatContainer.innerHTML += botMessageHTML2;
                        setTimeout(function() {
                            var datetimeInput = document.getElementById('datetime-input');
                            datetimeInput.focus();
                        }, 0);
                        scrollToBottom();
                
                        var datetimeInput = document.getElementById('datetime-input');
    
                        userInputElement.style.display = 'none';
                
                        datetimeInput.addEventListener('blur', function(event) {
                            var userInput = this.value.trim().split("T")[0];
                            simpleUserMessage(userInput);
                
                            inputValues["booking" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
    
                            var botMessageCheck = document.querySelector('.bot-message-time');
                            if (botMessageCheck) {
                                botMessageCheck.remove();
                            }
    
                            userInputElement.style.display = 'block';
                
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        });
                    } else {
                    botMessageHTML += 'Please type in the "<b>' + message + '</b>"';
                    chatContainer.innerHTML += botMessageHTML;
                    var currentTime = new Date().toLocaleTimeString();
                    var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                    chatContainer.innerHTML += botTimeHTML;
                    scrollToBottom();
            
                    userInputElement.focus();
            
                    if (userInputElement._listener) {
                        userInputElement.removeEventListener('keypress', userInputElement._listener);
                    }
            
                    userInputElement._listener = function (event) {
                        if (event.key === 'Enter') {
                            event.preventDefault();
                            var userInput = this.value.trim();
                            simpleUserMessage(userInput);
            
                            inputValues["booking" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
            
                            this.value = '';
            
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        }
                    };
            
                    userInputElement.addEventListener('keypress', userInputElement._listener);
                }
            }
        
            function sendAllInputs() {
                typingMessage();
                fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_input: {
                            ...inputValues,
                            'current_date': formattedDate,
                            'tenantid': tenantid,
                            'officeid': officeid,
                            'userid': userid,
                            'userid2': userid2,
                            'environment': environment,
                            'userid2': userid2,
                            'trpid': trpid
                        }
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    var inputSummary = '<b>[ </b>' + Object.keys(inputValues).map(function(key, index, array) {
                        var displayKey = key.replace(/^booking/, '').replace(/_/g, ' ');
                        var comma = (index !== array.length - 1) ? ', ' : '';
                        return '<b>' + displayKey + ':</b> ' + inputValues[key] + comma;
                    }).join('') + '<b> ]</b>';    
                    
                    var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                        <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                    </div></div><div class="bot-message-booking"><b>Transport booking search result based on your criteria </b>${formatKeyValueList(inputSummary)}`;
                    
                    //var botMessageHTML = '<div class="message-container"><div class="bot-avatar"><img src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 30px; height: auto;"></div><div class="bot-message-booking"><b>Custom broker booking search result based on your criteria <br><br></b>' + '<span style="font-size:14px;">' + formatKeyValueList(inputSummary) + '</span><br><br>';

                        var bookingSets = data.response.split('},');

                        if (bookingSets.length > 1) {
                            botMessageHTML += '<b>Multiple result found. Please select and view the details</b><br><br>';
                            var counter = 1;
                            var buttonHTML = '';
                        
                            bookingSets.forEach((bookingSet, index) => {
                                var cleanedBookingSet = bookingSet.replace(/[\[\]{}"]/g, '');
                        
                                if (cleanedBookingSet.trim() !== '') {
                                    cleanedBookingSet = cleanedBookingSet.trim();
                        
                                    var keyValuePairs = cleanedBookingSet.split(',');
                        
                                    var bookingNumber = '';
                                    var statusCode = '';
                                    var det = '';
                                    var bookingHTML = '<table class="booking-details">';
                                    keyValuePairs.forEach(pair => {
                                        var parts = pair.split(':');
                                        var key = parts[0].trim();
                                        var value = parts.slice(1).join(':').trim();
                        
                                        if (key.toUpperCase() === 'BOOKING NUMBER') {
                                            if (value === 'null') {
                                                bookingNumber = null;
                                            } else {
                                                bookingNumber = value;
                                            }
                                        } else if (key.toUpperCase() === 'STATUS' && !bookingNumber) {
                                            statusCode = value;
                                        } else if (key.toUpperCase() === 'BOOKING DATE') {
                                            bookingdate = value;
                                        } else if (key.toUpperCase() === 'BOOKING PARTY') {
                                            bookingparty = value;
                                        }
                                        
                                        det += value + ',';
                                        console.log(det);
                                        bookingHTML += '<tr><td><span class="key">' + key + '</span></td><td><span class="value">' + value + '</span></td></tr>\n';
                                    });
                                    bookingHTML += '</table>';
            
                                    if (!bookingNumber) {
                                        buttonHTML += '<button class="booking-button" onclick="showBookingDetails(\'' + bookingNumber + '\', ' + counter + ')"><div style="float: left; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; border-right: 2px solid #f2f2f2;">' + bookingparty +'<span color: transparent;' + det +'</span></div><div style="display: inline-block; text-align: center; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center;">' + bookingdate + '</div><div style="float: right; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: right; border-left: 2px solid #f2f2f2;">' + statusCode + '</div></button><br>';
                                    } else {
                                        buttonHTML += '<button class="booking-button" onclick="showBookingDetails(\'' + bookingNumber + '\', ' + counter + ')"><div style="float: left; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; border-right: 2px solid #f2f2f2;">' + bookingparty +'<span color: transparent;' + det +'</span></div><div style="display: inline-block; text-align: center; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center;">' + bookingdate + '</div><div style="float: right; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: right; border-left: 2px solid #f2f2f2;">' + bookingNumber + '</div></button><br>';
                                    }

                                    buttonHTML += '<div id="' + counter + 'bookingDetails_' + bookingNumber + '" style="display: none;">' + bookingHTML + '</div><br>';
                                    counter++;
                                }
                            });

                            var botDiv = `<div style="border: 1px solid transparent; padding-top: 10px; padding-left: 2px; padding-right: 2px; padding-bottom: 3px; border-radius: 10px; margin-top: 10px; background-color: #c0c0c0;">`;    
                            botDiv += '<input type="text" id="search-input" style="width: 100%;" placeholder="Global Search...">';
                            var botDiv2 = `<div style="border-left: 1px solid transparent; background-color: #e5e4e2; padding: 4px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px;">`;
                            botDiv2 += '<div id="num" style="font-size: 14px; display: flex; padding: 5px; align-items: left; justify-content: left;"></div>';
                            botDiv2 += '<div><table style="border-collapse: collapse; width: 100%; margin-bottom: 5px;"><thead style="background-color: #002147; color: white;"><tr><th style="border: 1px solid #dddddd; text-align: left; padding: 8px; width: 33.17%;">BOOKING PARTY</th><th style="border: 1px solid #dddddd; text-align: center; padding: 8px; width: 33.16%;">BOOKING DATE</th><th style="border: 1px solid #dddddd; text-align: right; padding: 8px; width: 33.66%;">BOOKING NO</th></tr></thead></table></div>';
                            botDiv2 +=  '<div id="bot-message-scroll" style="max-height: 250px; overflow-y: auto; overflow-x: hidden;">' + buttonHTML +'</div>';
                            botDiv2 += `</div>`;
                            botDiv += botDiv2;
                            botDiv += `</div>`;
                            botMessageHTML += botDiv;
                            botMessageHTML += '<div style="margin-top: 20px;"><b>If you have any questions or concerns about the results, please verify them using our application or contact our support team.</b></div>';
                        }
                         else {
                            bookingSets.forEach(bookingSet => {
                                var cleanedBookingSet = bookingSet.replace(/[\[\]{}"]/g, '');
                        
                                if (cleanedBookingSet.trim() !== '') {
                                    cleanedBookingSet = cleanedBookingSet.trim();
                        
                                    var keyValuePairs = cleanedBookingSet.split(',');
                        
                                    var bookingHTML = '<table class="booking-details">';
                                    keyValuePairs.forEach(pair => {
                                        var parts = pair.split(':');
                                        var key = parts[0].trim();
                                        var value = parts.slice(1).join(':').trim();
                        
                                        bookingHTML += '<tr><td><span class="key">' + key + '</span></td><td><span class="value">' + value + '</span></td></tr>\n';
                                    });
                                    bookingHTML += '</table><br>';
                                    botMessageHTML += bookingHTML;
                                }
                            });
                        }
                        
                        botMessageHTML += '</div></div>';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">'+ 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        document.addEventListener('input', function (event) {
                            if (event.target.id === 'search-input') {
                                var searchValue = event.target.value.toLowerCase();
                                var botMessageScroll = document.getElementById('bot-message-scroll');
                                var buttons = botMessageScroll.getElementsByClassName('booking-button');
                                var moduleName = 'transport bookings';

                                filterButtons(searchValue, buttons, moduleName);
                            }
                        });
                        closeType();
                        scrollToBottom();
                
                    userInputElement.removeEventListener('keypress', userInputElement._listener);
                })
                .catch(error => {
                    console.error('Error:', error);
                });                
        
            }
            displayPrompt();
        }

        function askBookingNumbercustomSB(messages) {
            var inputValues = {};
            var currentIndex = 0;
            var userInputElement = document.getElementById('user-input');
        
            function displayPrompt() {
                var message = messages[currentIndex];
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat">`;

                //var botMessageHTML = '<div class="message-container"><div class="bot-avatar"><img src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 30px; height: auto;"></div><div class="bot-message">';
                var botMessageHTML2 = '<div class="message-container"><div class="bot-message-time">';

                    if (message.toLowerCase() === "sb from date") {
                        botMessageHTML += 'Please enter the "<b>' + message + '</b>"';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        var currentDate = new Date();
                        currentDate.setMonth(currentDate.getMonth() - 1);
    
                        var year = currentDate.getFullYear();
                        var month = String(currentDate.getMonth() + 1).padStart(2, '0');
                        var day = String(currentDate.getDate()).padStart(2, '0');
                        var hours = String(currentDate.getHours()).padStart(2, '0');
                        var minutes = String(currentDate.getMinutes()).padStart(2, '0');
                        var defaultDate = year + '-' + month + '-' + day + 'T' + hours + ':' + minutes;
    
                        botMessageHTML2 += '<input type="datetime-local" id="datetime-input" value="' + defaultDate + '">';
                        chatContainer.innerHTML += botMessageHTML2;
                        setTimeout(function() {
                            var datetimeInput = document.getElementById('datetime-input');
                            datetimeInput.focus();
                        }, 0);
                        scrollToBottom();
                
                        var datetimeInput = document.getElementById('datetime-input');
    
                        userInputElement.style.display = 'none';
                
                        datetimeInput.addEventListener('blur', function(event) {
                            var userInput = this.value.trim().split("T")[0];
                            simpleUserMessage(userInput);
                
                            inputValues["customSB" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
    
                            var botMessageCheck = document.querySelector('.bot-message-time');
                            if (botMessageCheck) {
                                botMessageCheck.remove();
                            }
    
                            userInputElement.style.display = 'block';
                
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        });
                    } else if (message.toLowerCase() === "sb to date") {
                        botMessageHTML += 'Please enter the "<b>' + message + '</b>"';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        var defaultDate = new Date().toISOString().slice(0, 16);
                        botMessageHTML2 += '<input type="datetime-local" id="datetime-input" value="' + defaultDate + '">';
                        chatContainer.innerHTML += botMessageHTML2;
                        setTimeout(function() {
                            var datetimeInput = document.getElementById('datetime-input');
                            datetimeInput.focus();
                        }, 0);
                        scrollToBottom();
                
                        var datetimeInput = document.getElementById('datetime-input');
    
                        userInputElement.style.display = 'none';
                
                        datetimeInput.addEventListener('blur', function(event) {
                            var userInput = this.value.trim().split("T")[0];
                            simpleUserMessage(userInput);
                
                            inputValues["customSB" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
    
                            var botMessageCheck = document.querySelector('.bot-message-time');
                            if (botMessageCheck) {
                                botMessageCheck.remove();
                            }
    
                            userInputElement.style.display = 'block';
                
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        });
                    } else {
                    botMessageHTML += 'Please type in the "<b>' + message + '</b>"';
                    chatContainer.innerHTML += botMessageHTML;
                    var currentTime = new Date().toLocaleTimeString();
                    var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                    chatContainer.innerHTML += botTimeHTML;
                    scrollToBottom();
            
                    userInputElement.focus();
            
                    if (userInputElement._listener) {
                        userInputElement.removeEventListener('keypress', userInputElement._listener);
                    }
            
                    userInputElement._listener = function (event) {
                        if (event.key === 'Enter') {
                            event.preventDefault();
                            var userInput = this.value.trim();
                            simpleUserMessage(userInput);
            
                            inputValues["customSB" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
            
                            this.value = '';
            
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        }
                    };
            
                    userInputElement.addEventListener('keypress', userInputElement._listener);
                }
            }
        
            function sendAllInputs() {
                typingMessage();
                fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_input: {
                            ...inputValues,
                            'current_date': formattedDate,
                            'tenantid': tenantid,
                            'officeid': officeid,
                            'userid': userid,
                            'userid2': userid2,
                            'environment': environment,
                            'userid2': userid2,
                            'chaid': chaid
                        }
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    var inputSummary = '<b>[ </b>' + Object.keys(inputValues).map(function(key, index, array) {
                        var displayKey = key.replace(/^customSB/, '').replace(/_/g, ' ');
                        var comma = (index !== array.length - 1) ? ', ' : '';
                        return '<b>' + displayKey + ':</b> ' + inputValues[key] + comma;
                    }).join('') + '<b> ]</b>';   
                    
                    var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                        <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                    </div></div><div class="bot-message-booking"><b>Shipping bills search result based on your criteria </b>${formatKeyValueList(inputSummary)}`;
                    
                    //var botMessageHTML = '<div class="message-container"><div class="bot-avatar"><img src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 30px; height: auto;"></div><div class="bot-message-booking"><b>Shipping bills search result based on your criteria <br><br></b>' + '<span style="font-size:14px;">' + formatKeyValueList(inputSummary) + '</span><br><br>';

                        var bookingSets = data.response.split('},');

                        if (bookingSets.length > 1) {
                            botMessageHTML += '<b>Multiple entries found. Please pick one to view more details</b><br><br>';
                            var counter = 1;
                            var buttonHTML = '';
                        
                            bookingSets.forEach((bookingSet, index) => {
                                var cleanedBookingSet = bookingSet.replace(/[\[\]{}"]/g, '');
                        
                                if (cleanedBookingSet.trim() !== '') {
                                    cleanedBookingSet = cleanedBookingSet.trim();
                        
                                    var keyValuePairs = cleanedBookingSet.split(',');
                        
                                    var bookingNumber = '';
                                    var statusCode = '';
                                    var det = '';
                                    var bookingHTML = '<table class="booking-details">';
                                    keyValuePairs.forEach(pair => {
                                        var parts = pair.split(':');
                                        var key = parts[0].trim();
                                        var value = parts.slice(1).join(':').trim();
                        
                                        if (key.toUpperCase() === 'JOB NUMBER') {
                                            if (value === 'null') {
                                                bookingNumber = null;
                                            } else {
                                                bookingNumber = value;
                                            }
                                        } else if (key.toUpperCase() === 'STATUS' && !bookingNumber) {
                                            statusCode = value;
                                        } else if (key.toUpperCase() === 'JOB DATE') {
                                            bookingdate = value;
                                        } else if (key.toUpperCase() === 'CONSIGNEE') {
                                            bookingparty = value;
                                        }
                                        
                                        det += value + ',';
                                        bookingHTML += '<tr><td><span class="key">' + key + '</span></td><td><span class="value">' + value + '</span></td></tr>\n';
                                    });
                                    bookingHTML += '</table>';
            
                                    if (!bookingNumber) {
                                        buttonHTML += '<button class="booking-button" onclick="showBookingDetails(\'' + bookingNumber + '\', ' + counter + ')"><div style="float: left; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; border-right: 2px solid #f2f2f2;">' + bookingparty + '<span color: transparent;' + det +'</span></div><div style="display: inline-block; text-align: center; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center;">' + bookingdate + '</div><div style="float: right; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: right; border-left: 2px solid #f2f2f2;">' + statusCode + '</div></button><br>';
                                    } else {
                                        buttonHTML += '<button class="booking-button" onclick="showBookingDetails(\'' + bookingNumber + '\', ' + counter + ')"><div style="float: left; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; border-right: 2px solid #f2f2f2;">' + bookingparty + '<span color: transparent;' + det +'</span></div><div style="display: inline-block; text-align: center; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center;">' + bookingdate + '</div><div style="float: right; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: right; border-left: 2px solid #f2f2f2;">' + bookingNumber + '</div></button><br>';
                                    }

                                    buttonHTML += '<div id="' + counter + 'bookingDetails_' + bookingNumber + '" style="display: none;">' + bookingHTML + '</div><br>';
                                    counter++;
                                }
                            });

                            var botDiv = `<div style="border: 1px solid transparent; padding-top: 10px; padding-left: 2px; padding-right: 2px; padding-bottom: 3px; border-radius: 10px; margin-top: 10px; background-color: #c0c0c0;">`;    
                            botDiv += '<input type="text" id="search-input" style="width: 100%;" placeholder="Global Search...">';
                            var botDiv2 = `<div style="border-left: 1px solid transparent; background-color: #e5e4e2; padding: 4px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px;">`;
                            botDiv2 += '<div id="num" style="font-size: 14px; display: flex; padding: 5px; align-items: left; justify-content: left;"></div>';
                            botDiv2 += '<div><table style="border-collapse: collapse; width: 100%; margin-bottom: 5px;"><thead style="background-color: #002147; color: white;"><tr><th style="border: 1px solid #dddddd; text-align: left; padding: 8px; width: 33.17%;">CONSIGNEE</th><th style="border: 1px solid #dddddd; text-align: center; padding: 8px; width: 33.16%;">JOB DATE</th><th style="border: 1px solid #dddddd; text-align: right; padding: 8px; width: 33.66%;">JOB NO</th></tr></thead></table></div>';
                            botDiv2 +=  '<div id="bot-message-scroll" style="max-height: 250px; overflow-y: auto; overflow-x: hidden;">' + buttonHTML +'</div>';
                            botDiv2 += `</div>`;
                            botDiv += botDiv2;
                            botDiv += `</div>`;
                            botMessageHTML += botDiv;
                            botMessageHTML += '<div style="margin-top: 20px;"><b>If you have any questions or concerns about the results, please verify them using our application or contact our support team.</b></div>';
                        }
                         else {
                            bookingSets.forEach(bookingSet => {
                                var cleanedBookingSet = bookingSet.replace(/[\[\]{}"]/g, '');
                        
                                if (cleanedBookingSet.trim() !== '') {
                                    cleanedBookingSet = cleanedBookingSet.trim();
                        
                                    var keyValuePairs = cleanedBookingSet.split(',');
                        
                                    var bookingHTML = '<table class="booking-details">';
                                    keyValuePairs.forEach(pair => {
                                        var parts = pair.split(':');
                                        var key = parts[0].trim();
                                        var value = parts.slice(1).join(':').trim();
                        
                                        bookingHTML += '<tr><td><span class="key">' + key + '</span></td><td><span class="value">' + value + '</span></td></tr>\n';
                                    });
                                    bookingHTML += '</table><br>';
                                    botMessageHTML += bookingHTML;
                                }
                            });
                        }
                        
                        botMessageHTML += '</div></div>';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">'+ 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        document.addEventListener('input', function (event) {
                            if (event.target.id === 'search-input') {
                                var searchValue = event.target.value.toLowerCase();
                                var botMessageScroll = document.getElementById('bot-message-scroll');
                                var buttons = botMessageScroll.getElementsByClassName('booking-button');
                                var moduleName = 'shipping bills';

                                filterButtons(searchValue, buttons, moduleName);
                            }
                        });
                        closeType();
                        scrollToBottom();
                
                    userInputElement.removeEventListener('keypress', userInputElement._listener);
                })
                .catch(error => {
                    console.error('Error:', error);
                });                
        
            }
            displayPrompt();
        }

        function askBookingNumbercustomBE(messages) {
            var inputValues = {};
            var currentIndex = 0;
            var userInputElement = document.getElementById('user-input');
        
            function displayPrompt() {
                var message = messages[currentIndex];
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat">`;

                //var botMessageHTML = '<div class="message-container"><div class="bot-avatar"><img src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 30px; height: auto;"></div><div class="bot-message">';
                var botMessageHTML2 = '<div class="message-container"><div class="bot-message-time">';

                    if (message.toLowerCase() === "be from date") {
                        botMessageHTML += 'Please enter the "<b>' + message + '</b>"';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        var currentDate = new Date();
                        currentDate.setMonth(currentDate.getMonth() - 1);
    
                        var year = currentDate.getFullYear();
                        var month = String(currentDate.getMonth() + 1).padStart(2, '0');
                        var day = String(currentDate.getDate()).padStart(2, '0');
                        var hours = String(currentDate.getHours()).padStart(2, '0');
                        var minutes = String(currentDate.getMinutes()).padStart(2, '0');
                        var defaultDate = year + '-' + month + '-' + day + 'T' + hours + ':' + minutes;
    
                        botMessageHTML2 += '<input type="datetime-local" id="datetime-input" value="' + defaultDate + '">';
                        chatContainer.innerHTML += botMessageHTML2;
                        setTimeout(function() {
                            var datetimeInput = document.getElementById('datetime-input');
                            datetimeInput.focus();
                        }, 0);
                        scrollToBottom();
                
                        var datetimeInput = document.getElementById('datetime-input');
    
                        userInputElement.style.display = 'none';
                
                        datetimeInput.addEventListener('blur', function(event) {
                            var userInput = this.value.trim().split("T")[0];
                            simpleUserMessage(userInput);
                
                            inputValues["customBE" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
    
                            var botMessageCheck = document.querySelector('.bot-message-time');
                            if (botMessageCheck) {
                                botMessageCheck.remove();
                            }
    
                            userInputElement.style.display = 'block';
                
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        });
                    } else if (message.toLowerCase() === "be to date") {
                        botMessageHTML += 'Please enter the "<b>' + message + '</b>"';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        var defaultDate = new Date().toISOString().slice(0, 16);
                        botMessageHTML2 += '<input type="datetime-local" id="datetime-input" value="' + defaultDate + '">';
                        chatContainer.innerHTML += botMessageHTML2;
                        setTimeout(function() {
                            var datetimeInput = document.getElementById('datetime-input');
                            datetimeInput.focus();
                        }, 0);
                        scrollToBottom();
                
                        var datetimeInput = document.getElementById('datetime-input');
    
                        userInputElement.style.display = 'none';
                
                        datetimeInput.addEventListener('blur', function(event) {
                            var userInput = this.value.trim().split("T")[0];
                            simpleUserMessage(userInput);
                
                            inputValues["customBE" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
    
                            var botMessageCheck = document.querySelector('.bot-message-time');
                            if (botMessageCheck) {
                                botMessageCheck.remove();
                            }
    
                            userInputElement.style.display = 'block';
                
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        });
                    } else {
                    botMessageHTML += 'Please type in the "<b>' + message + '</b>"';
                    chatContainer.innerHTML += botMessageHTML;
                    var currentTime = new Date().toLocaleTimeString();
                    var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                    chatContainer.innerHTML += botTimeHTML;
                    scrollToBottom();
            
                    userInputElement.focus();
            
                    if (userInputElement._listener) {
                        userInputElement.removeEventListener('keypress', userInputElement._listener);
                    }
            
                    userInputElement._listener = function (event) {
                        if (event.key === 'Enter') {
                            event.preventDefault();
                            var userInput = this.value.trim();
                            simpleUserMessage(userInput);
            
                            inputValues["customBE" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
            
                            this.value = '';
            
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        }
                    };
            
                    userInputElement.addEventListener('keypress', userInputElement._listener);
                }
            }
        
            function sendAllInputs() {
                typingMessage();
                fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_input: {
                            ...inputValues,
                            'current_date': formattedDate,
                            'tenantid': tenantid,
                            'officeid': officeid,
                            'userid': userid,
                            'userid2': userid2,
                            'environment': environment,
                            'userid2': userid2,
                            'chaid': chaid
                        }
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    var inputSummary = '<b>[ </b>' + Object.keys(inputValues).map(function(key, index, array) {
                        var displayKey = key.replace(/^customBE/, '').replace(/_/g, ' ');
                        var comma = (index !== array.length - 1) ? ', ' : '';
                        return '<b>' + displayKey + ':</b> ' + inputValues[key] + comma;
                    }).join('') + '<b> ]</b>';   
                    
                    var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                        <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                    </div></div><div class="bot-message-booking"><b>Bill of entry search result based on your criteria </b>${formatKeyValueList(inputSummary)}`;
                    
                    //var botMessageHTML = '<div class="message-container"><div class="bot-avatar"><img src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 30px; height: auto;"></div><div class="bot-message-booking"><b>Bill of entry search result based on your criteria <br><br></b>' + '<span style="font-size:14px;">' + formatKeyValueList(inputSummary) + '</span><br><br>';

                        var bookingSets = data.response.split('},');

                        if (bookingSets.length > 1) {
                            botMessageHTML += '<b>Multiple entries found. Please pick one to view more details</b><br><br>';
                            var counter = 1;
                            var buttonHTML = '';
                        
                            bookingSets.forEach((bookingSet, index) => {
                                var cleanedBookingSet = bookingSet.replace(/[\[\]{}"]/g, '');
                        
                                if (cleanedBookingSet.trim() !== '') {
                                    cleanedBookingSet = cleanedBookingSet.trim();
                        
                                    var keyValuePairs = cleanedBookingSet.split(',');
                        
                                    var bookingNumber = '';
                                    var statusCode = '';
                                    var det = '';
                                    var bookingHTML = '<table class="booking-details">';
                                    keyValuePairs.forEach(pair => {
                                        var parts = pair.split(':');
                                        var key = parts[0].trim();
                                        var value = parts.slice(1).join(':').trim();
                        
                                        if (key.toUpperCase() === 'JOB NUMBER') {
                                            if (value === 'null') {
                                                bookingNumber = null;
                                            } else {
                                                bookingNumber = value;
                                            }
                                        } else if (key.toUpperCase() === 'STATUS' && !bookingNumber) {
                                            statusCode = value;
                                        } else if (key.toUpperCase() === 'JOB DATE') {
                                            bookingdate = value;
                                        } else if (key.toUpperCase() === 'SHIPPER') {
                                            bookingparty = value;
                                        }
                                        
                                        det += value + ',';
                                        bookingHTML += '<tr><td><span class="key">' + key + '</span></td><td><span class="value">' + value + '</span></td></tr>\n';
                                    });
                                    bookingHTML += '</table>';
            
                                    if (!bookingNumber) {
                                        buttonHTML += '<button class="booking-button" onclick="showBookingDetails(\'' + bookingNumber + '\', ' + counter + ')"><div style="float: left; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; border-right: 2px solid #f2f2f2;">' + bookingparty + '<span color: transparent;' + det +'</span></div><div style="display: inline-block; text-align: center; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center;">' + bookingdate + '</div><div style="float: right; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: right; border-left: 2px solid #f2f2f2;">' + statusCode + '</div></button><br>';
                                    } else {
                                        buttonHTML += '<button class="booking-button" onclick="showBookingDetails(\'' + bookingNumber + '\', ' + counter + ')"><div style="float: left; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; border-right: 2px solid #f2f2f2;">' + bookingparty + '<span color: transparent;' + det +'</span></div><div style="display: inline-block; text-align: center; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center;">' + bookingdate + '</div><div style="float: right; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: right; border-left: 2px solid #f2f2f2;">' + bookingNumber + '</div></button><br>';
                                    }

                                    buttonHTML += '<div id="' + counter + 'bookingDetails_' + bookingNumber + '" style="display: none;">' + bookingHTML + '</div><br>';
                                    counter++;
                                }
                            });

                            var botDiv = `<div style="border: 1px solid transparent; padding-top: 10px; padding-left: 2px; padding-right: 2px; padding-bottom: 3px; border-radius: 10px; margin-top: 10px; background-color: #c0c0c0;">`;    
                            botDiv += '<input type="text" id="search-input" style="width: 100%;" placeholder="Global Search...">';
                            var botDiv2 = `<div style="border-left: 1px solid transparent; background-color: #e5e4e2; padding: 4px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px;">`;
                            botDiv2 += '<div id="num" style="font-size: 14px; display: flex; padding: 5px; align-items: left; justify-content: left;"></div>';
                            botDiv2 += '<div><table style="border-collapse: collapse; width: 100%; margin-bottom: 5px;"><thead style="background-color: #002147; color: white;"><tr><th style="border: 1px solid #dddddd; text-align: left; padding: 8px; width: 33.17%;">SHIPPER</th><th style="border: 1px solid #dddddd; text-align: center; padding: 8px; width: 33.16%;">JOB DATE</th><th style="border: 1px solid #dddddd; text-align: right; padding: 8px; width: 33.66%;">JOB NO</th></tr></thead></table></div>';
                            botDiv2 +=  '<div id="bot-message-scroll" style="max-height: 250px; overflow-y: auto; overflow-x: hidden;">' + buttonHTML +'</div>';
                            botDiv2 += `</div>`;
                            botDiv += botDiv2;
                            botDiv += `</div>`;
                            botMessageHTML += botDiv;
                            botMessageHTML += '<div style="margin-top: 20px;"><b>If you have any questions or concerns about the results, please verify them using our application or contact our support team.</b></div>';
                        }
                         else {
                            bookingSets.forEach(bookingSet => {
                                var cleanedBookingSet = bookingSet.replace(/[\[\]{}"]/g, '');
                        
                                if (cleanedBookingSet.trim() !== '') {
                                    cleanedBookingSet = cleanedBookingSet.trim();
                        
                                    var keyValuePairs = cleanedBookingSet.split(',');
                        
                                    var bookingHTML = '<table class="booking-details">';
                                    keyValuePairs.forEach(pair => {
                                        var parts = pair.split(':');
                                        var key = parts[0].trim();
                                        var value = parts.slice(1).join(':').trim();
                        
                                        bookingHTML += '<tr><td><span class="key">' + key + '</span></td><td><span class="value">' + value + '</span></td></tr>\n';
                                    });
                                    bookingHTML += '</table><br>';
                                    botMessageHTML += bookingHTML;
                                }
                            });
                        }
                        
                        botMessageHTML += '</div></div>';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">'+ 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        document.addEventListener('input', function (event) {
                            if (event.target.id === 'search-input') {
                                var searchValue = event.target.value.toLowerCase();
                                var botMessageScroll = document.getElementById('bot-message-scroll');
                                var buttons = botMessageScroll.getElementsByClassName('booking-button');
                                var moduleName = 'bill of entries';

                                filterButtons(searchValue, buttons);
                            }
                        });
                        closeType();
                        scrollToBottom();
                
                    userInputElement.removeEventListener('keypress', userInputElement._listener);
                })
                .catch(error => {
                    console.error('Error:', error);
                });                
        
            }
            displayPrompt();
        }

        function askBookingNumberbuying(messages) {
            var inputValues = {};
            var currentIndex = 0;
            var userInputElement = document.getElementById('user-input');
        
            function displayPrompt() {
                var message = messages[currentIndex];
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat">`;

                //var botMessageHTML = '<div class="message-container"><div class="bot-avatar"><img src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 30px; height: auto;"></div><div class="bot-message">';
                var botMessageHTML2 = '<div class="message-container"><div class="bot-message-time">';

                    if (message.toLowerCase() === "from date") {
                        botMessageHTML += 'Please enter the "<b>' + message + '</b>"';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        var currentDate = new Date();
                        currentDate.setMonth(currentDate.getMonth() - 1);
    
                        var year = currentDate.getFullYear();
                        var month = String(currentDate.getMonth() + 1).padStart(2, '0');
                        var day = String(currentDate.getDate()).padStart(2, '0');
                        var hours = String(currentDate.getHours()).padStart(2, '0');
                        var minutes = String(currentDate.getMinutes()).padStart(2, '0');
                        var defaultDate = year + '-' + month + '-' + day + 'T' + hours + ':' + minutes;
    
                        botMessageHTML2 += '<input type="datetime-local" id="datetime-input" value="' + defaultDate + '">';
                        chatContainer.innerHTML += botMessageHTML2;
                        setTimeout(function() {
                            var datetimeInput = document.getElementById('datetime-input');
                            datetimeInput.focus();
                        }, 0);
                        scrollToBottom();
                
                        var datetimeInput = document.getElementById('datetime-input');
    
                        userInputElement.style.display = 'none';
                
                        datetimeInput.addEventListener('blur', function(event) {
                            var userInput = this.value.trim().split("T")[0];
                            simpleUserMessage(userInput);
                
                            inputValues["buy" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
    
                            var botMessageCheck = document.querySelector('.bot-message-time');
                            if (botMessageCheck) {
                                botMessageCheck.remove();
                            }
    
                            userInputElement.style.display = 'block';
                
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        });
                    } else if (message.toLowerCase() === "to date") {
                        botMessageHTML += 'Please enter the "<b>' + message + '</b>"';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        var defaultDate = new Date().toISOString().slice(0, 16);
                        botMessageHTML2 += '<input type="datetime-local" id="datetime-input" value="' + defaultDate + '">';
                        chatContainer.innerHTML += botMessageHTML2;
                        setTimeout(function() {
                            var datetimeInput = document.getElementById('datetime-input');
                            datetimeInput.focus();
                        }, 0);
                        scrollToBottom();
                
                        var datetimeInput = document.getElementById('datetime-input');
    
                        userInputElement.style.display = 'none';
                
                        datetimeInput.addEventListener('blur', function(event) {
                            var userInput = this.value.trim().split("T")[0];
                            simpleUserMessage(userInput);
                
                            inputValues["buy" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
    
                            var botMessageCheck = document.querySelector('.bot-message-time');
                            if (botMessageCheck) {
                                botMessageCheck.remove();
                            }
    
                            userInputElement.style.display = 'block';
                
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        });
                    } else {
                    botMessageHTML += 'Please type in the "<b>' + message + '</b>"';
                    chatContainer.innerHTML += botMessageHTML;
                    var currentTime = new Date().toLocaleTimeString();
                    var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                    chatContainer.innerHTML += botTimeHTML;
                    scrollToBottom();
            
                    userInputElement.focus();
            
                    if (userInputElement._listener) {
                        userInputElement.removeEventListener('keypress', userInputElement._listener);
                    }
            
                    userInputElement._listener = function (event) {
                        if (event.key === 'Enter') {
                            event.preventDefault();
                            var userInput = this.value.trim();
                            simpleUserMessage(userInput);
            
                            inputValues["buy" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
            
                            this.value = '';
            
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        }
                    };
            
                    userInputElement.addEventListener('keypress', userInputElement._listener);
                }
            }
        
            function sendAllInputs() {
                typingMessage();
                fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_input: {
                            ...inputValues,
                            'current_date': formattedDate,
                            'tenantid': tenantid,
                            'officeid': officeid,
                            'userid': userid,
                            'userid2': userid2,
                            'environment': environment,
                        }
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    var inputSummary = '<b>[ </b>' + Object.keys(inputValues).map(function(key, index, array) {
                        var displayKey = key.replace(/^buy/, '').replace(/_/g, ' ');
                        var comma = (index !== array.length - 1) ? ', ' : '';
                        return '<b>' + displayKey + ':</b> ' + inputValues[key] + comma;
                    }).join('') + '<b> ]</b>';  
                    
                    var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                        <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                    </div></div><div class="bot-message-booking"><b>Selling search result based on your criteria </b>${formatKeyValueList(inputSummary)}`;
                    
                    //var botMessageHTML = '<div class="message-container"><div class="bot-avatar"><img src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 30px; height: auto;"></div><div class="bot-message-booking"><b>Selling search result based on your criteria <br><br></b>' + '<span style="font-size:14px;">' + formatKeyValueList(inputSummary) + '</span><br><br>';

                        var bookingSets = data.response.split('},');

                        if (bookingSets.length > 1) {
                            botMessageHTML += '<b>Multiple entries found. Please pick one to view more details</b><br><br>';
                            var counter = 1;
                            var buttonHTML = '';
                        
                            bookingSets.forEach((bookingSet, index) => {
                                var cleanedBookingSet = bookingSet.replace(/[\[\]{}"]/g, '');
                        
                                if (cleanedBookingSet.trim() !== '') {
                                    cleanedBookingSet = cleanedBookingSet.trim();
                        
                                    var keyValuePairs = cleanedBookingSet.split(',');
                        
                                    var bookingNumber = '';
                                    var statusCode = '';
                                    var det = '';
                                    var bookingHTML = '<table class="booking-details">';
                                    keyValuePairs.forEach(pair => {
                                        var parts = pair.split(':');
                                        var key = parts[0].trim();
                                        var value = parts.slice(1).join(':').trim();
                        
                                        if (key.toUpperCase() === 'BILL NUMBER') {
                                            if (value === 'null') {
                                                bookingNumber = null;
                                            } else {
                                                bookingNumber = value;
                                            }
                                        } else if (key.toUpperCase() === 'BILL STATUS' && !bookingNumber) {
                                            statusCode = value;
                                        } else if (key.toUpperCase() === 'BILL DATE' ) {
                                            billdate = value;
                                        } else if (key.toUpperCase() === 'BILL TO' ) {
                                            billto = value;
                                        }

                                        det += value + ' ';
                        
                                        bookingHTML += '<tr><td><span class="key">' + key + '</span></td><td><span class="value">' + value + '</span></td></tr>\n';
                                    });
                                    bookingHTML += '</table>';

                                    if (!bookingNumber) {
                                        buttonHTML += '<button class="booking-button" onclick="showBookingDetails(\'' + bookingNumber + '\', ' + counter + ')"><div style="float: left; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; border-right: 2px solid #f2f2f2;">' + billto + '<span color: transparent;' + det +'</span></div><div style="display: inline-block; text-align: center; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center;">' + billdate + '</div><div style="float: right; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: right; border-left: 2px solid #f2f2f2;">' + statusCode + '</div></button><br>';
                                    } else {
                                        buttonHTML += '<button class="booking-button" onclick="showBookingDetails(\'' + bookingNumber + '\', ' + counter + ')"><div style="float: left; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; border-right: 2px solid #f2f2f2;">' + billto + '<span color: transparent;' + det +'</span></div><div style="display: inline-block; text-align: center; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center;">' + billdate + '</div><div style="float: right; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: right; border-left: 2px solid #f2f2f2;">' + bookingNumber + '</div></button><br>';
                                    }

                                    buttonHTML += '<div id="'+ counter +'bookingDetails_' + bookingNumber + '" style="display: none;">' + bookingHTML + '</div><br>';
                                    counter++;
                                }
                            });

                            var botDiv = `<div style="border: 1px solid transparent; padding-top: 10px; padding-left: 2px; padding-right: 2px; padding-bottom: 3px; border-radius: 10px; margin-top: 10px; background-color: #c0c0c0;">`;    
                            botDiv += '<input type="text" id="search-input" style="width: 100%;" placeholder="Global Search...">';
                            var botDiv2 = `<div style="border-left: 1px solid transparent; background-color: #e5e4e2; padding: 4px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px;">`;
                            botDiv2 += '<div id="num" style="font-size: 14px; display: flex; padding: 5px; align-items: left; justify-content: left;"></div>';
                            botDiv2 += '<div><table style="border-collapse: collapse; width: 100%; margin-bottom: 5px;"><thead style="background-color: #002147; color: white;"><tr><th style="border: 1px solid #dddddd; text-align: left; padding: 8px; width: 33.17%;">BILL TO</th><th style="border: 1px solid #dddddd; text-align: center; padding: 8px; width: 33.16%;">BILL DATE</th><th style="border: 1px solid #dddddd; text-align: right; padding: 8px; width: 33.66%;">BILL NO</th></tr></thead></table></div>';
                            botDiv2 +=  '<div id="bot-message-scroll" style="max-height: 250px; overflow-y: auto; overflow-x: hidden;">' + buttonHTML +'</div>';
                            botDiv2 += `</div>`;
                            botDiv += botDiv2;
                            botDiv += `</div>`;
                            botMessageHTML += botDiv;
                            botMessageHTML += '<div style="margin-top: 20px;"><b>If you have any questions or concerns about the results, please verify them using our application or contact our support team.</b></div>';
                        }
                         else {
                            bookingSets.forEach(bookingSet => {
                                var cleanedBookingSet = bookingSet.replace(/[\[\]{}"]/g, '');
                        
                                if (cleanedBookingSet.trim() !== '') {
                                    cleanedBookingSet = cleanedBookingSet.trim();
                        
                                    var keyValuePairs = cleanedBookingSet.split(',');
                        
                                    var bookingHTML = '<table class="booking-details">';
                                    keyValuePairs.forEach(pair => {
                                        var parts = pair.split(':');
                                        var key = parts[0].trim();
                                        var value = parts.slice(1).join(':').trim();
                        
                                        bookingHTML += '<tr><td><span class="key">' + key + '</span></td><td><span class="value">' + value + '</span></td></tr>\n';
                                    });
                                    bookingHTML += '</table><br>';
                                    botMessageHTML += bookingHTML;
                                }
                            });
                        }
                        
                        botMessageHTML += '</div></div>';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">'+ 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        document.addEventListener('input', function (event) {
                            if (event.target.id === 'search-input') {
                                var searchValue = event.target.value.toLowerCase();
                                var botMessageScroll = document.getElementById('bot-message-scroll');
                                var buttons = botMessageScroll.getElementsByClassName('booking-button');
                                var moduleName = 'sellings';

                                filterButtons(searchValue, buttons, moduleName, moduleName);
                            }
                        });
                        closeType();
                        scrollToBottom();
                
                    userInputElement.removeEventListener('keypress', userInputElement._listener);
                })
                .catch(error => {
                    console.error('Error:', error);
                });                
        
            }
            displayPrompt();
        }

        function askBookingNumberpay(messages) {
            var inputValues = {};
            var currentIndex = 0;
            var userInputElement = document.getElementById('user-input');
        
            function displayPrompt() {
                var message = messages[currentIndex];

                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat">`;

                //var botMessageHTML = '<div class="message-container"><div class="bot-avatar"><img src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 30px; height: auto;"></div><div class="bot-message">';
                var botMessageHTML2 = '<div class="message-container"><div class="bot-message-time">';

                    if (message.toLowerCase() === "from date") {
                        botMessageHTML += 'Please enter the "<b>' + message + '</b>"';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        var currentDate = new Date();
                        currentDate.setMonth(currentDate.getMonth() - 1);
    
                        var year = currentDate.getFullYear();
                        var month = String(currentDate.getMonth() + 1).padStart(2, '0');
                        var day = String(currentDate.getDate()).padStart(2, '0');
                        var hours = String(currentDate.getHours()).padStart(2, '0');
                        var minutes = String(currentDate.getMinutes()).padStart(2, '0');
                        var defaultDate = year + '-' + month + '-' + day + 'T' + hours + ':' + minutes;
    
                        botMessageHTML2 += '<input type="datetime-local" id="datetime-input" value="' + defaultDate + '">';
                        chatContainer.innerHTML += botMessageHTML2;
                        setTimeout(function() {
                            var datetimeInput = document.getElementById('datetime-input');
                            datetimeInput.focus();
                        }, 0);
                        scrollToBottom();
                
                        var datetimeInput = document.getElementById('datetime-input');
    
                        userInputElement.style.display = 'none';
                
                        datetimeInput.addEventListener('blur', function(event) {
                            var userInput = this.value.trim().split("T")[0];
                            simpleUserMessage(userInput);
                
                            inputValues["pay" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
    
                            var botMessageCheck = document.querySelector('.bot-message-time');
                            if (botMessageCheck) {
                                botMessageCheck.remove();
                            }
    
                            userInputElement.style.display = 'block';
                
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        });
                    } else if (message.toLowerCase() === "to date") {
                        botMessageHTML += 'Please enter the "<b>' + message + '</b>"';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        var defaultDate = new Date().toISOString().slice(0, 16);
                        botMessageHTML2 += '<input type="datetime-local" id="datetime-input" value="' + defaultDate + '">';
                        chatContainer.innerHTML += botMessageHTML2;
                        setTimeout(function() {
                            var datetimeInput = document.getElementById('datetime-input');
                            datetimeInput.focus();
                        }, 0);
                        scrollToBottom();
                
                        var datetimeInput = document.getElementById('datetime-input');
    
                        userInputElement.style.display = 'none';
                
                        datetimeInput.addEventListener('blur', function(event) {
                            var userInput = this.value.trim().split("T")[0];
                            simpleUserMessage(userInput);
                
                            inputValues["pay" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
    
                            var botMessageCheck = document.querySelector('.bot-message-time');
                            if (botMessageCheck) {
                                botMessageCheck.remove();
                            }
    
                            userInputElement.style.display = 'block';
                
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        });
                    } else {
                    botMessageHTML += 'Please type in the "<b>' + message + '</b>"';
                    chatContainer.innerHTML += botMessageHTML;
                    var currentTime = new Date().toLocaleTimeString();
                    var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                    chatContainer.innerHTML += botTimeHTML;
                    scrollToBottom();
            
                    userInputElement.focus();
            
                    if (userInputElement._listener) {
                        userInputElement.removeEventListener('keypress', userInputElement._listener);
                    }
            
                    userInputElement._listener = function (event) {
                        if (event.key === 'Enter') {
                            event.preventDefault();
                            var userInput = this.value.trim();
                            simpleUserMessage(userInput);
            
                            inputValues["pay" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
            
                            this.value = '';
            
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        }
                    };
            
                    userInputElement.addEventListener('keypress', userInputElement._listener);
                }
            }
        
            function sendAllInputs() {
                typingMessage();
                fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_input: {
                            ...inputValues,
                            'current_date': formattedDate,
                            'tenantid': tenantid,
                            'officeid': officeid,
                            'userid': userid,
                            'userid2': userid2,
                            'environment': environment,
                        }
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    var inputSummary = '<b>[ </b>' + Object.keys(inputValues).map(function(key, index, array) {
                        var displayKey = key.replace(/^pay/, '').replace(/_/g, ' ');
                        var comma = (index !== array.length - 1) ? ', ' : '';
                        return '<b>' + displayKey + ':</b> ' + inputValues[key] + comma;
                    }).join('') + '<b> ]</b>';   
                    
                    var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                        <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                    </div></div><div class="bot-message-booking"><b>Payments search result based on your criteria </b>${formatKeyValueList(inputSummary)}`;
                    
                    //var botMessageHTML = '<div class="message-container"><div class="bot-avatar"><img src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 30px; height: auto;"></div><div class="bot-message-booking"><b>Payments search result based on your criteria <br><br></b>' + '<span style="font-size:14px;">' + formatKeyValueList(inputSummary) + '</span><br><br>';

                        var bookingSets = data.response.split('},');

                        if (bookingSets.length > 1) {
                            botMessageHTML += '<b>Multiple entries found. Please pick one to view more details</b><br><br>';
                            var counter = 1;
                            var buttonHTML = '';
                        
                            bookingSets.forEach((bookingSet, index) => {
                                var cleanedBookingSet = bookingSet.replace(/[\[\]{}"]/g, '');
                        
                                if (cleanedBookingSet.trim() !== '') {
                                    cleanedBookingSet = cleanedBookingSet.trim();
                        
                                    var keyValuePairs = cleanedBookingSet.split(',');
                        
                                    var bookingNumber = '';
                                    var statusCode = '';
                                    var det = '';
                                    var bookingHTML = '<table class="booking-details">';
                                    keyValuePairs.forEach(pair => {
                                        var parts = pair.split(':');
                                        var key = parts[0].trim();
                                        var value = parts.slice(1).join(':').trim();
                        
                                        if (key.toUpperCase() === 'PAYMENT NUMBER') {
                                            if (value === 'null') {
                                                bookingNumber = null;
                                            } else {
                                                bookingNumber = value;
                                            }
                                        } else if (key.toUpperCase() === 'CHEQUE NUMBER' && !bookingNumber) {
                                            statusCode = value;
                                        } else if (key.toUpperCase() === 'PAYMENT DATE' ) {
                                            billdate = value;
                                        } else if (key.toUpperCase() === 'PAYMENT TO' ) {
                                            billto = value;
                                        } else if (key.toUpperCase() === 'PAYMENT MODE' ) {
                                            det += value;
                                        } else if (key.toUpperCase() === 'CHEQUE NUMBER' ) {
                                            det += value;
                                        } else if (key.toUpperCase() === 'CHEQUE DATE' ) {
                                            det += value;
                                        } else if (key.toUpperCase() === 'UTR NUMBER' ) {
                                            det += value;
                                        } else if (key.toUpperCase() === 'UTR DATE' ) {
                                            det += value;
                                        } else if (key.toUpperCase() === 'REMARK' ) {
                                            det += value;
                                        } else if (key.toUpperCase() === 'TOTAL AMOUNT' ) {
                                            det += value;
                                        } else if (key.toUpperCase() === 'UNADJUSTED AMOUNT' ) {
                                            det += value;
                                        } else if (key.toUpperCase() === 'CREATED BY' ) {
                                            det += value;
                                        } else if (key.toUpperCase() === 'CREATED DATE' ) {
                                            det += value;
                                        } else if (key.toUpperCase() === 'CONFIRMED BY' ) {
                                            det += value;
                                        } else if (key.toUpperCase() === 'CONFIRMED DATE' ) {
                                            det += value;
                                        }
                        
                                        bookingHTML += '<tr><td><span class="key">' + key + '</span></td><td><span class="value">' + value + '</span></td></tr>\n';
                                    });
                                    bookingHTML += '</table>';

                                    if (!bookingNumber) {
                                        buttonHTML += '<button class="booking-button" onclick="showBookingDetails(\'' + bookingNumber + '\', ' + counter + ')"><div style="float: left; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; border-right: 2px solid #f2f2f2;">' + billto + '<span color: transparent;' + det +'</span></div><div style="display: inline-block; text-align: center; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center;">' + billdate + '</div><div style="float: right; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: right; border-left: 2px solid #f2f2f2;">' + statusCode + '</div></button><br>';
                                    } else {
                                        buttonHTML += '<button class="booking-button" onclick="showBookingDetails(\'' + bookingNumber + '\', ' + counter + ')"><div style="float: left; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; border-right: 2px solid #f2f2f2;">' + billto + '<span color: transparent;' + det +'</span></div><div style="display: inline-block; text-align: center; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center;">' + billdate + '</div><div style="float: right; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: right; border-left: 2px solid #f2f2f2;">' + bookingNumber + '</div></button><br>';
                                    }

                                    buttonHTML += '<div id="'+ counter +'bookingDetails_' + bookingNumber + '" style="display: none;">' + bookingHTML + '</div><br>';
                                    counter++;
                                }
                            });

                            var botDiv = `<div style="border: 1px solid transparent; padding-top: 10px; padding-left: 2px; padding-right: 2px; padding-bottom: 3px; border-radius: 10px; margin-top: 10px; background-color: #c0c0c0;">`;    
                            botDiv += '<input type="text" id="search-input" style="width: 100%;" placeholder="Global Search...">';
                            var botDiv2 = `<div style="border-left: 1px solid transparent; background-color: #e5e4e2; padding: 4px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px;">`;
                            botDiv2 += '<div id="num" style="font-size: 14px; display: flex; padding: 5px; align-items: left; justify-content: left;"></div>';
                            botDiv2 += '<div><table style="border-collapse: collapse; width: 100%; margin-bottom: 5px;"><thead style="background-color: #002147; color: white;"><tr><th style="border: 1px solid #dddddd; text-align: left; padding: 8px; width: 33.17%;">PAYMENT TO</th><th style="border: 1px solid #dddddd; text-align: center; padding: 8px; width: 33.16%;">PAYMENT DATE</th><th style="border: 1px solid #dddddd; text-align: right; padding: 8px; width: 33.66%;">PAYMENT NO</th></tr></thead></table></div>';
                            botDiv2 +=  '<div id="bot-message-scroll" style="max-height: 250px; overflow-y: auto; overflow-x: hidden;">' + buttonHTML +'</div>';
                            botDiv2 += `</div>`;
                            botDiv += botDiv2;
                            botDiv += `</div>`;
                            botMessageHTML += botDiv;
                            botMessageHTML += '<div style="margin-top: 20px;"><b>If you have any questions or concerns about the results, please verify them using our application or contact our support team.</b></div>';
                        }
                         else {
                            bookingSets.forEach(bookingSet => {
                                var cleanedBookingSet = bookingSet.replace(/[\[\]{}"]/g, '');
                        
                                if (cleanedBookingSet.trim() !== '') {
                                    cleanedBookingSet = cleanedBookingSet.trim();
                        
                                    var keyValuePairs = cleanedBookingSet.split(',');
                        
                                    var bookingHTML = '<table class="booking-details">';
                                    keyValuePairs.forEach(pair => {
                                        var parts = pair.split(':');
                                        var key = parts[0].trim();
                                        var value = parts.slice(1).join(':').trim();
                        
                                        bookingHTML += '<tr><td><span class="key">' + key + '</span></td><td><span class="value">' + value + '</span></td></tr>\n';
                                    });
                                    bookingHTML += '</table><br>';
                                    botMessageHTML += bookingHTML;
                                }
                            });
                        }
                        
                        botMessageHTML += '</div></div>';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">'+ 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        document.addEventListener('input', function (event) {
                            if (event.target.id === 'search-input') {
                                var searchValue = event.target.value.toLowerCase();
                                var botMessageScroll = document.getElementById('bot-message-scroll');
                                var buttons = botMessageScroll.getElementsByClassName('booking-button');
                                var moduleName = 'payments';

                                filterButtons(searchValue, buttons, moduleName);
                            }
                        });
                        closeType();
                        scrollToBottom();
                
                    userInputElement.removeEventListener('keypress', userInputElement._listener);
                })
                .catch(error => {
                    console.error('Error:', error);
                });                
        
            }
            displayPrompt();
        }

        function askBookingNumberreceipts(messages) {
            var inputValues = {};
            var currentIndex = 0;
            var userInputElement = document.getElementById('user-input');
        
            function displayPrompt() {
                var message = messages[currentIndex];
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat">`;

                //var botMessageHTML = '<div class="message-container"><div class="bot-avatar"><img src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 30px; height: auto;"></div><div class="bot-message">';
                var botMessageHTML2 = '<div class="message-container"><div class="bot-message-time">';

                    if (message.toLowerCase() === "from date") {
                        botMessageHTML += 'Please enter the "<b>' + message + '</b>"';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        var currentDate = new Date();
                        currentDate.setMonth(currentDate.getMonth() - 1);
    
                        var year = currentDate.getFullYear();
                        var month = String(currentDate.getMonth() + 1).padStart(2, '0');
                        var day = String(currentDate.getDate()).padStart(2, '0');
                        var hours = String(currentDate.getHours()).padStart(2, '0');
                        var minutes = String(currentDate.getMinutes()).padStart(2, '0');
                        var defaultDate = year + '-' + month + '-' + day + 'T' + hours + ':' + minutes;
    
                        botMessageHTML2 += '<input type="datetime-local" id="datetime-input" value="' + defaultDate + '">';
                        chatContainer.innerHTML += botMessageHTML2;
                        setTimeout(function() {
                            var datetimeInput = document.getElementById('datetime-input');
                            datetimeInput.focus();
                        }, 0);
                        scrollToBottom();
                
                        var datetimeInput = document.getElementById('datetime-input');
    
                        userInputElement.style.display = 'none';
                
                        datetimeInput.addEventListener('blur', function(event) {
                            var userInput = this.value.trim().split("T")[0];
                            simpleUserMessage(userInput);
                
                            inputValues["receipts" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
    
                            var botMessageCheck = document.querySelector('.bot-message-time');
                            if (botMessageCheck) {
                                botMessageCheck.remove();
                            }
    
                            userInputElement.style.display = 'block';
                
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        });
                    } else if (message.toLowerCase() === "to date") {
                        botMessageHTML += 'Please enter the "<b>' + message + '</b>"';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        var defaultDate = new Date().toISOString().slice(0, 16);
                        botMessageHTML2 += '<input type="datetime-local" id="datetime-input" value="' + defaultDate + '">';
                        chatContainer.innerHTML += botMessageHTML2;
                        setTimeout(function() {
                            var datetimeInput = document.getElementById('datetime-input');
                            datetimeInput.focus();
                        }, 0);
                        scrollToBottom();
                
                        var datetimeInput = document.getElementById('datetime-input');
    
                        userInputElement.style.display = 'none';
                
                        datetimeInput.addEventListener('blur', function(event) {
                            var userInput = this.value.trim().split("T")[0];
                            simpleUserMessage(userInput);
                
                            inputValues["receipts" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
    
                            var botMessageCheck = document.querySelector('.bot-message-time');
                            if (botMessageCheck) {
                                botMessageCheck.remove();
                            }
    
                            userInputElement.style.display = 'block';
                
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        });
                    } else {
                    botMessageHTML += 'Please type in the "<b>' + message + '</b>"';
                    chatContainer.innerHTML += botMessageHTML;
                    var currentTime = new Date().toLocaleTimeString();
                    var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                    chatContainer.innerHTML += botTimeHTML;
                    scrollToBottom();
            
                    userInputElement.focus();
            
                    if (userInputElement._listener) {
                        userInputElement.removeEventListener('keypress', userInputElement._listener);
                    }
            
                    userInputElement._listener = function (event) {
                        if (event.key === 'Enter') {
                            event.preventDefault();
                            var userInput = this.value.trim();
                            simpleUserMessage(userInput);
            
                            inputValues["receipts" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
            
                            this.value = '';
            
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        }
                    };
            
                    userInputElement.addEventListener('keypress', userInputElement._listener);
                }
            }
        
            function sendAllInputs() {
                typingMessage();
                fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_input: {
                            ...inputValues,
                            'current_date': formattedDate,
                            'tenantid': tenantid,
                            'officeid': officeid,
                            'userid': userid,
                            'userid2': userid2,
                            'environment': environment,
                        }
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    var inputSummary = '<b>[ </b>' + Object.keys(inputValues).map(function(key, index, array) {
                        var displayKey = key.replace(/^receipts/, '').replace(/_/g, ' ');
                        var comma = (index !== array.length - 1) ? ', ' : '';
                        return '<b>' + displayKey + ':</b> ' + inputValues[key] + comma;
                    }).join('') + '<b> ]</b>';       
                    
                    var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                        <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                    </div></div><div class="bot-message-booking"><b>Receipts search result based on your criteria </b>${formatKeyValueList(inputSummary)}`;
                    
                    //var botMessageHTML = '<div class="message-container"><div class="bot-avatar"><img src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 30px; height: auto;"></div><div class="bot-message-booking"><b>Receipts search result based on your criteria <br><br></b>' + '<span style="font-size:14px;">' + formatKeyValueList(inputSummary) + '</span><br><br>';

                        var bookingSets = data.response.split('},');

                        if (bookingSets.length > 1) {
                            botMessageHTML += '<b>Multiple entries found. Please pick one to view more details</b><br><br>';
                            var counter = 1;
                            var buttonHTML = '';
                        
                            bookingSets.forEach((bookingSet, index) => {
                                var cleanedBookingSet = bookingSet.replace(/[\[\]{}"]/g, '');
                        
                                if (cleanedBookingSet.trim() !== '') {
                                    cleanedBookingSet = cleanedBookingSet.trim();
                        
                                    var keyValuePairs = cleanedBookingSet.split(',');
                        
                                    var bookingNumber = '';
                                    var statusCode = '';
                                    var det = '';
                                    var bookingHTML = '<table class="booking-details">';
                                    keyValuePairs.forEach(pair => {
                                        var parts = pair.split(':');
                                        var key = parts[0].trim();
                                        var value = parts.slice(1).join(':').trim();
                        
                                        if (key.toUpperCase() === 'RECEIPT NUMBER') {
                                            if (value === 'null') {
                                                bookingNumber = null;
                                            } else {
                                                bookingNumber = value;
                                            }
                                        } else if (key.toUpperCase() === 'CHEQUE NUMBER' && !bookingNumber) {
                                            statusCode = value;
                                        } else if (key.toUpperCase() === 'RECEIPT DATE' ) {
                                            billdate = value;
                                        } else if (key.toUpperCase() === 'RECEIPT FROM' ) {
                                            billto = value;
                                        } else if (key.toUpperCase() === 'CONFIRMED DATE' ) {
                                            det += value;
                                        } else if (key.toUpperCase() === 'RECEIPT MODE' ) {
                                            det += value;
                                        } else if (key.toUpperCase() === 'CHEQUE NUMBER' ) {
                                            det += value;
                                        } else if (key.toUpperCase() === 'CHEQUE DATE' ) {
                                            det += value;
                                        } else if (key.toUpperCase() === 'UTR NUMBER' ) {
                                            det += value;
                                        } else if (key.toUpperCase() === 'UTR DATE' ) {
                                            det += value;
                                        } else if (key.toUpperCase() === 'REMARK' ) {
                                            det += value;
                                        } else if (key.toUpperCase() === 'TOTAL AMOUNT' ) {
                                            det += value;
                                        } else if (key.toUpperCase() === 'CREATED BY' ) {
                                            det += value;
                                        } else if (key.toUpperCase() === 'CONFIRMED BY' ) {
                                            det += value;
                                        } else if (key.toUpperCase() === 'CREATED DATE' ) {
                                            det += value;
                                        }
                        
                                        bookingHTML += '<tr><td><span class="key">' + key + '</span></td><td><span class="value">' + value + '</span></td></tr>\n';
                                    });
                                    bookingHTML += '</table>';

                                    if (!bookingNumber) {
                                        buttonHTML += '<button class="booking-button" onclick="showBookingDetails(\'' + bookingNumber + '\', ' + counter + ')"><div style="float: left; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; border-right: 2px solid #f2f2f2;">' + billto + '<span color: transparent;' + det +'</span></div><div style="display: inline-block; text-align: center; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center;">' + billdate + '</div><div style="float: right; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: right; border-left: 2px solid #f2f2f2;">' + statusCode + '</div></button><br>';
                                    } else {
                                        buttonHTML += '<button class="booking-button" onclick="showBookingDetails(\'' + bookingNumber + '\', ' + counter + ')"><div style="float: left; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; border-right: 2px solid #f2f2f2;">' + billto + '<span color: transparent;' + det +'</span></div><div style="display: inline-block; text-align: center; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center;">' + billdate + '</div><div style="float: right; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: right; border-left: 2px solid #f2f2f2;">' + bookingNumber + '</div></button><br>';
                                    }

                                    buttonHTML += '<div id="'+ counter +'bookingDetails_' + bookingNumber + '" style="display: none;">' + bookingHTML + '</div><br>';
                                    counter++;
                                }
                            });
                            var botDiv = `<div style="border: 1px solid transparent; padding-top: 10px; padding-left: 2px; padding-right: 2px; padding-bottom: 3px; border-radius: 10px; margin-top: 10px; background-color: #c0c0c0;">`;
                            botDiv += '<input type="text" id="search-input" style="width: 100%;" placeholder="Global Search...">';
                            var botDiv2 = `<div style="border-left: 1px solid transparent; background-color: #e5e4e2; padding: 4px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px;">`;
                            botDiv2 += '<div id="num" style="font-size: 14px; display: flex; padding: 5px; align-items: left; justify-content: left;"></div>';
                            botDiv2 += '<div><table style="border-collapse: collapse; width: 100%; margin-bottom: 5px;"><thead style="background-color: #002147; color: white;"><tr><th style="border-right: 1px solid transparent; text-align: left; padding: 8px; width: 33.17%;">RECEIPT FROM</th><th style="border-left: 2px solid #f2f2f2; text-align: center; padding: 8px; width: 33.16%;">RECEIPT DATE</th><th style="border-left: 2px solid #f2f2f2; text-align: right; padding: 8px; width: 33.66%;">RECEIPT NO</th></tr></thead></table></div>';
                            botDiv2 +=  '<div id="bot-message-scroll" style="max-height: 250px; overflow-y: auto; overflow-x: hidden;">' + buttonHTML +'</div>';
                            botDiv2 += `</div>`;
                            botDiv += botDiv2;
                            botDiv += `</div>`;
                            botMessageHTML += botDiv;
                            botMessageHTML += '<div style="margin-top: 20px;"><b>If you have any questions or concerns about the results, please verify them using our application or contact our support team.</b></div>';
                        }
                         else {
                            bookingSets.forEach(bookingSet => {
                                var cleanedBookingSet = bookingSet.replace(/[\[\]{}"]/g, '');
                        
                                if (cleanedBookingSet.trim() !== '') {
                                    cleanedBookingSet = cleanedBookingSet.trim();
                        
                                    var keyValuePairs = cleanedBookingSet.split(',');
                        
                                    var bookingHTML = '<table class="booking-details">';
                                    keyValuePairs.forEach(pair => {
                                        var parts = pair.split(':');
                                        var key = parts[0].trim();
                                        var value = parts.slice(1).join(':').trim();
                        
                                        bookingHTML += '<tr><td><span class="key">' + key + '</span></td><td><span class="value">' + value + '</span></td></tr>\n';
                                    });
                                    bookingHTML += '</table><br>';
                                    botMessageHTML += bookingHTML;
                                }
                            });
                        }
                        
                        botMessageHTML += '</div></div>';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">'+ 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        document.addEventListener('input', function (event) {
                            if (event.target.id === 'search-input') {
                                var searchValue = event.target.value.toLowerCase();
                                var botMessageScroll = document.getElementById('bot-message-scroll');
                                var buttons = botMessageScroll.getElementsByClassName('booking-button');
                                var moduleName = 'receipts';

                                filterButtons(searchValue, buttons, moduleName);
                            }
                        });
                        closeType();
                        scrollToBottom();
                
                    userInputElement.removeEventListener('keypress', userInputElement._listener);
                })
                .catch(error => {
                    console.error('Error:', error);
                });                
        
            }
            displayPrompt();
        }

        function askBookingNumberselling(messages) {
            var inputValues = {};
            var currentIndex = 0;
            var userInputElement = document.getElementById('user-input');
        
            function displayPrompt() {
                var message = messages[currentIndex];
                var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                    <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                </div></div><div class="bot-message-chat">`;

                //var botMessageHTML = '<div class="message-container"><div class="bot-avatar"><img src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 30px; height: auto;"></div><div class="bot-message">';
                var botMessageHTML2 = '<div class="message-container"><div class="bot-message-time">';

                if (message.toLowerCase() === "from date") {
                    botMessageHTML += 'Please enter the "<b>' + message + '</b>"';
                    chatContainer.innerHTML += botMessageHTML;
                    var currentTime = new Date().toLocaleTimeString();
                    var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                    chatContainer.innerHTML += botTimeHTML;
                    var currentDate = new Date();
                    currentDate.setMonth(currentDate.getMonth() - 1);

                    var year = currentDate.getFullYear();
                    var month = String(currentDate.getMonth() + 1).padStart(2, '0');
                    var day = String(currentDate.getDate()).padStart(2, '0');
                    var hours = String(currentDate.getHours()).padStart(2, '0');
                    var minutes = String(currentDate.getMinutes()).padStart(2, '0');
                    var defaultDate = year + '-' + month + '-' + day + 'T' + hours + ':' + minutes;

                    botMessageHTML2 += '<input type="datetime-local" id="datetime-input" value="' + defaultDate + '">';
                    chatContainer.innerHTML += botMessageHTML2;
                    setTimeout(function() {
                        var datetimeInput = document.getElementById('datetime-input');
                        datetimeInput.focus();
                    }, 0);
                    scrollToBottom();
            
                    var datetimeInput = document.getElementById('datetime-input');

                    userInputElement.style.display = 'none';
            
                    datetimeInput.addEventListener('blur', function(event) {
                        var userInput = this.value.trim().split("T")[0];
                        simpleUserMessage(userInput);
            
                        inputValues["sell" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;

                        var botMessageCheck = document.querySelector('.bot-message-time');
                        if (botMessageCheck) {
                            botMessageCheck.remove();
                        }

                        userInputElement.style.display = 'block';
            
                        currentIndex++;
                        if (currentIndex < messages.length) {
                            displayPrompt();
                        } else {
                            sendAllInputs();
                        }
                    });
                } else if (message.toLowerCase() === "to date") {
                    botMessageHTML += 'Please enter the "<b>' + message + '</b>"';
                    chatContainer.innerHTML += botMessageHTML;
                    var currentTime = new Date().toLocaleTimeString();
                    var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                    chatContainer.innerHTML += botTimeHTML;
                    var defaultDate = new Date().toISOString().slice(0, 16);
                    botMessageHTML2 += '<input type="datetime-local" id="datetime-input" value="' + defaultDate + '">';
                    chatContainer.innerHTML += botMessageHTML2;
                    setTimeout(function() {
                        var datetimeInput = document.getElementById('datetime-input');
                        datetimeInput.focus();
                    }, 0);
                    scrollToBottom();
            
                    var datetimeInput = document.getElementById('datetime-input');

                    userInputElement.style.display = 'none';
            
                    datetimeInput.addEventListener('blur', function(event) {
                        var userInput = this.value.trim().split("T")[0];
                        simpleUserMessage(userInput);
            
                        inputValues["sell" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;

                        var botMessageCheck = document.querySelector('.bot-message-time');
                        if (botMessageCheck) {
                            botMessageCheck.remove();
                        }

                        userInputElement.style.display = 'block';
            
                        currentIndex++;
                        if (currentIndex < messages.length) {
                            displayPrompt();
                        } else {
                            sendAllInputs();
                        }
                    });
                } else if (message.toLowerCase() === "direct purchase") {
                            event.preventDefault();
                            var userInput = "D";
            
                            inputValues["sell" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
            
                            this.value = '';
            
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }

                } else if (message.toLowerCase() === "indirect purchase") {
                    event.preventDefault();
                    var userInput = "I";
    
                    inputValues["sell" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
    
                    this.value = '';
    
                    currentIndex++;
                    if (currentIndex < messages.length) {
                        displayPrompt();
                    } else {
                        sendAllInputs();
                    }

                } else {
                    botMessageHTML += 'Please type in the "<b>' + message + '</b>"';
                    chatContainer.innerHTML += botMessageHTML;
                    var currentTime = new Date().toLocaleTimeString();
                    var botTimeHTML = '<div class="bot-time">' + 'EZEEBOT , ' + currentTime + '</div>';
                    chatContainer.innerHTML += botTimeHTML;
                    scrollToBottom();
            
                    userInputElement.focus();
            
                    if (userInputElement._listener) {
                        userInputElement.removeEventListener('keypress', userInputElement._listener);
                    }
            
                    userInputElement._listener = function (event) {
                        if (event.key === 'Enter') {
                            event.preventDefault();
                            var userInput = this.value.trim();
                            simpleUserMessage(userInput);
            
                            inputValues["sell" + message.toLowerCase().replace(/\s+/g, '_')] = userInput;
            
                            this.value = '';
            
                            currentIndex++;
                            if (currentIndex < messages.length) {
                                displayPrompt();
                            } else {
                                sendAllInputs();
                            }
                        }
                    };
            
                    userInputElement.addEventListener('keypress', userInputElement._listener);
                }
            }
        
            function sendAllInputs() {
                typingMessage();
                fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({
                        user_input: {
                            ...inputValues,
                            'current_date': formattedDate,
                            'tenantid': tenantid,
                            'officeid': officeid,
                            'userid': userid,
                            'userid2': userid2,
                            'environment': environment,
                        }
                    }),
                })
                .then(response => response.json())
                .then(data => {
                    var inputSummary = '<b>[ </b>' + Object.keys(inputValues).map(function(key, index, array) {
                        var displayKey = key.replace(/^sell/, '').replace(/_/g, ' ');
                        var displayValue = inputValues[key];
                        var comma = (index !== array.length - 1) ? ', ' : '';
                    
                        if (displayKey.toLowerCase() === 'direct purchase' && displayValue.toLowerCase() === 'd') {
                            return '<b>Direct purchase</b>' + comma;
                        } else if (displayKey.toLowerCase() === 'indirect purchase' && displayValue.toLowerCase() === 'i') {
                            return '<b>indirect purchase</b>' + comma;
                        }
                    
                        return '<b>' + displayKey + ':</b> ' + displayValue + comma;
                    }).join('') + '<b> ]</b>';        
                    
                    var botMessageHTML = `<div class="message-container"><div class="bot-avatar"><div id = "dp" style="width: 28px; cursor: pointer; height: 28px; border-radius: 50%; border: 1px solid #e5e4e2; background-color: white; padding: 2px; position: relative; overflow: hidden; margin-top: 20px;">
                        <img id="thumbnail" src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 90%; height: 90%; margin-top: 1.5px; margin-left: 1px; object-fit: contain; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); clip-path: inset(0 0 7px 0);">
                    </div></div><div class="bot-message-booking"><b>Buying search result based on your criteria </b>${formatKeyValueList(inputSummary)}`;
                    
                    //var botMessageHTML = '<div class="message-container"><div class="bot-avatar"><img src="https://betatest.ezeeshipping.in/assets/img/EZ_New_LogoAboveText.png" alt="EzeeBot Logo" style="width: 30px; height: auto;"></div><div class="bot-message-booking"><b>Buying search result based on your criteria <br><br></b>' + '<span style="font-size:14px;">' + '<span style="font-size:14px;">' + formatKeyValueList(inputSummary) + '</span></span><br><br>';

                        var bookingSets = data.response.split('},');

                        if (bookingSets.length > 1) {
                            botMessageHTML += '<b>Multiple entries found. Please pick one to view more details</b><br><br>';
                            var counter = 1;
                            var buttonHTML = '';
                        
                            bookingSets.forEach((bookingSet, index) => {
                                var cleanedBookingSet = bookingSet.replace(/[\[\]{}"]/g, '');
                        
                                if (cleanedBookingSet.trim() !== '') {
                                    cleanedBookingSet = cleanedBookingSet.trim();
                                
                                    var keyValuePairs = cleanedBookingSet.split(',');
                                
                                    var bookingNumber = '';
                                    var statusCode = '';
                                    var det = '';
                                    var bookingHTML = '<table class="booking-details">';
                                    
                                    keyValuePairs.forEach(pair => {
                                        var parts = pair.split(':');
                                        var key = parts[0].trim();
                                        var value = parts.slice(1).join(':').trim();
                                
                                        if (key.toUpperCase() === 'BILL NUMBER') {
                                            if (value === 'null') {
                                                bookingNumber = null;
                                            } else {
                                                bookingNumber = value;
                                            }
                                        } else if (key.toUpperCase() === 'STATUS' && !bookingNumber) {
                                            statusCode = value;
                                        } else if (key.toUpperCase() === 'BILL DATE') {
                                            billdate = value;
                                        } else if (key.toUpperCase() === 'COMPANY') {
                                            company = value;
                                        }
                                        
                                        det += value + ',';
                                        console.log(det);
                                        bookingHTML += '<tr><td><span class="key">' + key + '</span></td><td><span class="value">' + value + '</span></td></tr>\n';
                                        
                                    });
                                    console.log(counter);
                                    
                                    bookingHTML += '</table>';
                                
                                    if (!bookingNumber) {
                                        buttonHTML += '<button class="booking-button" onclick="showBookingDetails(\'' + bookingNumber + '\', ' + counter + ')"><div style="float: left; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; border-right: 2px solid #f2f2f2;">' + company + '<span color: transparent;' + det +'</span></div><div style="display: inline-block; text-align: center; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center;">' + billdate + '</div><div style="float: right; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: right; border-left: 2px solid #f2f2f2;">' + statusCode + '</div></button><br>';
                                    } else {
                                        buttonHTML += '<button class="booking-button" onclick="showBookingDetails(\'' + bookingNumber + '\', ' + counter + ')"><div style="float: left; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: left; border-right: 2px solid #f2f2f2;">' + company + '<span color: transparent;' + det +'</span></div><div style="display: inline-block; text-align: center; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: center;">' + billdate + '</div><div style="float: right; width: 33%; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; text-align: right; border-left: 2px solid #f2f2f2;">' + bookingNumber + '</div></button><br>';
                                    }

                                    buttonHTML += '<div id="' + counter + 'bookingDetails_' + bookingNumber + '" style="display: none;">' + bookingHTML + '</div><br>';
                                    counter++;
                                }                                
                            });

                            var botDiv = `<div style="border: 1px solid transparent; padding-top: 10px; padding-left: 2px; padding-right: 2px; padding-bottom: 3px; border-radius: 10px; margin-top: 10px; background-color: #c0c0c0;">`;    
                            botDiv += '<input type="text" id="search-input" style="width: 100%;" placeholder="Global Search...">';
                            var botDiv2 = `<div style="border-left: 1px solid transparent; background-color: #e5e4e2; padding: 4px; border-bottom-left-radius: 8px; border-bottom-right-radius: 8px;">`;
                            botDiv2 += '<div id="num" style="font-size: 14px; display: flex; padding: 5px; align-items: left; justify-content: left;"></div>';
                            botDiv2 += '<div><table style="border-collapse: collapse; width: 100%; margin-bottom: 5px;"><thead style="background-color: #002147; color: white;"><tr><th style="border: 1px solid #dddddd; text-align: left; padding: 8px; width: 33.17%;">COMPANY</th><th style="border: 1px solid #dddddd; text-align: center; padding: 8px; width: 33.16%;">BILL DATE</th><th style="border: 1px solid #dddddd; text-align: right; padding: 8px; width: 33.66%;">BILL NO</th></tr></thead></table></div>';
                            botDiv2 +=  '<div id="bot-message-scroll" style="max-height: 250px; overflow-y: auto; overflow-x: hidden;">' + buttonHTML +'</div>';
                            botDiv2 += `</div>`;
                            botDiv += botDiv2;
                            botDiv += `</div>`;
                            botMessageHTML += botDiv;
                            botMessageHTML += '<div style="margin-top: 20px;"><b>If you have any questions or concerns about the results, please verify them using our application or contact our support team.</b></div>';
                        }
                         else {
                            bookingSets.forEach(bookingSet => {
                                var cleanedBookingSet = bookingSet.replace(/[\[\]{}"]/g, '');
                        
                                if (cleanedBookingSet.trim() !== '') {
                                    cleanedBookingSet = cleanedBookingSet.trim();
                        
                                    var keyValuePairs = cleanedBookingSet.split(',');
                        
                                    var bookingHTML = '<table class="booking-details">';
                                    keyValuePairs.forEach(pair => {
                                        var parts = pair.split(':');
                                        var key = parts[0].trim();
                                        var value = parts.slice(1).join(':').trim();
                        
                                        bookingHTML += '<tr><td><span class="key">' + key + '</span></td><td><span class="value">' + value + '</span></td></tr>\n';
                                    });
                                    bookingHTML += '</table><br>';
                                    botMessageHTML += bookingHTML;
                                }
                            });
                        }
                        
                        botMessageHTML += '</div></div>';
                        chatContainer.innerHTML += botMessageHTML;
                        var currentTime = new Date().toLocaleTimeString();
                        var botTimeHTML = '<div class="bot-time">'+ 'EZEEBOT , ' + currentTime + '</div>';
                        chatContainer.innerHTML += botTimeHTML;
                        document.addEventListener('input', function (event) {
                            if (event.target.id === 'search-input') {
                                var searchValue = event.target.value.toLowerCase();
                                var botMessageScroll = document.getElementById('bot-message-scroll');
                                var buttons = botMessageScroll.getElementsByClassName('booking-button');
                                var moduleName = 'buyings';

                                filterButtons(searchValue, buttons, moduleName);
                            }
                        });
                        closeType();
                        scrollToBottom();
                
                    userInputElement.removeEventListener('keypress', userInputElement._listener);
                })
                .catch(error => {
                    console.error('Error:', error);
                });                
        
            }
            displayPrompt();
        }  
        
        function formatKeyValueList(input) {
            let formattedString = '<div style="display: table; margin-top: 10px; margin-bottom: 10px; font-size: calc(9px + 0.5vw);">';

            if (typeof input === 'string') {
                let cleanInput = input.replace(/\[|\]/g, '').trim();

                let pairs = cleanInput.split(',').map(pair => pair.trim());

                pairs.forEach((pair, index) => {
                    let [key, value] = pair.split(':').map(part => part.trim());

                    let formattedKey = key.toUpperCase();
                    let formattedValue = value.toUpperCase();;

                    formattedString += `<div style="display: table-row;">`;

                    if (index === 0) {
                        formattedString += `<div style="display: table-cell;">${formattedKey}</div>`;
                        formattedString += `<div style="display: table-cell; color: #007bff; padding-left: 10px;">${formattedValue}</div>`;
                    } else {
                        formattedString += `<div style="display: table-cell;">${formattedKey}</div>`;
                        formattedString += `<div style="display: table-cell;color: #007bff; padding-left: 10px;">${formattedValue}</div>`;
                    }

                    formattedString += `</div>`;
                });
            } else {
                console.error('Invalid input:', input);
                return 'Invalid input';
            }
            formattedString += '</div>';
        
            return formattedString;
        }

        function scrollToBottom() {
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }

        function scrollToBottombottable() {
            var tables = document.querySelectorAll('table.striped-table tbody');
            var latestTable = tables[tables.length - 1];

            latestTable.scrollTop = latestTable.scrollHeight;
        }

    </script>
    
</body>
</html>
